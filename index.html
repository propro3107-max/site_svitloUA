<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ì—Ä–∞—Ñ—ñ–∫ –°–≤—ñ—Ç–ª–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #12121a;
            --card-bg: #1e1e2a;
            --text-main: #ffffff;
            --text-muted: #8e8e93;
            --accent-green: #2ecc71;
            --accent-red: #e74c3c;
            --accent-gray: #3a3a45;
            --line-color: #2c2c35;
            --glass-bg: rgba(255,255,255,0.08);
            --shadow-color: rgba(0,0,0,0.45);
            --radius: 16px;
            --text-card-detail: rgba(255, 255, 255, 0.7); /* –°–≤—ñ—Ç–ª–∏–π –¥–ª—è —Ç–µ–º–Ω–æ—ó —Ç–µ–º–∏ */
        }

        [data-theme="light"] {
            --bg-color: #f2f2f7;
            --card-bg: #ffffff;
            --text-main: #000000;
            --text-muted: #6e6e73;
            --line-color: #d1d1d6;
            --glass-bg: rgba(0,0,0,0.05);
            --shadow-color: rgba(0,0,0,0.1);
            --text-card-detail: #333333; /* –¢–µ–º–Ω–∏–π –∫–æ–ª—ñ—Ä –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –∫–∞—Ä—Ç–æ–∫ */
        }

        /* 1. –ú—ñ—Ç–∫–∏ —á–∞—Å—É (00:00, 08:00) */
        [data-theme="light"] .t-label {
            /* –†–æ–±–∏–º–æ —ó—Ö —Ç–µ–º–Ω–æ-—Å—ñ—Ä–∏–º–∏ */
            color: var(--text-muted) !important;
        }

        /* 2. –†–∏—Å–∫–∏ –Ω–∞ —Ç–∞–π–º–ª–∞–π–Ω—ñ (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ñ –ª—ñ–Ω—ñ—ó-–ø–æ–∑–Ω–∞—á–∫–∏) */
        [data-theme="light"] .t-tick {
            /* –†–æ–±–∏–º–æ —ó—Ö —Ç–µ–º–Ω–æ-—Å—ñ—Ä–∏–º–∏, —â–æ–± –≤–æ–Ω–∏ –±—É–ª–∏ –ø–æ–º—ñ—Ç–Ω—ñ –Ω–∞ –±—ñ–ª–æ–º—É */
            background: rgba(0, 0, 0, 0.4) !important;
        }

        /* 3. –ú—ñ–Ω—ñ-—Ç–∞–π–º–µ—Ä –ø—ñ–≥—É–ª–∫–∞ (—â–æ–± –±—É–ª–∞ –ø–æ–º—ñ—Ç–Ω–∞ –Ω–∞ –±—ñ–ª–æ–º—É) */
        [data-theme="light"] .mini-timer {
            background: rgba(0, 0, 0, 0.1); 
            border: 1px solid rgba(0, 0, 0, 0.3);
            color: var(--text-main); /* –ß–æ—Ä–Ω–∏–π —Ç–µ–∫—Å—Ç */
        }

        [data-theme="light"] .day-title {
            /* –†–æ–±–∏–º–æ '–ì–†–ê–§–Ü–ö –ù–ê –°–¨–û–ì–û–î–ù–Ü' —á–æ—Ä–Ω–∏–º */
            color: var(--text-main) !important; 
            opacity: 1 !important; /* –ü–æ–≤–Ω–∞ –Ω–µ–ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å */
        }

        [data-theme="light"] .date-text {
            /* –†–æ–±–∏–º–æ '–°–ï–†–ï–î–ê 26.11' —á–æ—Ä–Ω–∏–º */
            color: var(--text-main) !important; 
            /* –§–æ–Ω –¥–ª—è –ø—ñ–≥—É–ª–∫–∏ –≤–∂–µ –º–∞—î –±—É—Ç–∏ —Å—ñ—Ä–∏–º/—Ç–µ–º–Ω–∏–º, —â–æ –¥–∞—î –∫–æ–Ω—Ç—Ä–∞—Å—Ç */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            transition: background-color 0.3s, color 0.3s;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(128, 128, 128, 0.3); border-radius: 10px; }

        /* --- HEADER --- */
        .header {
            width: 100%; padding: 20px 20px 10px 20px;
            display: flex; justify-content: center; align-items: center;
            position: sticky; top: 0; z-index: 50;
            background: var(--bg-color); transition: background 0.3s;
        }

        .queue-select-btn {
            display: inline-flex; align-items: center; gap: 8px;
            font-size: 18px; font-weight: 700; color: var(--text-main);
            background: var(--glass-bg);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            padding: 8px 16px; border-radius: 20px;
            cursor: pointer; transition: 0.2s; border: 1px solid rgba(128,128,128,0.1);
        }
        .queue-select-btn:active { opacity: 0.7; }
        .arrow-icon { font-size: 12px; opacity: 0.7; transition: 0.3s; }
        .queue-select-btn.open .arrow-icon { transform: rotate(180deg); }

        .top-bar {
            width: 100%; display: flex; justify-content: space-between;
            align-items: center; padding: 10px 16px 0 16px; margin-top: 4px; gap: 10px;
        }
        .top-bar .users {
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--text-muted);
            white-space: nowrap;
        }
        .top-bar .updated { color: var(--text-muted); font-size: 11px; font-weight: 500; }
        .top-bar .users #topUsers { position: relative; top: 1px; }

        #app-content {
            width: 100%;
            max-width: 500px;
            padding: 0 12px;
            padding-bottom: 90px; /* —â–æ–± –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ —Ö–æ–≤–∞–≤—Å—è –ø—ñ–¥ —Ç–∞–±–∞–º–∏ */
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .emergency-overlay {
            opacity: 0;
            visibility: hidden;
            transition: 0.3s;
            opacity: 1;
            visibility: visible;
        }

        /* --- –ù–û–í–ê –ê–ù–Ü–ú–ê–¶–Ü–Ø –ë–ê–¢–ê–†–ï–ô–ö–ò (–ó–ë–Ü–õ–¨–®–ï–ù–ù–Ø) --- */

        /* –ë–∞–∑–æ–≤–∏–π —Å—Ç–∞–Ω –±–∞—Ç–∞—Ä–µ–π–∫–∏ */
        .battery-shell {
            cursor: pointer;
            /* –†–æ–±–∏–º–æ –ø–µ—Ä–µ—Ö—ñ–¥ –ø–ª–∞–≤–Ω–∏–º —ñ –ø—Ä–∏—î–º–Ω–∏–º */
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.4s ease;
            z-index: 10; /* –ë–∞–∑–æ–≤–∏–π —Ä—ñ–≤–µ–Ω—å */
        }

        /* –°—Ç–∞–Ω, –∫–æ–ª–∏ –±–∞—Ç–∞—Ä–µ–π–∫–∞ –∑–±—ñ–ª—å—à–µ–Ω–∞ */
        .battery-shell.battery-enlarged {
            /* –ó–±—ñ–ª—å—à—É—î–º–æ –Ω–∞ 15% */
            transform: scale(1.15);
            /* –î–æ–¥–∞—î–º–æ —Ç—ñ–Ω—å, —â–æ–± –≤–æ–Ω–∞ –Ω—ñ–±–∏ "–ø—ñ–¥–Ω—è–ª–∞—Å—è" –Ω–∞–¥ –µ–∫—Ä–∞–Ω–æ–º */
            box-shadow: 0 15px 35px rgba(0,0,0,0.4) !important;
            /* –ü—ñ–¥–Ω—ñ–º–∞—î–º–æ –≤–∏—â–µ –≤—Å—ñ—Ö —ñ–Ω—à–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ */
            z-index: 100;
        }

        .battery-tap-anim {
            animation: batteryTap 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .emergency-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.65);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0; visibility: hidden;
            transition: 0.3s;
        }

        .emergency-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .emergency-box {
            background: var(--card-bg);
            border-radius: 20px;
            width: 88%;
            max-width: 360px;
            padding: 26px 22px 22px;
            text-align: center;
            border: 1px solid rgba(255,0,0,0.25);
            box-shadow: 0 10px 28px rgba(255,0,0,0.25);
        }

        .emergency-title {
            font-size: 20px;
            font-weight: 800;
            color: #ff4d4d;
            margin-bottom: 12px;
        }

        .emergency-text {
            color: var(--text-main);
            opacity: 0.9;
            font-size: 15px;
            margin-bottom: 22px;
            line-height: 1.45;
        }

        .emergency-btn {
            width: 100%;
            padding: 12px;
            background: #ff4d4d;
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 700;
        }


        /* --- –ë–ê–¢–ê–†–ï–ô–ö–ê --- */
        .battery-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 10px;

            /* –í—ñ–¥—Å—Ç—É–ø –∑–Ω–∏–∑—É, —â–æ–± —Ç–∞–π–º–ª–∞–π–Ω –Ω–µ –ø—Ä–∏–ª–∏–ø–∞–≤ */
            margin-bottom: 10px;

            position: relative;

            /* üî• –ì–û–õ–û–í–ù–ï –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –ù–ê–õ–Ü–ó–ê–ù–ù–Ø: */
            z-index: 10; /* –ë—É–ª–æ 10. –°—Ç–∞–≤–∏–º–æ 30, —â–æ–± –±—É–ª–æ –≤–∏—â–µ –∑–∞ —Ç–∞–π–º–ª–∞–π–Ω (—É —è–∫–æ–≥–æ 20) */
        }
        /* --- –û–ù–û–í–õ–ï–ù–Ü –°–¢–ò–õ–Ü –î–õ–Ø –ë–ê–¢–ê–†–ï–ô–ö–ò --- */

        .battery-wrapper {
            display: flex;
            align-items: center;
            position: relative;

            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), filter 0.4s ease;
            cursor: pointer;
            z-index: 10;

            /* üî• –î–û–î–ê–Ñ–ú–û –¶–ï–ô –†–Ø–î–û–ö: */
            /* –ö–æ–º–ø–µ–Ω—Å—É—î–º–æ –ø—ñ–ø—Ç–∏–∫ (6px) + –π–æ–≥–æ –≤—ñ–¥—Å—Ç—É–ø (4px) = 10px */
            /* –¢–µ–ø–µ—Ä –∫–æ—Ä–ø—É—Å –±—É–¥–µ —ñ–¥–µ–∞–ª—å–Ω–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
            margin-left: 10px;
        }

        /* –ö–æ–ª–∏ –∑–±—ñ–ª—å—à–µ–Ω–∞ - –∑–±—ñ–ª—å—à—É—î–º–æ –≤—Å—é –æ–±–≥–æ—Ä—Ç–∫—É */
        .battery-wrapper.battery-enlarged {
            transform: scale(1.15);
            /* drop-shadow –∫—Ä–∞—â–µ, –±–æ —Ä–æ–±–∏—Ç—å —Ç—ñ–Ω—å —ñ –¥–ª—è –ø—ñ–ø—Ç–∏–∫–∞ —Ç–µ–∂ */
            filter: drop-shadow(0 15px 35px rgba(0,0,0,0.4));
            z-index: 100;
        }

        .battery-shell {
            width: 160px; height: 48px;
            border: 3px solid rgba(128,128,128,0.3); border-radius: 14px;
            padding: 4px; position: relative;
            /* –ó–≤—ñ–¥—Å–∏ –º–∏ –ø—Ä–∏–±—Ä–∞–ª–∏ transform —ñ transition */
        }
        .battery-tip { width: 6px; height: 18px; background: rgba(128,128,128,0.3); border-radius: 0 4px 4px 0; margin-left: 4px; }

        .battery-fill {
            height: 100%; width: 100%; border-radius: 9px;
            position: relative; overflow: hidden;
            /* –ü–ª–∞–≤–Ω–∞ –∑–º—ñ–Ω–∞ –∫–æ–ª—å–æ—Ä—É —Ç–∞ —à–∏—Ä–∏–Ω–∏ */
            transition: width 0.5s linear, background 0.5s linear, box-shadow 0.5s linear;
        }

/* --- –ü–†–û–ì–†–ï–°-–ë–ê–† (PREMIUM) --- */
        .card-progress-track {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px; 
            background: rgba(255, 255, 255, 0.1); /* –¢—Ä—ñ—à–∫–∏ —Å–≤—ñ—Ç–ª—ñ—à–∏–π —Ñ–æ–Ω —Ç—Ä–µ–∫—É */
            display: none;
            z-index: 5;
        }

        .card-progress-fill {
            height: 100%;
            width: 0%;
            transition: width 1s linear;
            border-radius: 0 2px 2px 0;
            position: relative; /* –©–æ–± –ø–æ–∑–∏—Ü—ñ–æ–Ω—É–≤–∞—Ç–∏ "—ñ—Å–∫—Ä—É" */
        }

        /* –Ü—Å–∫—Ä–∞ –Ω–∞ –∫—ñ–Ω—Ü—ñ (–±—ñ–ª–∏–π –±–ª—ñ–∫) */
        .card-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 6px; /* –®–∏—Ä–∏–Ω–∞ –±–ª—ñ–∫–∞ */
            background: #ffffff;
            border-radius: 4px;
            opacity: 0.8;
            box-shadow: 0 0 10px 2px rgba(255,255,255, 0.8); /* –°–≤—ñ—Ç—ñ–Ω–Ω—è –±–ª—ñ–∫–∞ */
        }

        .card.active-now .card-progress-track {
            display: block;
        }

        /* üü¢ –ó–ï–õ–ï–ù–ò–ô (–°–≤—ñ—Ç–ª–æ —î) */
        .card.c-on .card-progress-fill {
            /* –ì—Ä–∞–¥—ñ—î–Ω—Ç: –≤—ñ–¥ —Ç–µ–º–Ω–æ–≥–æ –¥–æ —è—Å–∫—Ä–∞–≤–æ–≥–æ */
            background: linear-gradient(90deg, rgba(46, 204, 113, 0.4) 0%, rgba(46, 204, 113, 1) 100%);
            box-shadow: 0 -2px 10px rgba(46, 204, 113, 0.5); /* –°–≤—ñ—Ç—ñ–Ω–Ω—è –≤–≥–æ—Ä—É */
        }

        /* üî¥ –ß–ï–†–í–û–ù–ò–ô (–°–≤—ñ—Ç–ª–∞ –Ω–µ–º–∞) */
        .card.c-off .card-progress-fill {
            /* –ì—Ä–∞–¥—ñ—î–Ω—Ç: –≤—ñ–¥ —Ç–µ–º–Ω–æ–≥–æ –¥–æ —è—Å–∫—Ä–∞–≤–æ–≥–æ */
            background: linear-gradient(90deg, rgba(231, 76, 60, 0.4) 0%, rgba(231, 76, 60, 1) 100%);
            box-shadow: 0 -2px 10px rgba(231, 76, 60, 0.5); /* –°–≤—ñ—Ç—ñ–Ω–Ω—è –≤–≥–æ—Ä—É */
        }

        /* --- –°–¢–ò–õ–¨–ù–ê –ü–Ü–ì–£–õ–ö–ê –¢–ê–ô–ú–ï–†–ê --- */
        .time-left-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            
            padding: 2px 6px 3px 6px; /* –¢—Ä–æ—Ö–∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ñ—à–µ */
            
            /* üî• –ë–£–õ–û margin-right: 10px; –°–¢–ê–õ–û 0 (–±–æ gap —É –±–∞—Ç—å–∫–∞ –≤–∏—Ä—ñ—à—É—î) */
            margin-right: 0 !important; 
            
            font-size: 12px; /* –¢—Ä–æ—Ö–∏ –º–µ–Ω—à–∏–π —à—Ä–∏—Ñ—Ç, —â–æ–± –≤–ª—ñ–∑–ª–æ */
            font-weight: 700;
            color: #ffffff;
            letter-spacing: 0.3px;
            
            border-right: none !important; 
            
            /* –©–æ–± –±–µ–π–¥–∂ –Ω–µ —Å–ø–ª—é—â—É–≤–∞–≤—Å—è, —è–∫—â–æ –º—ñ—Å—Ü—è –º–∞–ª–æ */
            flex-shrink: 0; 

            animation: pulseBadge 2s infinite ease-in-out;
        }

        /* –ê–Ω—ñ–º–∞—Ü—ñ—è –¥–∏—Ö–∞–Ω–Ω—è */
        @keyframes pulseBadge {
            0% { background: rgba(255, 255, 255, 0.15); }
            50% { background: rgba(255, 255, 255, 0.25); }
            100% { background: rgba(255, 255, 255, 0.15); }
        }
        
        /* –ü—Ä–∏–±–∏—Ä–∞—î–º–æ —Ä–∏—Å–∫—É –¥–ª—è —Å–≤—ñ—Ç–ª–æ—ó —Ç–µ–º–∏, —Ä–æ–±–∏–º–æ –ø—Ä–æ—Å—Ç–æ –≤—ñ–¥—Å—Ç—É–ø */
        [data-theme="light"] .time-left-badge {
            border-right: 1px solid rgba(0,0,0,0.1);
            color: #000;
        }
        
        /* –ë–∞–∑–æ–≤–∏–π –≤–∏–≥–ª—è–¥ (–∑–∞–≤–∂–¥–∏ —Ç–µ–º–Ω–∏–π) */
        .card, .detail-card {
            background: var(--card-bg) !important; /* üî• –ü–†–ò–ú–£–°–û–í–û –¢–ï–ú–ù–ò–ô –§–û–ù */
            border: 2px solid transparent;         /* –ú—ñ—Å—Ü–µ –ø—ñ–¥ —Ä–∞–º–∫—É */
            color: var(--text-main);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        /* üü¢ –ê–ö–¢–ò–í–ù–ê –ó–ï–õ–ï–ù–ê –ö–ê–†–¢–ö–ê (–†–∞–º–∫–∞ + –°–≤—ñ—Ç—ñ–Ω–Ω—è) */
        .card.active-now.c-on, 
        .detail-card.on {
            background: var(--card-bg) !important; /* –§–æ–Ω –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —Ç–µ–º–Ω–∏–º! */
            border-color: #30d158;                 /* –ó–µ–ª–µ–Ω–∞ —Ä–∞–º–∫–∞ */
            box-shadow: 0 0 20px rgba(48, 209, 88, 0.25); /* –ó–µ–ª–µ–Ω–µ —Å–≤—ñ—Ç—ñ–Ω–Ω—è –Ω–∞–≤–∫–æ–ª–æ */
        }

        /* üî¥ –ê–ö–¢–ò–í–ù–ê –ß–ï–†–í–û–ù–ê –ö–ê–†–¢–ö–ê (–†–∞–º–∫–∞ + –°–≤—ñ—Ç—ñ–Ω–Ω—è) */
        .card.active-now.c-off, 
        .detail-card.off {
            background: var(--card-bg) !important; /* –§–æ–Ω –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —Ç–µ–º–Ω–∏–º! */
            border-color: #ff453a;                 /* –ß–µ—Ä–≤–æ–Ω–∞ —Ä–∞–º–∫–∞ */
            box-shadow: 0 0 20px rgba(255, 69, 58, 0.25); /* –ß–µ—Ä–≤–æ–Ω–µ —Å–≤—ñ—Ç—ñ–Ω–Ω—è –Ω–∞–≤–∫–æ–ª–æ */
        }

        /* –ü—Ä–∏–±–∏—Ä–∞—î–º–æ —Å—Ç–∞—Ä—É —Å–º—É–∂–∫—É –∑–±–æ–∫—É –¥–ª—è –∞–∫—Ç–∏–≤–Ω–∏—Ö –∫–∞—Ä—Ç–æ–∫, –±–æ —Ç–µ–ø–µ—Ä —É –Ω–∞—Å —î —Ä–∞–º–∫–∞ */
        .card.active-now::before { display: none; }
        
        

/* --- –°–¢–ò–õ–Ü –î–õ–Ø DONATE POPUP --- */
        .donate-hero {
            text-align: center;
            margin-bottom: 20px;
        }
        .donate-emoji-big {
            font-size: 48px;
            display: block;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.6));
            animation: heartBeat 1.5s infinite ease-in-out;
        }
        @keyframes heartBeat {
            0% { transform: scale(1); }
            15% { transform: scale(1.15); }
            30% { transform: scale(1); }
            45% { transform: scale(1.15); }
            60% { transform: scale(1); }
        }

        /* –ö–Ω–æ–ø–∫–∞ –ú–æ–Ω–æ–±–∞–Ω–∫–∏ */
        .btn-mono {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #000000, #333333);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            color: white;
            text-decoration: none;
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
        }
        .btn-mono::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
            transition: 0.5s;
        }
        .btn-mono:active { transform: scale(0.96); }

        /* –ü–æ–ª–µ –∫–∞—Ä—Ç–∫–∏ */
        .card-copy-box {
            background: rgba(255, 255, 255, 0.08);
            border: 1px dashed rgba(255, 255, 255, 0.2);
            padding: 14px;
            border-radius: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s;
        }
        .card-copy-box:active { background: rgba(255, 255, 255, 0.15); }

        .cc-num {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 1px;
            color: var(--text-main);
        }
        .cc-icon { font-size: 18px; opacity: 0.7; }

        .donate-divider {
            display: flex; align-items: center; gap: 10px;
            margin: 15px 0; color: var(--text-muted); font-size: 12px; text-transform: uppercase;
        }
        .donate-divider::before, .donate-divider::after {
            content: ''; flex: 1; height: 1px; background: rgba(128,128,128,0.2);
        }

        /* —Å—ñ—Ä–∞ –±–∞—Ç–∞—Ä–µ–π–∫–∞ –∫–æ–ª–∏ –≥—Ä–∞—Ñ—ñ–∫ –Ω–µ–≤—ñ–¥–æ–º–∏–π */
        .battery-fill.fill-gray {
            background: #555;
            box-shadow: none;
        }

        .share-wrapper {
            width: 100%;
            display: flex;
            justify-content: center;
        }
        .share-wrapper {
            margin-top: 6px !important;
            margin-bottom: -4px !important;
        }

        .share-btn {
            background: none;               /* –º—ñ–Ω—ñ–º–∞–ª—ñ–∑–º */
            color: #46c97f;                 /* –∞–∫—É—Ä–∞—Ç–Ω–∏–π –∑–µ–ª–µ–Ω–∏–π */
            font-size: 15px;
            font-weight: 600;
            padding: 10px 4px;
            cursor: pointer;
            border: none;
            border-radius: 12px;
            transition: 0.25s ease;
        }

        .share-btn:active {
            opacity: 0.6;
            transform: scale(0.97);
        }

        /* --- –î–æ–¥–∞–π —Ü–µ –≤ –∫—ñ–Ω—Ü—ñ –±–ª–æ–∫—É CSS --- */

        /* –ö–ª–∞—Å –¥–ª—è "–ø—ñ–¥–Ω—è—Ç–æ–≥–æ" –∫—É—Ä—Å–æ—Ä–∞ */
        .cursor-line.cursor-elevated {
            /* –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è (-50%) —ñ –ø—ñ–¥–Ω—ñ–º–∞—î–º–æ –Ω–∞ 3px –≤–≥–æ—Ä—É (calc), + —Ç—Ä–æ—Ö–∏ –∑–±—ñ–ª—å—à—É—î–º–æ */
            transform: translate(-50%, calc(-50% - 3px)) scale(1.1);
            /* –†–æ–±–∏–º–æ –π–æ–≥–æ —â–µ —è—Å–∫—Ä–∞–≤—ñ—à–∏–º */
            box-shadow: 0 0 12px rgba(255, 255, 255, 1);
            /* –¢—Ä–æ—Ö–∏ –≤–∏—â–∏–º, —â–æ–± –≤—ñ–Ω "–æ–±—ñ–π–º–∞–≤" –∑–±—ñ–ª—å—à–µ–Ω—É –∫–∞—Ä—Ç–∫—É */
            height: 36px; 
            transition: transform 0.3s ease, height 0.3s ease, box-shadow 0.3s ease;
        }

        /* –ø–ª–∞–≤–Ω–∞ –ø–æ—è–≤–∞ */
        .share-wrapper.fade-in {
            animation: fadeInShare 0.4s ease forwards;
        }

        @keyframes fadeInShare {
            from { opacity: 0; transform: translateY(6px); }
            to   { opacity: 1; transform: translateY(0); }
        }


        .emergency-banner {
            text-align: center;
            color: #ff4d4d;
            font-size: 14px;
            font-weight: 700;
            margin-top: -4px;
            margin-bottom: 8px;
            animation: pulseEmergency 1.2s infinite ease-in-out;
        }

        @keyframes pulseEmergency {
            0%   { opacity: 0.7; }
            50%  { opacity: 1;   }
            100% { opacity: 0.7; }
        }

         .share-native-btn {
            display: block;
            text-align: center;
            background: #2b8eff;
            color: #fff;
            padding: 14px;
            border-radius: 14px;
            margin: 12px 20px 0 20px;
            font-weight: 600;
            font-size: 15px;
            text-decoration: none;
            transition: 0.2s;
        }

        .share-native-btn:active {
            transform: scale(0.96);
            opacity: 0.85;
        }

/* --- –ê–ù–Ü–ú–ê–¶–Ü–á –ó–ê–†–Ø–î–ö–ò/–†–û–ó–†–Ø–î–ö–ò --- */

/* 1. –°–º—É–∂–∫–∏ (—Ç–µ–∫—Å—Ç—É—Ä–∞) - –ó–º–µ–Ω—à–µ–Ω–∞ –Ü–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ñ—Å—Ç—å */
        .battery-fill::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            /* üî• –ó–º–µ–Ω—à–∏–ª–∏ –ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å –∑ 0.4 –¥–æ 0.25 */
            background-image: linear-gradient(45deg, 
                rgba(0,0,0,0.25) 25%, 
                transparent 25%, 
                transparent 50%, 
                rgba(0,0,0,0.25) 50%, 
                rgba(0,0,0,0.25) 75%, 
                transparent 75%, 
                transparent);
            background-size: 20px 20px;
            z-index: 2; /* –ù–∞–¥ —Ñ–æ–Ω–æ–º */
        }

        /* –¶–µ –±—ñ–ª–∞ –Ω–∞–ø—ñ–≤–ø—Ä–æ–∑–æ—Ä–∞ —Å–º—É–≥–∞, —â–æ –±—ñ–∂–∏—Ç—å –ø–æ–≤–µ—Ä—Ö—É */
        /* –ï—Ñ–µ–∫—Ç —Å–∫–ª—è–Ω–æ—ó —Ç—Ä—É–±–∫–∏ –∑–≤–µ—Ä—Ö—É */
        .battery-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%; /* –í–µ—Ä—Ö–Ω—è –ø–æ–ª–æ–≤–∏–Ω–∞ */
            background: linear-gradient(to bottom, 
                rgba(255,255,255,0.15) 0%, 
                rgba(255,255,255,0) 100%);
            border-radius: 8px 8px 0 0;
            pointer-events: none;
            z-index: 3;
        }

        /* --- –ê–ù–Ü–ú–ê–¶–Ü–Ø –•–í–ò–õ–Ü (–ó–ª—ñ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ) --- */
        @keyframes shineMove {
            0% { left: -100%; }
            100% { left: 200%; } /* –ü—Ä–æ–±—ñ–≥–∞—î –¥–æ –∫—ñ–Ω—Ü—è –≤–ø—Ä–∞–≤–æ */
        }

        .battery-fill:not(.discharging)::before {
            animation: shineMove 3s infinite ease-in-out; /* –•–≤–∏–ª—è –±—ñ–∂–∏—Ç—å –∫–æ–∂–Ω—ñ 2 —Å–µ–∫ */
        }

        /* –°–º—É–∂–∫–∏ —Ç–µ–∂ —Ä—É—Ö–∞—é—Ç—å—Å—è –≤–ø—Ä–∞–≤–æ (–Ω–∞–ø–æ–≤–Ω–µ–Ω–Ω—è) */
        @keyframes moveStripesRight { 0% { background-position: 0 0; } 100% { background-position: 40px 0; } }
        .battery-fill:not(.discharging)::after {
            animation: moveStripesRight 3s linear infinite;
        }


        /* 2. –ö–û–õ–ò –†–û–ó–†–Ø–î–ñ–ê–Ñ–¢–¨–°–Ø (–°–≤—ñ—Ç–ª–æ —î) */
        /* –•–≤–∏–ª—ñ –Ω–µ–º–∞—î (–∞–±–æ –≤–æ–Ω–∞ –¥—É–∂–µ –ø–æ–≤—ñ–ª—å–Ω–∞), —Å–º—É–∂–∫–∏ –ø–æ–≤–∑—É—Ç—å –≤–ª—ñ–≤–æ */

        /* –ü—Ä–∏–±–∏—Ä–∞—î–º–æ —Ö–≤–∏–ª—é, —â–æ–± –Ω–µ –º–∏–≥–æ—Ç—ñ–ª–æ, –∫–æ–ª–∏ —Å–≤—ñ—Ç–ª–æ —î (—Å–ø–æ–∫—ñ–π–Ω–∏–π —Å—Ç–∞–Ω) */
        .battery-fill.discharging::before {
            display: none;
            /* –ê–±–æ —è–∫—â–æ —Ö–æ—á–µ—à –ª–µ–¥—å –ø–æ–º—ñ—Ç–Ω—É: animation: shineMove 5s infinite; opacity: 0.2; */
        }

        /* –°–º—É–∂–∫–∏ –ø–æ–≤—ñ–ª—å–Ω–æ –ø–ª–∏–≤—É—Ç—å –≤–ª—ñ–≤–æ (–≤–∏—Ç—ñ–∫–∞–Ω–Ω—è) */
        @keyframes moveStripesLeft { 0% { background-position: 0 0; } 100% { background-position: -40px 0; } }
        .battery-fill.discharging::after {
            animation: moveStripesLeft 4s linear infinite;
        }

        /* 2. –ê–Ω—ñ–º–∞—Ü—ñ—è –¥–ª—è —Å—Ç–∞–Ω—É "–ó–ê–†–Ø–î–ö–ê" (–°–≤—ñ—Ç–ª–∞ –Ω–µ–º–∞) */
        /* –°–º—É–∂–∫–∏ —Ä—É—Ö–∞—é—Ç—å—Å—è –≤–ø—Ä–∞–≤–æ (–Ω–∞–ø–æ–≤–Ω–µ–Ω–Ω—è) + –ø—É–ª—å—Å–∞—Ü—ñ—è —Å–≤—ñ—Ç—ñ–Ω–Ω—è */
        @keyframes chargeFlow {
            0% { background-position: 0 0; }
            100% { background-position: 40px 0; }
        }
        @keyframes chargeGlow {
            0% { box-shadow: 0 0 10px inherit; filter: brightness(1); }
            50% { box-shadow: 0 0 20px inherit; filter: brightness(1.2); }
            100% { box-shadow: 0 0 10px inherit; filter: brightness(1); }
        }

        /* –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –¥–æ –±–∞—Ç–∞—Ä–µ–π–∫–∏, —è–∫–∞ –ù–ï –º–∞—î –∫–ª–∞—Å—É discharging (—Ç–æ–±—Ç–æ –∑–∞—Ä—è–¥–∂–∞—î—Ç—å—Å—è) */
        .battery-fill:not(.discharging)::after {
            animation: chargeFlow 1.5s linear infinite;
        }
        .battery-fill:not(.discharging) {
            /* –ú'—è–∫–∞ –ø—É–ª—å—Å–∞—Ü—ñ—è —Å–≤—ñ—Ç–ª–∞ */
            animation: chargeGlow 2s ease-in-out infinite;
        }


        /* 3. –ê–Ω—ñ–º–∞—Ü—ñ—è –¥–ª—è —Å—Ç–∞–Ω—É "–†–û–ó–†–Ø–î–ö–ê" (–°–≤—ñ—Ç–ª–æ —î) */
        /* –°–º—É–∂–∫–∏ —Ä—É—Ö–∞—é—Ç—å—Å—è –≤–ª—ñ–≤–æ (–≤–∏—Ç—ñ–∫–∞–Ω–Ω—è) –ø–æ–≤—ñ–ª—å–Ω–æ + —Å–ø–æ–∫—ñ–π–Ω–µ –¥–∏—Ö–∞–Ω–Ω—è */
        @keyframes dischargeFlow {
            0% { background-position: 0 0; }
            100% { background-position: -40px 0; }
        }
        @keyframes dischargeBreath {
            0% { opacity: 1; }
            50% { opacity: 0.85; } /* –õ–µ–¥—å –ø–æ–º—ñ—Ç–Ω–µ –ø–æ—Ç—É—Å–∫–Ω—ñ–Ω–Ω—è */
            100% { opacity: 1; }
        }

        /* –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ, –∫–æ–ª–∏ —î –∫–ª–∞—Å discharging */
        .battery-fill.discharging::after {
            /* –î—É–∂–µ –ø–æ–≤—ñ–ª—å–Ω–∏–π —Ä—É—Ö (4s), —â–æ–± –Ω–µ –º–∏–≥–æ—Ç—ñ–ª–æ */
            animation: dischargeFlow 4s linear infinite;
        }
        .battery-fill.discharging {
            /* –°–ø–æ–∫—ñ–π–Ω–∏–π –µ—Ñ–µ–∫—Ç "–¥–∏—Ö–∞–Ω–Ω—è" */
            animation: dischargeBreath 5s ease-in-out infinite;
        }

        .battery-text {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 22px; font-weight: 700; text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            font-variant-numeric: tabular-nums; width: 100%; text-align: center; z-index: 5; color: white;
            text-shadow: 0 1px 3px rgba(0,0,0,0.4); /* –õ–µ–≥–∫–∞ —Ç—ñ–Ω—å –¥–ª—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ */
        }
        .battery-status {
            /* –í—ñ–¥—Å—Ç—É–ø–∏ —ñ —Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è */
            margin-top: 8px;
            margin-left: 0;
            
            /* –®—Ä–∏—Ñ—Ç (—Ç–µ—Ö–Ω—ñ—á–Ω–∏–π) */
            font-family: "Menlo", "Consolas", "Roboto Mono", monospace;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            
            /* –ë–∞–∑–æ–≤–∏–π –∫–æ–ª—ñ—Ä (—è–∫—â–æ JS –Ω–µ —Å–ø—Ä–∞—Ü—é—î) */
            color: var(--text-muted);
            
            /* –ü–ª–∞–≤–Ω—ñ—Å—Ç—å –∑–º—ñ–Ω–∏ –∫–æ–ª—å–æ—Ä—É */
            transition: color 0.4s ease, text-shadow 0.4s ease;
        }

        /* üü¢ –ö–æ–ª–∏ —Å–≤—ñ—Ç–ª–æ –Ñ: –ù–µ–æ–Ω–æ–≤–∏–π –∑–µ–ª–µ–Ω–∏–π */
        .battery-status.status-on {
            color: #4cd964; 
            text-shadow: 0 0 12px rgba(76, 217, 100, 0.6);
        }

        /* üî¥ –ö–æ–ª–∏ —Å–≤—ñ—Ç–ª–∞ –ù–ï–ú–ê–Ñ: –ù–µ–æ–Ω–æ–≤–∏–π —á–µ—Ä–≤–æ–Ω–∏–π */
        .battery-status.status-off {
            color: #ff3b30;
            text-shadow: 0 0 12px rgba(255, 59, 48, 0.6);
        }

        /* --- –î–ê–¢–ê (–í–ò–ü–†–ê–í–õ–ï–ù–û: –†–Ü–í–ù–û–ú–Ü–†–ù–Ü –í–Ü–î–°–¢–£–ü–ò) --- */
        .date-box {
            display: flex !important;
            align-items: center;
            justify-content: space-between;
            
            width: 100%;
            /* üî• –ë–£–õ–û 50px -> –°–¢–ê–õ–û 42px (–∑–≤—É–∑–∏–ª–∏) */
            height: 42px;               
            
            /* –¢—Ä–æ—Ö–∏ –∑–º–µ–Ω—à–∏–≤ –≤—ñ–¥—Å—Ç—É–ø –∑–Ω–∏–∑—É (–±—É–ª–æ 12px -> —Å—Ç–∞–ª–æ 8px) */
            margin: 4px 0 8px 0 !important; 
            padding: 0 6px 0 16px;      

            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;        /* –¢—Ä–æ—Ö–∏ –º–µ–Ω—à–∏–π —Ä–∞–¥—ñ—É—Å */
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .date-line { display: none !important; }

        /* 2. –õ—ñ–≤–∏–π –Ω–∞–ø–∏—Å "–ì–†–ê–§–Ü–ö..." */
        .day-title {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            
            /* üî• !important –∑–º—É—Å–∏—Ç—å –π–æ–≥–æ —Å—Ç–∞—Ç–∏ –±—ñ–ª–∏–º */
            color: rgba(255, 255, 255, 0.9) !important; 
            
            margin: 0;
            line-height: 1;
            opacity: 1 !important; /* –ü—Ä–∏–±–∏—Ä–∞—î–º–æ –±—É–¥—å-—è–∫—É –ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å */
        }

        /* 3. –ü—Ä–∞–≤–∞ –ø–ª–∞—à–∫–∞ "–í–Ü–í–¢–û–†–û–ö..." */
        /* 3. –ü—Ä–∞–≤–∞ –ø–ª–∞—à–∫–∞ "–í–Ü–í–¢–û–†–û–ö..." - –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –ñ–ò–†–ù–ê */
        .date-text {
            display: flex !important;
            align-items: center;
            justify-content: center;

            height: 30px;                 
            padding: 0 12px;
            
            background: rgba(255, 255, 255, 0.12);
            border-radius: 8px;
            
            font-size: 13px;
            
            /* üî• –ë–£–õ–û 800 -> –°–¢–ê–õ–û 900 (Black) */
            font-weight: 700 !important; 
            
            color: #ffffff !important;   
            
            /* üî• –•–ê–ö: –¥–æ–¥–∞—î–º–æ –º—ñ–∫—Ä–æ-—Ç—ñ–Ω—å —Ç–æ–≥–æ –∂ –∫–æ–ª—å–æ—Ä—É, 
            —Ü–µ —Ä–æ–±–∏—Ç—å –ª—ñ—Ç–µ—Ä–∏ –≤—ñ–∑—É–∞–ª—å–Ω–æ —â–µ —Ç–æ–≤—Å—Ç—ñ—à–∏–º–∏ —ñ —á—ñ—Ç–∫—ñ—à–∏–º–∏ */
            text-shadow: 0 0 1px rgba(255,255,255,0.5) !important;
            
            text-transform: uppercase;
            letter-spacing: 0.5px;
            
            margin: 0;
            padding-bottom: 1px;
        }

        /* –°–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞ */
        [data-theme="light"] .date-box { background: #ffffff; border-color: rgba(0,0,0,0.05); }
        [data-theme="light"] .date-text { background: rgba(0,0,0,0.08); color: #000; }

        /* --- –ì–û–õ–û–í–ù–ò–ô –ë–õ–û–ö –î–ù–Ø (—Å–ª–∞–π–¥–∏—Ç—å—Å—è) --- */
        .day-body {
            position: relative;
            transition: transform .25s ease, opacity .25s ease;
            will-change: transform, opacity;
        }

        /* --- –ù–û–í–ò–ô MODERN TIMELINE --- */
        .timeline-box {
            position: relative;
            padding: 0 10px; 
        }

        .timeline-track {
            position: relative;
            width: 100%;
            height: 19px; 
            display: flex;
            align-items: center;
            
            /* üî• –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–∏–±–∏—Ä–∞—î–º–æ gap, —â–æ–± –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∫—É—Ä—Å–æ—Ä–∞ –∑–±—ñ–≥–∞–ª–∞—Å—è –∑ –≥—Ä–∞—Ñ—ñ–∫–æ–º */
            gap: 0 !important; 
            
            background: rgba(255, 255, 255, 0.05); /* –õ–µ–≥–∫–∏–π —Ñ–æ–Ω —Ç—Ä–µ–∫—É, —è–∫ –Ω–∞ —Å–∫—Ä—ñ–Ω—ñ */
            border-radius: 6px; /* –ó–∞–∫—Ä—É–≥–ª–µ–Ω–Ω—è —Å–∞–º–æ–≥–æ —Ç—Ä–µ–∫—É */
            overflow: hidden; /* –©–æ–± —Å–µ–≥–º–µ–Ω—Ç–∏ –Ω–µ –≤–∏–ª–∞–∑–∏–ª–∏ –∑–∞ —Ä–∞–¥—ñ—É—Å */
        }

        .share-minimal-btn {
            background: none;
            border: none;
            color: #48ff91;
            font-size: 16px;
            padding: 10px 0;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .share-minimal-btn:hover {
            opacity: 0.8;
        }

        .time-pointer {
            position: absolute;
            width: 4px;
            background: #ffffff;
            border-radius: 2px;
            z-index: 50; /* –í–ò–©–ï –Ω—ñ–∂ —Å–µ–≥–º–µ–Ω—Ç (20‚Äì30), –∞–ª–µ –Ω–∏–∂—á–µ –Ω—ñ–∂ –º–æ–¥–∞–ª–∫–∏ */
        }

        .segment {
            position: relative;
            height: 100%; /* –ù–∞ –≤—Å—é –≤–∏—Å–æ—Ç—É —Ç—Ä–µ–∫—É */
            
            /* flex-grow –≤–∂–µ –∑–∞–¥–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ JS, —Ç—É—Ç –±–∞–∑–∞ */
            flex-grow: 1;
            flex-basis: 0;
            
            opacity: 0.8; /* –¢—Ä–æ—Ö–∏ —è—Å–∫—Ä–∞–≤—ñ—à–µ */
            transition: all 0.3s ease;
            cursor: pointer;

            /* üî• –ó–ê–ú–Ü–°–¢–¨ GAP: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø—Ä–æ–∑–æ—Ä—É —Ä–∞–º–∫—É —Å–ø—Ä–∞–≤–∞ –¥–ª—è –≤—ñ–¥—Å—Ç—É–ø—É */
            border-right: 2px solid var(--bg-color); 
            box-sizing: border-box; 
        }



        .segment:first-child { border-left: none; }
        .segment:last-child {
            border-right: none;
        }

        /* üî• –ö—Ä–∞—Å–∏–≤–∞ –æ–±–≤–æ–¥–∫–∞ + —Å–≤—ñ—Ç—ñ–Ω–Ω—è –±–µ–∑ –∫—Ä–∏–≤–æ—ó –ª—ñ–Ω—ñ—ó */
        .segment-selected {
            transform: translateY(-3px);
            z-index: 60;
        }

        .segment-selected::after {
            content: "";
            position: absolute;
            inset: -2px;
            border-radius: 16px; /* —Ç–µ —Å–∞–º–µ, —ñ–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—ñ–±—Ä–∞–Ω–æ */
            border: 2px solid white; /* —Å—Ç–∞–ª–æ —Ç–æ–Ω—à–µ */
            box-shadow: 0 0 12px rgba(255,255,255,0.4); /* –º–µ–Ω—à –∞–≥—Ä–µ—Å–∏–≤–Ω–µ —Å–≤—ñ—Ç—ñ–Ω–Ω—è */
            pointer-events: none;
            z-index: 61;
        }


        .on { background-color: #30d158; opacity: 1; }
        .off { background-color: #ff453a; opacity: 1; }
        .segment-icon { font-size: 18px; color: white; z-index: 2; filter: drop-shadow(0 1px 1px rgba(0,0,0,0.25)); opacity: 0.95; }

        /* --- –°–£–ß–ê–°–ù–ò–ô –ö–£–†–°–û–† (LIGHT BEAM) --- */
        .cursor-line {
            position: absolute;
            top: 0;
            bottom: 0; /* –†–æ–∑—Ç—è–≥—É—î–º–æ –Ω–∞ –≤—Å—é –≤–∏—Å–æ—Ç—É –±–∞—Ç—å–∫–∞ (.timeline-track) */
            width: 2px;   
            background: #ffffff; /* –ü—Ä–æ—Å—Ç–æ –±—ñ–ª–∞ –ª—ñ–Ω—ñ—è */
            box-shadow: 0 0 4px rgba(255,0,0,0.8); /* –ß–µ—Ä–≤–æ–Ω–µ –∞–±–æ –±—ñ–ª–µ —Å–≤—ñ—Ç—ñ–Ω–Ω—è */
            z-index: 50; 
            pointer-events: none;
            transform: none; /* –ü—Ä–∏–±–∏—Ä–∞—î–º–æ —Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è –ø–æ Y, –±–æ –º–∏ —Ä–æ–∑—Ç—è–≥–Ω—É–ª–∏ top/bottom */
            height: auto; /* –°–∫–∏–¥–∞—î–º–æ —Ñ—ñ–∫—Å–æ–≤–∞–Ω—É –≤–∏—Å–æ—Ç—É */
            margin-top: 0;
        }

        /* –Ø—Å–∫—Ä–∞–≤–∞ —Ç–æ—á–∫–∞ –Ω–∞ —Ç–∞–π–º–ª–∞–π–Ω—ñ */
        .cursor-line::before,
        .cursor-line::after {
            display: none;
        }

        .time-labels { position: relative; width: 100%; height: 24px; margin-top: 8px; padding: 0; left: -1px; }
        .t-label {
            position: absolute; top: 0; font-size: 11px; font-weight: 600; color: var(--text-muted);
            transform: translateX(-50%); white-space: nowrap; letter-spacing: 0.3px;
        }
        .t-tick {
            display: block;
            position: absolute;
            
            /* üî• –ü—ñ–¥–Ω—ñ–º–∞—î–º–æ –≤–≥–æ—Ä—É (–º—ñ–Ω—É—Å–æ–≤–∏–π –≤—ñ–¥—Å—Ç—É–ø), 
               —â–æ–± —Ä–∏—Å–∫–∞ –ø–æ—á–∏–Ω–∞–ª–∞—Å—è –ø—Ä—è–º–æ –≤—ñ–¥ –∫–æ–ª—å–æ—Ä–æ–≤–æ—ó —Å–º—É–∂–∫–∏ */
            top: -6px; 
            
            width: 1px;   /* –¢–æ–Ω–∫–∞ –ª—ñ–Ω—ñ—è */
            height: 7px;  /* –î–æ–≤–∂–∏–Ω–∞ —Ä–∏—Å–æ—á–∫–∏ */
            
            /* –†–æ–±–∏–º–æ —Ç—Ä–æ—Ö–∏ —è—Å–∫—Ä–∞–≤—ñ—à–∏–º, —â–æ–± –±—É–ª–æ –≤–∏–¥–Ω–æ */
            background: rgba(255, 255, 255, 0.35); 
            
            transform: translateX(-50%);
            z-index: 1;
        }

        @keyframes pulseActive {
            0% { transform: scale(1); }
            40% { transform: scale(1.06); }
            100% { transform: scale(1); }
        }

        .q-item.pulse {
            animation: pulseActive 1.2s ease;
        }


        /* --- CARD LIST --- */
        .card-list { display: flex; flex-direction: column; gap: 12px; margin-top: 12px; }
        .card {
            background: var(--card-bg); border-radius: var(--radius); padding: 16px;
            display: flex; flex-direction: column; position: relative; overflow: hidden;
            border: 2px solid transparent; transition: all 0.3s ease;
            box-shadow: 0 4px 12px var(--shadow-color);
            transform: translateZ(0); 
            will-change: transform, box-shadow;
        }
        .card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; }
        .card.c-on::before  { background: var(--accent-green); }
        .card.c-off::before { background: var(--accent-red); }
        .card-header { display: flex; justify-content: space-between; align-items: center; gap: 12px; }

        @keyframes pulseGreen { 0% { box-shadow: 0 0 15px rgba(46, 204, 113, 0.3); transform: scale(1); } 50% { box-shadow: 0 0 30px rgba(46, 204, 113, 0.6); transform: scale(1.02); } 100% { box-shadow: 0 0 15px rgba(46, 204, 113, 0.3); transform: scale(1); } }
        @keyframes pulseRed   { 0% { box-shadow: 0 0 15px rgba(231, 76, 60, 0.3); transform: scale(1); } 50% { box-shadow: 0 0 30px rgba(231, 76, 60, 0.6); transform: scale(1.02); } 100% { box-shadow: 0 0 15px rgba(231, 76, 60, 0.3); transform: scale(1); } }

        .card.active-now { z-index: 10; border-width: 2px; }
        .card.active-now.c-on  { border-color: var(--accent-green); animation: pulseGreen 2s infinite ease-in-out; }
        .card.active-now.c-off { border-color: var(--accent-red);  animation: pulseRed  2s infinite ease-in-out; }
        .card.active-now::before { display: none; }

        .card-info { display: flex; align-items: center; gap: 14px; }
        .c-icon { font-size: 20px; width: 24px; text-align: center; }
        .c-times { display: flex; flex-direction: column; gap: 2px; }
        .status-label { font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; }
        .c-on  .status-label { color: var(--accent-green); }
        .c-off .status-label { color: var(--accent-red); }
        .c-time { font-size: 16px; font-weight: 700; color: var(--text-main); }
        .c-dur {
            display: flex !important;       /* –í–º–∏–∫–∞—î–º–æ Flexbox */
            align-items: center;            /* –†—ñ–≤–Ω—è—î–º–æ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—ñ */
            justify-content: flex-end;      /* –ü—Ä–∏—Ç–∏—Å–∫–∞—î–º–æ –¥–æ –ø—Ä–∞–≤–æ–≥–æ –∫—Ä–∞—é */
            gap: 8px;                       /* –í—ñ–¥—Å—Ç—É–ø –º—ñ–∂ –±–µ–π–¥–∂–µ–º —ñ —á–∞—Å–æ–º */
            
            font-size: 14px;
            font-weight: 500;
            color: var(--text-muted);
            white-space: nowrap;            /* –ó–∞–±–æ—Ä–æ–Ω—è—î–º–æ –ø–µ—Ä–µ–Ω–æ—Å —Ç–µ–∫—Å—Ç—É */
        }


        /* --- –ú–Ü–ù–Ü-–¢–ê–ô–ú–ï–† (–ó–ú–ï–ù–®–ï–ù–ò–ô) --- */
/* --- –ú–Ü–ù–Ü-–¢–ê–ô–ú–ï–† (–§–Ü–ù–ê–õ–¨–ù–ê –ö–û–ú–ü–ê–ö–¢–ù–Ü–°–¢–¨) --- */
        .mini-timer {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 3px;
            
            margin-left: 6px;
            
            /* üî• –§—ñ–∫—Å–æ–≤–∞–Ω–∞ –≤–∏—Å–æ—Ç–∞ —Ç–∞ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π padding –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—ñ */
            height: 18px; /* –ó–∞–º—ñ—Å—Ç—å padding, —â–æ –ø–ª–∞–≤–∞—î */
            padding: 0 5px; /* –õ–∏—à–µ –±–æ–∫–æ–≤—ñ –≤—ñ–¥—Å—Ç—É–ø–∏ */

            background: rgba(255, 255, 255, 0.2); 
            border-radius: 4px;
            
            /* –†–æ–∑–º—ñ—Ä —Ç–µ–∫—Å—Ç—É —ñ –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è */
            font-size: 10px; 
            line-height: 1;
            font-weight: 700;
            color: #fff;
            
            /* üí• –û–ü–¢–ò–ß–ù–ê –ö–û–†–ï–ö–¶–Ü–Ø: –ó–º—ñ—â—É—î–º–æ –≤–µ—Å—å –≤–º—ñ—Å—Ç –Ω–∞ 0.5px –≤–Ω–∏–∑, —â–æ–± –∫–æ–º–ø–µ–Ω—Å—É–≤–∞—Ç–∏ –µ–º–æ–¥–∑—ñ */
            transform: translateY(0.5px); 
            
            animation: pulseBadge 2s infinite ease-in-out;
        }

        /* üü¢ –ê–ö–¢–ò–í–ù–ò–ô –¢–ê–ô–ú–ï–† (–°–í–Ü–¢–õ–û –Ñ) */
        .card.c-on .mini-timer {
            background: rgba(48, 209, 88, 0.2);       /* –ü—Ä–æ–∑–æ—Ä–∏–π –∑–µ–ª–µ–Ω–∏–π —Ñ–æ–Ω */
            color: #30d158;                          /* –ó–µ–ª–µ–Ω–∏–π —Ç–µ–∫—Å—Ç */
            border: 1px solid rgba(48, 209, 88, 0.5); /* –ó–µ–ª–µ–Ω–∞ —Ä–∞–º–∫–∞ */
        }

        /* üî¥ –ê–ö–¢–ò–í–ù–ò–ô –¢–ê–ô–ú–ï–† (–í–Ü–î–ö–õ–Æ–ß–ï–ù–ù–Ø) */
        .card.c-off .mini-timer {
            background: rgba(255, 69, 58, 0.2);       /* –ü—Ä–æ–∑–æ—Ä–∏–π —á–µ—Ä–≤–æ–Ω–∏–π —Ñ–æ–Ω */
            color: #ff453a;                           /* –ß–µ—Ä–≤–æ–Ω–∏–π —Ç–µ–∫—Å—Ç */
            border: 1px solid rgba(255, 69, 58, 0.5); /* –ß–µ—Ä–≤–æ–Ω–∞ —Ä–∞–º–∫–∞ */
        }

        /* 2. –§—ñ–∫—Å –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É */
        .status-label {
            /* –†–æ–±–∏–º–æ –≤–µ—Å—å —Ä—è–¥–æ–∫ –≥–Ω—É—á–∫–∏–º, —â–æ–± –≤—ñ–Ω —Å–∞–º –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–≤ —Å–≤—ñ–π –≤–º—ñ—Å—Ç (—Ç–µ–∫—Å—Ç + –ø—ñ–≥—É–ª–∫—É) */
            display: inline-flex;
            align-items: center;
            
            /* –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—ñ —Å—Ç–∏–ª—ñ */
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .card-details {
            padding: 0 2px;
            font-size: 13px;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.7);
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all 0.25s ease;
            will-change: max-height, opacity; 
            transform: translateZ(0);
        }

        /* üî• –ì–û–õ–û–í–ù–ï: –†–æ–±–∏–º–æ –≤–∞–∂–ª–∏–≤–∏–π —Ç–µ–∫—Å—Ç (—á–∞—Å) –Ø–°–ö–†–ê–í–û –ë–Ü–õ–ò–ú */
        .card-details b {
            color: var(--text-main) !important;
            font-weight: 700;
            letter-spacing: 0.3px;
        }

        /* –ü—Ä–∏–º—ñ—Ç–∫–∞ –∑–Ω–∏–∑—É (–∫—É—Ä—Å–∏–≤) - —Ä–æ–±–∏–º–æ —Ç—å–º—è–Ω—ñ—à–æ—é */
        .card-details i {
            color: rgba(255, 255, 255, 0.4);
            display: block;
            margin-top: 8px;
        }

        .card.expanded .card-details {
            max-height: 300px;
            opacity: 1;
        }

        html[data-theme="light"] .card-details {
            color: #1a1a1a !important;
            background: transparent !important;
            border-top: none !important;
        }

        /* –î–æ–¥–∞—Ç–∫–æ–≤–æ –¥–ª—è –∂–∏—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ */
        html[data-theme="light"] .card-details b {
            color: #000000 !important;
        }

        /* –î–æ–¥–∞—Ç–∫–æ–≤–æ –¥–ª—è –∫—É—Ä—Å–∏–≤—É */
        html[data-theme="light"] .card-details i {
            color: #555555 !important;
        }

        html[data-theme="light"] .c-item,
        html[data-theme="light"] .status-label,
        html[data-theme="light"] .card-info,
        html[data-theme="light"] .c-dur {
            color: #1a1a1a !important;
            transform: translateZ(0);
        }

        /* --- DETAIL CARD --- */
        @keyframes popInSpring  { 0% { opacity: 0; transform: translateY(-20px) scale(0.95); } 100% { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes popOutSpring { 0% { opacity: 1; transform: translateY(0) scale(1); } 100% { opacity: 0; transform: translateY(-20px) scale(0.95); } }
        .detail-card-container { margin-top: 12px; }
        .detail-card {
            background: var(--card-bg); border-radius: var(--radius);
            padding: 16px 18px 14px; border: 2px solid transparent;
            box-shadow: 0 10px 25px var(--shadow-color); position: relative; overflow: hidden;
            animation: popInSpring 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .detail-card.closing {
            animation: popOutSpring 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes popOutSpring {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
        }
        .detail-card.on  { border-color: var(--accent-green); box-shadow: 0 0 18px rgba(46, 204, 113, 0.35); }
        .detail-card.off { border-color: var(--accent-red);  box-shadow: 0 0 18px rgba(231, 76, 60, 0.35); }
        .detail-header, .detail-left { display: flex; align-items: center; gap: 12px; justify-content: space-between; }
        .detail-main { display: flex; flex-direction: column; gap: 3px; }
        .detail-status { font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; }
        .detail-status-on  { color: var(--accent-green); }
        .detail-status-off { color: var(--accent-red); }
        .detail-time { font-size: 16px; font-weight: 700; color: var(--text-main); }
        .detail-duration { font-size: 14px; font-weight: 600; color: var(--text-muted); white-space: nowrap; }
        .detail-divider { margin: 10px 0 8px 0; height: 1px; background: rgba(128,128,128,0.1); }
        .detail-body { font-size: 14px; line-height: 1.45; color: var(--text-main); opacity: 0.8; }
        .detail-body p { margin: 0 0 4px 0; }
        .detail-note { margin-top: 6px; font-size: 12px; font-style: italic; color: var(--text-muted); }

        /* --- FOOTER (–ø—ñ–¥—Å—É–º–æ–∫ + –¥–æ–Ω–∞—Ç) --- */
        .total-block {
            display: inline-block;
            background: var(--glass-bg);
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid rgba(128,128,128,0.1);

            /* üî• –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ –≤—ñ–¥—Å—Ç—É–ø–∏ */
            margin-top: 8px !important;    /* –±—É–ª–æ 20px ‚Äî –∑–º–µ–Ω—à–∏–≤ */
            margin-bottom: 6px;              /* –±—É–ª–æ 15px ‚Äî –∑–º–µ–Ω—à–∏–≤ */
            margin-left: auto;
            margin-right: auto;
            width: fit-content;

            color: var(--text-muted);
            font-size: 14px;
            font-weight: 500;
        }

        .total-block b {
            color: var(--text-main);
        }

        .donate-wrapper {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-top: 8px;
            margin-bottom: 16px;
        }

        .donate-btn {
            position: relative;
            width: 100%;
            height: 56px;
            background: #1a1a1a;
            border: none;
            border-radius: 16px;
            overflow: hidden;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            margin-left: 0;
        }

        .donate-btn:active { transform: scale(0.98); }

        .donate-progress {
            position: absolute; top: 0; left: 0; bottom: 0;
            width: 0%;
            background: linear-gradient(90deg, #FFC107, #FF9800);
            opacity: 0.8;
            transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1);
            z-index: 1;
        }

        .tomorrow-hint {
            text-align: center;
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 10px;
        }
        .hidden { display: none; }

        .detail-hidden {
            opacity: 0;
            pointer-events: none;
            transition: opacity .25s ease;
        }

        /* --- SWIPE ANIMATION --- */
        #app-content {
            transition: transform 0.25s ease;
        }

        .swipe-left {
            transform: translateX(-100%);
        }
        .swipe-right {
            transform: translateX(100%);
        }
        .swipe-reset {
            transform: translateX(0);
        }

        .donate-content {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            line-height: 1.3;
        }

        .donate-title {
            font-size: 15px;
            font-weight: 800;
            color: white;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .donate-amount {
            font-size: 13px;
            font-weight: 600;
            color: rgba(255,255,255,0.7);
        }

        /* --- TABS --- */
        .tab-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(24, 24, 32, 0.95); backdrop-filter: blur(10px);
            border-top: 1px solid rgba(128,128,128,0.1);
            display: flex; padding: 10px 20px 30px 20px;
            justify-content: space-between; gap: 10px; z-index: 80;
        }
        [data-theme="light"] .tab-bar { background: rgba(255, 255, 255, 0.95); }

        .tab-item {
            flex: 1; background: transparent; border: none; padding: 10px;
            border-radius: 12px; color: var(--text-muted);
            font-size: 14px; font-weight: 600; cursor: pointer; transition: 0.2s; text-align: center;
        }

        .tab-item.active { background: var(--glass-bg); color: var(--text-main); }

        /* --- –ù–û–í–ò–ô MODERN TIMELINE --- */
        .timeline-section {
            width: 100%;
            margin-top: 20px; /* –¢—Ä–æ—Ö–∏ –±—ñ–ª—å—à–µ –ø–æ–≤—ñ—Ç—Ä—è */
            padding: 0 10px;
        }

        .timeline-track {
            position: relative;
            width: 100%;
            height: 19px; /* –¢–æ–Ω–∫–∞ –ª—ñ–Ω—ñ—è */
            display: flex;
            align-items: center; /* –¶–µ–Ω—Ç—Ä—É—î–º–æ —Å–µ–≥–º–µ–Ω—Ç–∏ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—ñ */
            gap: 4px; /* –í—ñ–¥—Å—Ç—É–ø–∏ –º—ñ–∂ —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏ */
            background: transparent;
            padding: 0;
            box-shadow: none;
            overflow: visible;
        }

        .segment {
            position: relative;
            height: 10px; 
            border-radius: 4px; 
            flex-grow: 1;
            flex-basis: 0;
            transition: all 0.3s ease;
            opacity: 0.5; 
            box-shadow: none !important; 
            cursor: pointer;

            /* üî• –ë–£–õ–û 4px. –ó–ú–Ü–ù–Æ–Ñ–ú–û –ù–ê 1px */
            /* –¶–µ –ø—Ä–∏–±–µ—Ä–µ –≤—ñ–∑—É–∞–ª—å–Ω—É "–¥—ñ—Ä–∫—É", –∞–ª–µ –∑–∞–ª–∏—à–∏—Ç—å —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫ */
            border-right: 1px solid var(--bg-color); 
            
            background-clip: padding-box; 
            box-sizing: border-box;
        }

        /* –ê–∫—Ç–∏–≤–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç (—Ç–æ–π, —â–æ –∑–∞—Ä–∞–∑) */
        .segment.active-segment {
            /* –ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –ª–µ–≥–∫–µ —Å–≤—ñ—Ç—ñ–Ω–Ω—è */
            box-shadow: inset 0 0 0 1px rgba(255,255,255,0.3);
            z-index: 2;
        }

        /* –ö–æ–ª—å–æ—Ä–∏ */
        .on { background-color: #30d158; } /* Apple Green */
        .off { background-color: #ff453a; } /* Apple Red */

        /* –ü—Ä–∏–±–∏—Ä–∞—î–º–æ —ñ–∫–æ–Ω–∫–∏ –∑ —Ç–∞–π–º–ª–∞–π–Ω—É –¥–ª—è —á–∏—Å—Ç–æ—Ç–∏ */
        .segment-icon { display: none; }

/* --- –°–£–ß–ê–°–ù–ò–ô –ö–£–†–°–û–† (LIGHT BEAM) --- */
        .cursor-line {
            position: absolute;
            /* –¶–µ–Ω—Ç—Ä—É—î–º–æ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—ñ –≤—ñ–¥–Ω–æ—Å–Ω–æ timeline-box */
            top: 50%;
            transform: translate(-50%, -50%); 
            
            height: 32px; 
            width: 2px;   
            
            /* –ì—Ä–∞–¥—ñ—î–Ω—Ç... */
            background: linear-gradient(to bottom, 
                rgba(255,255,255,0) 0%, 
                rgba(255,255,255,1) 30%, 
                rgba(255,255,255,1) 70%, 
                rgba(255,255,255,0) 100%
            );
            
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.6);

            /* üî• –ù–ê–ô–í–ò–©–ò–ô Z-INDEX, —â–æ–± –±—É—Ç–∏ –Ω–∞–¥ —É—Å—ñ–º */
            z-index: 9999; 
            
            pointer-events: none;
            /* –ü—Ä–∏–±–∏—Ä–∞—î–º–æ –ø–ª–∞–≤–Ω—ñ—Å—Ç—å, —â–æ–± –∫—É—Ä—Å–æ—Ä –Ω–µ "–≤—ñ–¥—Å—Ç–∞–≤–∞–≤" –ø—Ä–∏ —Ä–µ—Å–∞–π–∑—ñ */
            /* transition: left 1s linear; */ 
        }

        /* –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–∞—î position: relative */
        .timeline-box {
            position: relative;
            padding: 0 10px;
        }
        
        /* –¢–µ–∫—Å—Ç —á–∞—Å—É */
        .t-label {
            position: absolute;
            
            /* üî• –¢—Ä–æ—Ö–∏ –æ–ø—É—Å—Ç–∏–≤ —Ç–µ–∫—Å—Ç (–±—É–ª–æ 4px), —â–æ–± –¥–∞—Ç–∏ –º—ñ—Å—Ü–µ –¥–æ–≤–≥—ñ–π —Ä–∏—Å—Ü—ñ */
            top: 8px; 
            
            font-size: 10px;
            font-weight: 600;
            color: rgba(255,255,255,0.5);
            
            transform: translateX(-50%);
            white-space: nowrap;
            letter-spacing: 0.3px;
        }

        .t-tick {
            display: block;
            position: absolute;
            
            /* –ü–æ—á–∞—Ç–æ–∫ –≤—ñ–¥ –Ω–∏–∑—É –∫–æ–ª—å–æ—Ä–æ–≤–æ—ó —Å–º—É–∂–∫–∏ */
            top: -6px; 
            
            width: 1px;
            height: 12px; /* üî• –ë–£–õ–û 7px. –ó—Ä–æ–±–∏–≤ –∑–Ω–∞—á–Ω–æ –¥–æ–≤—à–∏–º–∏ */
            
            /* –¢—Ä–æ—Ö–∏ –ø—Ä–æ–∑–æ—Ä—ñ, —â–æ–± –Ω–µ —Ä—ñ–∑–∞–ª–∏ –æ—á—ñ */
            background: rgba(255, 255, 255, 0.2); 
            
            transform: translateX(-50%);
            z-index: 1;
        }

        /* --- POPUP MENU (FAB) --- */
        .fab-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);
            z-index: 89; opacity: 0; visibility: hidden; transition: all 0.3s ease;
        }
        .fab-overlay.active { opacity: 1; visibility: visible; }

        .fab-container {
            position: fixed;
            bottom: 90px;     /* –±—É–ª–æ 70 ‚Äî –∑–∞–º—ñ–Ω–∏—Ç–∏ */
            right: 20px;
            z-index: 90;

            pointer-events: none; /* —è–∫ –±—É–ª–æ */

            display: flex;           /* –î–û–î–ê–¢–ò */
            flex-direction: column;  /* –î–û–î–ê–¢–ò */
            align-items: flex-end;   /* –î–û–î–ê–¢–ò */
        }

        .segment-icon {
            width: 20px;
            height: 20px;
            z-index: 2;
            opacity: 0.9;
            
            /* –¶–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è */
            display: flex;
            align-items: center;
            justify-content: center;
            
            /* –¢—ñ–Ω—å –¥–ª—è –æ–±'—î–º—É */
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
        }
        
        /* –†–æ–±–∏–º–æ SVG –±—ñ–ª–∏–º–∏ */
        .segment-icon svg {
            width: 100%;
            height: 100%;
            fill: #ffffff; /* –ë—ñ–ª–∏–π –∫–æ–ª—ñ—Ä */
        }

        .fab-main {
            width: 54px; height: 54px; border-radius: 50%;
            background: var(--accent-green); color: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 26px; cursor: pointer;
            box-shadow: 0 4px 20px rgba(46, 204, 113, 0.5);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), background 0.3s;
            flex-shrink: 0;
            pointer-events: auto; /* –∫–ª—ñ–∫–∞–±–µ–ª—å–Ω–∞ */
        }
        .fab-main:active { transform: scale(0.9); }
        .fab-container.active .fab-main {
            transform: rotate(90deg);
            background: var(--accent-red);
            box-shadow: 0 4px 20px rgba(231, 76, 60, 0.5);
        }

        .day-title,
        .date-text {
            font-size: 15px;
            font-weight: 600;
            text-transform: uppercase;
            white-space: nowrap;
            letter-spacing: 0.5px;
            text-align: center;
            color: rgba(255,255,255,0.65);
        }

        .date-line {
            width: 100%;
            height: 1px;
            background: rgba(255,255,255,0.18);
        }

        .segment.on.segment-selected {
            box-shadow: 0 0 10px 3px rgba(46, 204, 113, 0.6);
        }

        .segment.off.segment-selected {
            box-shadow: 0 0 10px 3px rgba(231, 76, 60, 0.6);
        }

        /* —Å–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞ */
        [data-theme="light"] .date-line {
            background: rgba(0,0,0,0.15);
        }

        [data-theme="light"] .day-title,
        [data-theme="light"] .date-text {
            color: rgba(0,0,0,0.65);
        }

        .day-body {
            transition: opacity 0.22s ease, transform 0.25s ease;
        }

        .day-body.slide-left {
            opacity: 0;
            transform: translateX(-40px);
        }

        .day-body.slide-right {
            opacity: 0;
            transform: translateX(40px);
        }


        /* –¢–µ–º–Ω–∞ —Ç–µ–º–∞ */
        [data-theme="dark"] .day-title,
        [data-theme="dark"] .date-text {
            color: rgba(255,255,255,0.65);
        }

        /* üî• –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–ª–∞–≤–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞—Ç–∏ */
        .date-box {
            transition: opacity .25s ease, transform .25s ease;
        }

        .date-box.anim-hide {
            opacity: 0;
            transform: translateX(-20px);
        }

        .date-box.anim-show {
            opacity: 1;
            transform: translateX(0);
        }

        .no-anim * {
            transition: none !important;
            animation: none !important;
        }

        .fab-menu {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
            margin-bottom: 5px;
            pointer-events: none; /* –∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä active */
        }
        .fab-container.active .fab-menu { pointer-events: auto; }

        .fab-item {
            background: var(--card-bg); color: var(--text-main);
            border: 1px solid rgba(128,128,128,0.15);
            padding: 10px 16px 10px 20px; border-radius: 30px;
            display: flex; align-items: center; justify-content: flex-end; gap: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); cursor: pointer;
            opacity: 0;
            transform: translateY(20px) scale(0.8);
            transform-origin: right bottom;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .fab-container.active .fab-item { opacity: 1; transform: translateY(0) scale(1); }
        .fab-item:active { transform: scale(0.95); background: var(--glass-bg); }

        .fab-text { font-size: 14px; font-weight: 600; }
        .fab-emoji { font-size: 18px; line-height: 1; width: 24px; text-align: center; }

        .fab-item:nth-last-child(1) { transition-delay: 0.05s; }
        .fab-item:nth-last-child(2) { transition-delay: 0.1s;  }
        .fab-item:nth-last-child(3) { transition-delay: 0.15s; }
        .fab-item:nth-last-child(4) { transition-delay: 0.2s;  }
        .fab-item:nth-last-child(5) { transition-delay: 0.25s; }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 99;
            opacity: 0; visibility: hidden; transition: 0.3s; backdrop-filter: blur(5px);
        }
        .modal-overlay.show { opacity: 1; visibility: visible; }

        .queue-list {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: var(--card-bg);
            border-top: 1px solid rgba(128,128,128,0.1);
            border-radius: 24px 24px 0 0;
            padding: 20px; max-height: 70vh; overflow-y: auto;
            transform: translateY(100%); transition: 0.3s;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
        }
        .modal-overlay.show .queue-list { transform: translateY(0); }
        .q-item {
            padding: 16px; margin-bottom: 8px; background: var(--glass-bg);
            border-radius: 12px; text-align: center; font-weight: 600; cursor: pointer; color: var(--text-main);
        }
        .q-item.active { background: #3498db; color: white; }

        #detailCardContainer {
            transition: height .28s ease, opacity .28s ease, padding .28s ease;
            overflow: hidden;
        }

        #detailCardContainer.closing {
            height: 0 !important;
            opacity: 0 !important;
            padding: 0 !important;
        }

        /* --- INFO MODAL --- */
        .info-modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 100;
            backdrop-filter: blur(5px); opacity: 0; visibility: hidden; transition: 0.3s;
            display: flex; align-items: center; justify-content: center; padding: 20px;
        }
        .info-modal-overlay.show { opacity: 1; visibility: visible; }

        .info-card {
            background: var(--card-bg); border-radius: 20px; padding: 24px;
            width: 100%; max-width: 340px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transform: scale(0.9); transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 1px solid rgba(128,128,128,0.1);
        }
        .info-modal-overlay.show .info-card { transform: scale(1); }

        .info-title { font-size: 20px; font-weight: 800; margin-bottom: 12px; color: var(--text-main); }
        .info-text { font-size: 14px; line-height: 1.6; color: var(--text-muted); margin-bottom: 20px; }
        .info-text a { color: var(--accent-green); text-decoration: none; font-weight: 600; }
        .info-close {
            width: 100%; padding: 12px; border-radius: 12px;
            background: var(--accent-green); color: white;
            font-weight: 700; border: none; cursor: pointer;
        }

        /* --- UTILS --- */
        .hidden { display: none !important; }
        .no-data-msg {
            text-align: center; color: var(--text-muted); padding: 30px 20px;
            background: var(--glass-bg); border-radius: 16px; font-size: 15px; margin-top: 12px;
        }
        .offline-badge {
            position: fixed; top: 10px; right: 10px; background: rgba(255, 69, 58, 0.9);
            color: white; padding: 4px 10px; border-radius: 8px; font-size: 11px; z-index: 100;
            font-weight: bold; backdrop-filter: blur(4px);
        }

        /* Skeleton */
        .skeleton-wrapper {
            width: 100%; max-width: 500px; padding: 20px 24px;
            display: flex; flex-direction: column; gap: 20px; margin: 0 auto; margin-top: 20px;
        }
        .skeleton {
            background: linear-gradient(90deg, var(--card-bg) 25%, var(--bg-color) 50%, var(--card-bg) 75%);
            background-size: 200% 100%; animation: shimmer 1.5s infinite linear; border-radius: 16px;
        }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .sk-battery { height: 80px; width: 100%; margin-bottom: 10px; border-radius: 24px; }
        .sk-date { height: 20px; width: 150px; margin: 0 auto; }
        .sk-timeline { height: 60px; width: 100%; }
        .sk-card { height: 80px; width: 100%; }

           /* --- MOBILE FIXES (–û–ß–ò–©–ï–ù–û) --- */
        @media (max-width: 360px) {
            .c-dur {
                flex-direction: column;
                align-items: flex-end;
                gap: 2px;
                font-size: 12px;
            }
        }

            /* –¢—Ä–æ—Ö–∏ –∑–º–µ–Ω—à—É—î–º–æ —Ç–µ–∫—Å—Ç –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
            .day-title,
            .date-text {
                font-size: 12px !important; /* –ë—É–ª–æ 13, –∑—Ä–æ–±–∏–≤ 12 —â–æ–± —Ç–æ—á–Ω–æ –≤–ª—ñ–∑–ª–æ */
                letter-spacing: 0.3px;
            }

            /* üî• –ü–†–ò–ë–†–ê–í –±–ª–æ–∫ .date-box, —â–æ–± –≤—ñ–Ω –Ω–µ –∑–∞–≤–∞–∂–∞–≤ —Ä–æ–∑–∫–∏–¥–∞—Ç–∏ —Ç–µ–∫—Å—Ç –ø–æ –∫—Ä–∞—è—Ö */
            /* üî• –ü–†–ò–ë–†–ê–í .date-line, –±–æ –ª—ñ–Ω—ñ–π –±—ñ–ª—å—à–µ –Ω–µ–º–∞—î */

            /* –§—ñ–∫—Å–∏ –¥–ª—è —à–∫–∞–ª–∏ —á–∞—Å—É –∑–∞–ª–∏—à–∞—î–º–æ */
            .timeline-section {
                margin-top: -4px !important;
            }

            .t-label {
                font-size: 10px !important;
            }

        .time-labels {
            position: relative;
            width: 100%;
            height: 20px;
            margin-top: 4px; /* –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –≤—ñ–¥—Å—Ç—É–ø –≤—ñ–¥ —Å–º—É–∂–∫–∏ */
            padding: 0;
            left: 0;
        }
        }

        html[data-theme="light"] .card-details {
            color: var(--text-card-detail) !important;
            background: transparent !important;
            border-top: none !important;
        }

        html[data-theme="light"] .card.expanded .card-details {
            max-height: 300px !important;
            opacity: 1 !important;
        }

        @keyframes detailCardClose {
            from {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            to {
                opacity: 0;
                transform: translateY(10px) scale(0.92);
            }
        }

        .detail-wrapper {
            transition: all 0.35s ease;
        }

        .detail-wrapper.hidden {
            opacity: 0;
            transform: translateY(-10px);
            margin-top: -20px;
        }

    </style>
</head>
<body>

    <div class="top-bar">
        <span class="updated" id="topUpdated">–û–Ω–æ–≤–ª–µ–Ω–æ‚Ä¶</span>
        <span style="flex: 1;"></span>
        <span class="users">
            <span class="icon">üë•</span>
            <span id="topUsers">‚Ä¶</span>
        </span>
    </div>

    <div class="header">
        <div class="queue-select-btn" onclick="toggleModal()">
            <span id="queueTitle">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span>
            <span class="arrow-icon">‚ñº</span>
        </div>
    </div>

    <div id="skeletonLoader" class="skeleton-wrapper">
        <div class="sk-battery skeleton"></div>
        <div class="sk-date skeleton"></div>
        <div class="sk-timeline skeleton"></div>
        <div class="sk-card skeleton"></div>
        <div class="sk-card skeleton"></div>
        <div class="sk-card skeleton"></div>
    </div>

    <div id="app-content" class="hidden">

        <!-- –ë–∞—Ç–∞—Ä–µ–π–∫–∞ (—Å—Ç–∞—Ü—ñ–æ–Ω–∞—Ä–Ω–∞) -->
        <div id="batterySection" class="battery-container">

            <div class="battery-wrapper" onclick="animateBattery()">

                <div class="battery-shell"> <div id="batteryFill" class="battery-fill"></div>
                    <div class="battery-text" id="batteryTimer">--:--</div>
                </div>

                <div class="battery-tip"></div>
            </div>

            <div class="battery-status" id="batteryLabel">—Å—Ç–∞—Ç—É—Å</div>
        </div>


        <!-- üî• –£–≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç –¥–Ω—è, —è–∫–∏–π "—Å–ª–∞–π–¥–∏—Ç—å—Å—è" –º—ñ–∂ –°—å–æ–≥–æ–¥–Ω—ñ/–ó–∞–≤—Ç—Ä–∞ -->
        <div id="dayBody" class="day-body">

            <div class="timeline-section" id="timelineSection">
                <div class="timeline-box">
                    <div class="timeline-track" id="timelineTrack"></div>
                    <div class="time-labels" id="timeLabelsBox"></div>
                </div>
                <div id="detailCardContainer" class="detail-card-container hidden"></div>
            </div>

                    <!-- –î–∞—Ç–∞ (—Å—Ç–∞—Ü—ñ–æ–Ω–∞—Ä–Ω–∞) -->

            <div class="date-box">
                <span id="dayTitle" class="day-title">–ì—Ä–∞—Ñ—ñ–∫ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ</span>
                <span id="dateDisplay" class="date-text">---</span>
            </div>

            <div id="emergencyBanner" class="emergency-banner hidden" onclick="showEmergency()">
            ¬† ¬† üö® –ó–∞—Ä–∞–∑ –¥—ñ—é—Ç—å –µ–∫—Å—Ç—Ä–µ–Ω–Ω—ñ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
            </div>

            <div id="noDataMessage" class="no-data-msg hidden">üí§ –ì—Ä–∞—Ñ—ñ–∫ –Ω–∞ —Ü–µ–π –¥–µ–Ω—å —â–µ –Ω–µ —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–æ</div>

            <div class="card-list" id="infoBox"></div>

            <div id="shareWrapper" class="share-wrapper">
                <button class="share-minimal-btn" onclick="openTelegramShare()">üîó –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –≥—Ä–∞—Ñ—ñ–∫–æ–º</button>
            </div>

            <div style="text-align:center;">
                <div class="total-block" id="totalBox"></div>
            </div>

            <a id="telegramShareNative" class="hidden"></a>

            <div class="donate-wrapper">
                <a href="https://send.monobank.ua/jar/6qoHuhpGgD" target="_blank" class="donate-btn">
                    <div class="donate-progress" id="donateProgress"></div>
                    <div class="donate-content">
                        <div class="donate-title">
                            <span>üîå</span> <span>–ü—ñ–¥–∑–∞—Ä—è–¥–∏—Ç–∏ –±–æ—Ç–∞</span>
                        </div>
                        <div class="donate-amount" id="donateAmount">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
                    </div>
                </a>
            </div>

        </div> <!-- /dayBody -->

        <div id="emergencyOverlay" class="emergency-overlay" onclick="closeEmergency()">
            <div class="emergency-box" onclick="event.stopPropagation()">
                <div class="emergency-title">üö® –ï–ö–°–¢–†–ï–ù–Ü –í–Ü–î–ö–õ–Æ–ß–ï–ù–ù–Ø</div>
                <div class="emergency-text">
                    –í–∞—à–µ —Å–≤—ñ—Ç–ª–æ –º–æ–∂—É—Ç—å –≤–∏–º–∫–Ω—É—Ç–∏ –±—É–¥—å-–∫–æ–ª–∏, –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –≥—Ä–∞—Ñ—ñ–∫—É.
                </div>
                <button class="emergency-btn" onclick="closeEmergency()">–ó—Ä–æ–∑—É–º—ñ–ª–æ</button>
            </div>
        </div>

    </div> <!-- /app-content -->

    <div class="modal-overlay" id="modal" onclick="toggleModal()">
        <div class="queue-list" id="queueList" onclick="event.stopPropagation()"></div>
    </div>

    <div class="tab-bar">
        <div class="tab-item active" id="tab1" onclick="switchTab(1)">–°—å–æ–≥–æ–¥–Ω—ñ</div>
        <div class="tab-item" id="tab2" onclick="switchTab(2)">–ó–∞–≤—Ç—Ä–∞</div>
    </div>

    <div class="fab-overlay" id="fabOverlay" onclick="toggleFab()"></div>

    <div class="fab-container" id="fabContainer">
        <div class="fab-menu">

            <div class="fab-item" onclick="showInfo('about')">
                <span class="fab-text">–ü—Ä–æ –±–æ—Ç–∞</span>
                <span class="fab-emoji">ü§ñ</span>
            </div>

            <div class="fab-item" onclick="showInfo('collab')">
                <span class="fab-text">–°–ø—ñ–≤–ø—Ä–∞—Ü—è</span>
                <span class="fab-emoji">ü§ù</span>
            </div>

            <div class="fab-item" onclick="showInfo('queue')">
                <span class="fab-text">–ß–µ—Ä–≥–∞</span>
                <span class="fab-emoji">‚ùì</span>
            </div>

            <div class="fab-item" onclick="showInfo('faq')">
                <span class="fab-text">–ü–∏—Ç–∞–Ω–Ω—è-–≤—ñ–¥–ø–æ–≤—ñ–¥—ñ</span>
                <span class="fab-emoji">üí¨</span>
            </div>

            <div class="fab-item" onclick="showInfo('emergency')">
                <span class="fab-text">–ê–≤–∞—Ä—ñ–π–Ω—ñ —Å–ª—É–∂–±–∏</span>
                <span class="fab-emoji">üö®</span>
            </div>

            <div class="fab-item" onclick="showInfo('support')">
                <span class="fab-text">–î–æ–Ω–∞—Ç</span>
                <span class="fab-emoji">üíö</span>
            </div>

            <div class="fab-item" onclick="universalShare()">
                <span class="fab-text">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è</span>
                <span class="fab-emoji">üì§</span>
            </div>


            <div class="fab-item" onclick="toggleTheme()" id="fabThemeBtnBlock">
                <span class="fab-text">–¢–µ–º–∞</span>
                <span class="fab-emoji" id="fabThemeIcon">üåô</span>
            </div>
        </div>

        <div class="fab-main" onclick="toggleFab()">
            <span class="fab-icon">‚ò∞</span>
        </div>
    </div>

    <div class="info-modal-overlay" id="infoModal" onclick="closeInfo()">
        <div class="info-card" onclick="event.stopPropagation()">
            <div class="info-title" id="infoTitle"></div>
            <div class="info-text" id="infoText"></div>
            <button class="info-close" onclick="closeInfo()">–ó—Ä–æ–∑—É–º—ñ–ª–æ</button>
        </div>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    function getUrlParam(name) {
        const url = new URL(window.location.href);
        return url.searchParams.get(name);
    }

    (function applyStartAppData() {
        let param = null;
        const fromUrl = getUrlParam("startapp");
        if (fromUrl) param = fromUrl;
        if (!param) param = tg.initDataUnsafe?.start_param;
        if (!param) return;

        try {
            const json = JSON.parse(atob(param.replace(/-/g, '+').replace(/_/g, '/')));
            if (json.updated) document.getElementById("topUpdated").innerText = "–û–Ω–æ–≤–ª–µ–Ω–æ: " + json.updated;
            if (json.users_total || json.users) {
                const raw = json.users_total || json.users;
                const clean = formatUsersNumber(raw);
                document.getElementById("topUsers").innerText = clean;
                window.STARTAPP_USERS = clean;
            }
            if (json.queue) {
                currentQueue = json.queue;
                localStorage.setItem('savedQueue', json.queue);
            }
        } catch (err) { console.error(err); }
    })();

    const CSV_PROXY_URL = "https://shy-fog-bb74svitlo-proxy.propro3107.workers.dev";
    let allData = [];
    let currentQueue = "1.1";
    let currentTab = 1;
    let countdownInterval;
    let activeSegmentElement = null;
    let activeListCard = null;
    let cursor = null;

    function ensureCursor() {
        if (!cursor) {
            cursor = document.createElement('div');
            cursor.id = 'timeline-cursor';
            cursor.className = 'cursor-line';
        }
    }

    // –∞–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
    setInterval(() => init(true), 120000);

    async function getCSV(retries = 5) {
        const url = `${CSV_PROXY_URL}?t=${Date.now()}`;
        try {
            const r = await fetch(url, { cache: "no-cache" });
            if (!r.ok) throw new Error("Bad status " + r.status);
            return await r.text();
        } catch (e) {
            if (retries > 0) return getCSV(retries - 1);
            throw e;
        }
    }

    async function fetchDonation() {
        try {
            const url = `${CSV_PROXY_URL}?jar=true&t=${Date.now()}`;
            const r = await fetch(url);
            const data = await r.json();

            if (data.amount !== undefined) {
                updateDonateUI(data.amount, data.goal);
            }
        } catch (e) {
            console.error("Donation error:", e);
            document.getElementById('donateAmount').innerText = "–ú–æ–Ω–æ–±–∞–Ω–∫–∞";
        }
    }

            // === ANIMATED SWIPE CONTROL ===

        let touchStartX = 0;
        let touchEndX = 0;
        let swipeLocked = false; // —â–æ–± –Ω–µ –¥—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ —Å–≤–∞–π–ø–∏

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        }, false);

        document.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            handleAnimatedSwipe();
        }, false);

        function handleAnimatedSwipe() {
            if (swipeLocked) return;

            const dx = touchEndX - touchStartX;

            // –ü–æ—Ä—ñ–≥ —Å–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è (60 –ø—ñ–∫—Å–µ–ª—ñ–≤)
            if (Math.abs(dx) < 60) return;

            // –°–≤–∞–π–ø –í–õ–Ü–í–û (–π–¥–µ–º–æ –Ω–∞ –ó–∞–≤—Ç—Ä–∞)
            if (dx < 0 && currentTab === 1) {
                swipeLocked = true;
                try { tg.HapticFeedback.selectionChanged(); } catch(e){}
                switchTab(2);
                // –†–æ–∑–±–ª–æ–∫—É—î–º–æ —Å–≤–∞–π–ø, –∫–æ–ª–∏ –∑–∞–∫—ñ–Ω—á–∏—Ç—å—Å—è –∞–Ω—ñ–º–∞—Ü—ñ—è switchTab
                setTimeout(() => { swipeLocked = false; }, 300);
            }

            // –°–≤–∞–π–ø –í–ü–†–ê–í–û (–ø–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—å –Ω–∞ –°—å–æ–≥–æ–¥–Ω—ñ)
            else if (dx > 0 && currentTab === 2) {
                swipeLocked = true;
                try { tg.HapticFeedback.selectionChanged(); } catch(e){}
                switchTab(1);
                setTimeout(() => { swipeLocked = false; }, 300);
            }
        }

        function scrollToActiveQueue() {
            const box = document.getElementById("queueList");
            const active = box.querySelector(".q-item.active");
            if (!active) return;

            const offset = active.offsetTop - (box.clientHeight / 2) + (active.clientHeight / 2);

            box.scrollTo({
                top: offset,
                behavior: "smooth"
            });

            active.classList.add("pulse");
            setTimeout(() => active.classList.remove("pulse"), 1200);
        }

    function animateBattery() {
        const wrapper = document.querySelector('.battery-wrapper');
        if (wrapper) wrapper.classList.toggle('battery-enlarged');
        try { tg.HapticFeedback.selectionChanged(); } catch (e) { }
    }

    function showEmergency() {
        document.getElementById("emergencyOverlay").classList.add("show");
    }

    function closeEmergency() {
        document.getElementById("emergencyOverlay").classList.remove("show");
        localStorage.setItem("emergency_ack", "1");
    }

    async function init(isSilent = false) {
        loadTheme();
        try {
            if (!isSilent) {
                const sk = document.getElementById('skeletonLoader');
                if (sk) sk.classList.remove('hidden');
                document.getElementById('app-content').classList.add('hidden');
            }

            const csvText = await getCSV();
            allData = parseCSV(csvText);

            const primary = normalizeHeaders(allData[0]);
            if (primary.emergency === "on") {
                document.getElementById("emergencyBanner").classList.remove("hidden");
                const ack = localStorage.getItem("emergency_ack");
                if (!ack) {
                    setTimeout(() => { showEmergency(); }, 3000);
                }
            } else {
                document.getElementById("emergencyBanner").classList.add("hidden");
                localStorage.removeItem("emergency_ack");
            }

            window.LAST_UPDATED = null;
            for (const row of allData) {
                if (row.updated_at && row.updated_at.trim() !== "") {
                    window.LAST_UPDATED = row.updated_at.trim();
                    break;
                }
            }
            updateTopUpdated();

            if (!allData.length) throw new Error("Empty Data");

            localStorage.setItem('cachedData', JSON.stringify(allData));
            removeOfflineBadge();

            const sk = document.getElementById('skeletonLoader');
            if (sk) sk.classList.add('hidden');

            setupApp(isSilent);

            const row = allData.find(r => r.group_id == currentQueue);
            if (row) {
                const cleanRow = normalizeHeaders(row);
                let u = cleanRow.users_total || cleanRow.users;

                if (!u && allData.length > 0) {
                    const primary = normalizeHeaders(allData[0]);
                    u = primary.users_total || primary.users;
                }

                if (u) {
                    updateTopUsers(formatUsersNumber(u));
                    // üî• –û–°–¨ –¢–£–¢ –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –û–±–Ω—É–ª—è—î–º–æ —Å—Ç–∞—Ä—ñ –¥–∞–Ω—ñ, –±–æ –º–∞—î–º–æ —Å–≤—ñ–∂—ñ
                    window.STARTAPP_USERS = null;
                }
            }

            // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Å—Ç–∞—Ä—ñ –¥–∞–Ω—ñ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –Ω–æ–≤–∏—Ö –Ω–µ–º–∞—î
            if (window.STARTAPP_USERS) updateTopUsers(window.STARTAPP_USERS);

        } catch (e) {
            console.error("Online fetch error:", e);
            const cached = localStorage.getItem('cachedData');
            if (cached) {
                allData = JSON.parse(cached);
                showOfflineBadge();
                window.LAST_UPDATED = null;
                for (const row of allData) {
                    if (row.updated_at && row.updated_at.trim() !== "") {
                        window.LAST_UPDATED = row.updated_at.trim();
                        break;
                    }
                }
                updateTopUpdated();
                const sk = document.getElementById('skeletonLoader');
                if (sk) sk.classList.add('hidden');
                setupApp(isSilent);
                if (window.STARTAPP_USERS) updateTopUsers(window.STARTAPP_USERS);
            }
        }
    }

    function setupApp(isSilent) {
        const p = new URLSearchParams(window.location.search);
        let q = p.get('q');
        if (q) {
            currentQueue = q;
            localStorage.setItem("savedQueue", q);
        } else {
            const saved = localStorage.getItem("savedQueue");
            if (saved) currentQueue = saved;
        }
        if (!isSilent) {
            buildMenu();
            const appContent = document.getElementById('app-content');
            if (appContent) appContent.classList.remove('hidden');
        }
        render(currentTab);
        updateNativeShareLink();
    }

    function showOfflineBadge() {
        if (!document.getElementById('offBadge')) {
            const b = document.createElement('div');
            b.id = 'offBadge'; b.className = 'offline-badge';
            b.innerText = 'Offline';
            document.body.appendChild(b);
        }
    }
    function removeOfflineBadge() { const b = document.getElementById('offBadge'); if (b) b.remove(); }
    function formatUsersNumber(v) { v = String(v).replace(/\s+/g, ""); return v.replace(/\B(?=(\d{3})+(?!\d))/g, " "); }

    /* ====== –î–û–ë–ê–í–õ–ï–ù–Ü –ö–†–ò–¢–ò–ß–ù–Ü –§–£–ù–ö–¶–Ü–á, –Ø–ö–ò–• –ù–ï –í–ò–°–¢–ê–ß–ê–õ–û ====== */

        function loadTheme() {
            let saved = localStorage.getItem('svitlo_theme');

            // –Ø–∫—â–æ –Ω–µ–º–∞—î ‚Äî –∑–∞–≤–∂–¥–∏ —Ç–µ–º–Ω–∞
            if (!saved) {
                saved = 'dark';
            }

            applyTheme(saved);
        }

        function applyTheme(theme) {
            const root = document.documentElement;
            root.setAttribute('data-theme', theme);

            const icon = document.getElementById('fabThemeIcon');
            if (icon) {
                icon.textContent = theme === 'light' ? '‚òÄÔ∏è' : 'üåô';
            }

            try {
                if (tg && tg.setBackgroundColor) {
                    tg.setBackgroundColor(theme === 'dark' ? '#12121a' : '#f2f2f7');
                }
            } catch (e) {}
        }


    function toggleTheme() {
        const cur = document.documentElement.getAttribute('data-theme') || 'dark';
        const next = cur === 'dark' ? 'light' : 'dark';
        localStorage.setItem('svitlo_theme', next);
        applyTheme(next);
        try {
            if (tg && tg.setBackgroundColor) {
                tg.setBackgroundColor(next === 'dark' ? '#12121a' : '#f2f2f7');
            }
        } catch (e) { }
    }

    function updateTopUpdated() {
        const el = document.getElementById('topUpdated');
        if (!el) return;
        if (!window.LAST_UPDATED) {
            el.innerText = '–û–Ω–æ–≤–ª–µ–Ω–æ: ‚Äî';
            return;
        }
        el.innerText = formatUpdateTime(window.LAST_UPDATED);
    }

    function updateTopUsers(val) {
        const el = document.getElementById('topUsers');
        if (!el) return;
        el.innerText = formatUsersNumber(val);
    }

    function addLabel(container, hour, label) {
        if (!container) return;
        const pct = (hour / 24) * 100;

        const lbl = document.createElement('div');
        lbl.className = 't-label';
        lbl.style.left = pct + '%';
        lbl.innerText = label;
        container.appendChild(lbl);

        const tick = document.createElement('div');
        tick.className = 't-tick';
        tick.style.left = pct + '%';
        container.appendChild(tick);
    }

    function formatHM(h) {
        if (h < 0) h = 0;
        let total = Math.round(h * 60);
        let hh = Math.floor(total / 60) % 24;
        let mm = total % 60;
        return String(hh).padStart(2, '0') + ':' + String(mm).padStart(2, '0');
    }

    function fmtDur(hours) {
        const totalMin = Math.round(hours * 60);
        const hrs = Math.floor(totalMin / 60);
        const mins = totalMin % 60;
        let parts = [];
        if (hrs > 0) parts.push(hrs + ' –≥–æ–¥');
        if (mins > 0 || parts.length === 0) parts.push(mins + ' —Ö–≤');
        return parts.join(' ');
    }

    function startTimer(targetHour, totalSeconds, isOnNow) {
        clearInterval(countdownInterval);
        const timerEl = document.getElementById('batteryTimer');
        if (!timerEl) return;

        function formatSec(sec) {
            const h = Math.floor(sec / 3600);
            const m = Math.floor((sec % 3600) / 60);
            const s = sec % 60;
            if (h > 0) {
                return (
                    String(h).padStart(2, '0') + ':' +
                    String(m).padStart(2, '0') + ':' +
                    String(s).padStart(2, '0')
                );
            }
            return (
                String(m).padStart(2, '0') + ':' +
                String(s).padStart(2, '0')
            );
        }

        function moveCursor() {
        // –®—É–∫–∞—î–º–æ –µ–ª–µ–º–µ–Ω—Ç –∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º ID
        const cursorEl = document.getElementById('timeline-cursor');
        if (!cursorEl) return;

        const now = new Date();
        const nowH = now.getHours() + now.getMinutes() / 60 + now.getSeconds() / 3600;
        
        // –†–∞—Ö—É—î–º–æ –≤—ñ–¥—Å–æ—Ç–æ–∫
        const pct = (nowH / 24) * 100;
        
        // –†—É—Ö–∞—î–º–æ
        cursorEl.style.left = `${pct}%`;
    }

        function tick() {
            const now = new Date();
            const nowH = now.getHours() + now.getMinutes() / 60 + now.getSeconds() / 3600;

            let diffH = targetHour - nowH;
            // —è–∫—â–æ targetHour ‚â§ 24 —ñ –≤–∂–µ –ø—Ä–æ–π—à–æ–≤ ‚Äì –∑–Ω–∞—á–∏—Ç—å –ø–æ–¥—ñ—è –∑–∞–≤—Ç—Ä–∞
            if (targetHour <= 24 && diffH < 0) diffH += 24;

            const remaining = Math.max(0, Math.round(diffH * 3600));
            const total = totalSeconds && totalSeconds > 0 ? totalSeconds : Math.max(remaining, 1);
            const pct = total > 0 ? remaining / total : 0;

            setBat(pct, isOnNow);
            timerEl.innerText = formatSec(remaining);
            moveCursor();

            if (remaining <= 0) {
                clearInterval(countdownInterval);
                timerEl.innerText = isOnNow ? '–°–≤—ñ—Ç–ª–æ –º–∞—î –≤–∏–º–∫–Ω—É—Ç–∏—Å—å' : '–°–≤—ñ—Ç–ª–æ –º–∞—î –∑ º—è–≤–∏—Ç–∏—Å—å';
                // —Ç—Ä–æ—Ö–∏ –ø–æ—á–µ–∫–∞—î–º–æ —ñ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏–º–æ –≥—Ä–∞—Ñ—ñ–∫ —Ç–∏—Ö–æ
                setTimeout(() => init(true), 60000);
            }
        }

        tick();
        countdownInterval = setInterval(tick, 1000);
    }

    function openTelegramShare() {
        const text = `–ì—Ä–∞—Ñ—ñ–∫ —Å–≤—ñ—Ç–ª–∞ –¥–ª—è —á–µ—Ä–≥–∏ ${currentQueue} —É –ë—Ä–æ–≤–∞—Ä–∞—Ö`;
        const url = 'https://t.me/SvitloBroBot';
        const shareUrl = 'https://t.me/share/url?url=' + encodeURIComponent(url) + '&text=' + encodeURIComponent(text);
        try {
            if (tg && tg.openTelegramLink) tg.openTelegramLink(shareUrl);
            else window.open(shareUrl, '_blank');
        } catch (e) {
            window.open(shareUrl, '_blank');
        }
    }

    function universalShare() {
        const text = `–ì—Ä–∞—Ñ—ñ–∫ —Å–≤—ñ—Ç–ª–∞ –¥–ª—è —á–µ—Ä–≥–∏ ${currentQueue} —É –ë—Ä–æ–≤–∞—Ä–∞—Ö: https://t.me/SvitloBroBot`;
        if (navigator.share) {
            navigator.share({ text }).catch(() => {
                openTelegramShare();
            });
        } else {
            openTelegramShare();
        }
    }

    function toggleFab() {
        const cont = document.getElementById('fabContainer');
        const ov = document.getElementById('fabOverlay');
        if (!cont || !ov) return;
        const isActive = cont.classList.toggle('active');
        ov.classList.toggle('active', isActive);
    }

        function showInfo(type) {
            const overlay = document.getElementById('infoModal');
            const title = document.getElementById('infoTitle');
            const text = document.getElementById('infoText');

            if (type === 'about') {
                title.innerText = "ü§ñ –ü—Ä–æ –±–æ—Ç–∞";
                text.innerHTML = `
                    –ó—Ä—É—á–Ω–∏–π –±–æ—Ç –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å —É –º. –ë—Ä–æ–≤–∞—Ä–∏.<br><br>
                    <b>–†–æ–∑—Ä–æ–±–Ω–∏–∫:</b> <a href="https://t.me/svitlopromo" target="_blank">@svitlopromo</a><br><br>
                    –ú–∏ –±–µ—Ä–µ–º–æ –æ—Ñ—ñ—Ü—ñ–π–Ω—ñ –¥–∞–Ω—ñ —Ç–∞ —Ä–æ–±–∏–º–æ —ó—Ö –∑—Ä–æ–∑—É–º—ñ–ª–∏–º–∏.
                `;
            } else if (type === 'queue') {
                title.innerText = "‚ùì –Ø–∫ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è —á–µ—Ä–≥—É";
                text.innerHTML = `
                    –í–∞—à–∞ —á–µ—Ä–≥–∞ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –∞–¥—Ä–µ—Å–∏ –ø—Ä–æ–∂–∏–≤–∞–Ω–Ω—è.<br><br>
                    1. –ó–∞–π–¥—ñ—Ç—å –Ω–∞ —Å–∞–π—Ç <a href="https://www.dtek-krem.com.ua/ua/shutdowns" target="_blank">–î–¢–ï–ö</a>.<br>
                    2. –í–≤–µ–¥—ñ—Ç—å —Å–≤–æ—é –≤—É–ª–∏—Ü—é.<br>
                    3. –ü–æ–¥–∏–≤—ñ—Ç—å—Å—è –Ω–æ–º–µ—Ä –≥—Ä—É–ø–∏.<br><br>
                    –ü–æ—Ç—ñ–º –æ–±–µ—Ä—ñ—Ç—å —Ü—é —á–µ—Ä–≥—É —É —Å–ø–∏—Å–∫—É –∑–≤–µ—Ä—Ö—É.
                `;

             } else if (type === 'faq') {
                title.innerText = "üí¨ –ü–∏—Ç–∞–Ω–Ω—è-–≤—ñ–¥–ø–æ–≤—ñ–¥—ñ";
                text.innerHTML = `
                    <b>1. –ß–æ–º—É –≥—Ä–∞—Ñ—ñ–∫ —É –±–æ—Ç—ñ –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—î –∑ —Ä–µ–∞–ª—å–Ω—ñ—Å—Ç—é?</b><br>
                    –ß–µ—Ä–µ–∑ –∞–≤–∞—Ä—ñ—ó –∞–±–æ –µ–∫—Å—Ç—Ä–µ–Ω—ñ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è. –ì—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î –ª–∏—à–µ —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ–π–Ω—ñ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è.<br><br>

                    <b>2. –ó–≤—ñ–¥–∫–∏ –≤–∏ –±–µ—Ä–µ—Ç–µ –≥—Ä–∞—Ñ—ñ–∫–∏?</b><br>
                    –ó –æ—Ñ—ñ—Ü—ñ–π–Ω–æ–≥–æ —Å–∞–π—Ç—É –î–¢–ï–ö. –î–∞–Ω—ñ –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.<br><br>

                    <b>3. –ú–æ—è –∞–¥—Ä–µ—Å–∞ –±–µ–∑ —Å–≤—ñ—Ç–ª–∞, –∞ –ø–æ –≥—Ä–∞—Ñ—ñ–∫—É –º–∞—î –±—É—Ç–∏ —Å–≤—ñ—Ç–ª–æ!</b><br>
                    –¶–µ –ª–æ–∫–∞–ª—å–Ω–∞ –∞–≤–∞—Ä—ñ—è –∞–±–æ –µ–∫—Å—Ç—Ä–µ–Ω–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è ‚Äî –≤–æ–Ω–∏ –Ω–µ –≤—Ö–æ–¥—è—Ç—å —É –≥—Ä–∞—Ñ—ñ–∫.<br><br>

                    <b>4. –ß–æ–º—É –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –Ω–µ –æ–¥—Ä–∞–∑—É?</b><br>
                    –î–¢–ï–ö –Ω–µ –∑–∞–≤–∂–¥–∏ –æ–Ω–æ–≤–ª—é—î –¥–∞–Ω—ñ –≤—á–∞—Å–Ω–æ. –ú–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —ó—Ö —Ä–µ–≥—É–ª—è—Ä–Ω–æ.<br><br>
                `;

            } else if (type === 'emergency') {
                title.innerText = "üö® –ê–≤–∞—Ä—ñ–π–Ω—ñ —Å–ª—É–∂–±–∏ –ë—Ä–æ–≤–∞—Ä—ñ–≤";
                text.innerHTML = `
                    ‚ö° <b>–î–¢–ï–ö –ö–∏—ó–≤—Å—å–∫—ñ —Ä–µ–≥—ñ–æ–Ω–∞–ª—å–Ω—ñ –µ–ª–µ–∫—Ç—Ä–æ–º–µ—Ä–µ–∂—ñ</b><br>
                    –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ: <a href="tel:0800400740">0 800 400 740</a><br><br>

                    üèõ <b>–ö–æ–Ω—Ç–∞–∫—Ç-—Ü–µ–Ω—Ç—Ä –ë—Ä–æ–≤–∞—Ä—Å—å–∫–æ—ó –º—ñ—Å—å–∫–æ—ó —Ä–∞–¥–∏</b><br>
                    <a href="tel:+380459461111">+38 045 946 1111</a><br><br>

                    üíß <b>–ë—Ä–æ–≤–∞—Ä–∏—Ç–µ–ø–ª–æ–≤–æ–¥–æ–µ–Ω–µ—Ä–≥—ñ—è</b><br>
                    <a href="tel:+380459441101">+38 045 944 1101</a><br><br>

                    üî• <b>–î–°–ù–° (–ü–æ–∂–µ–∂–Ω–∞ —Å–ª—É–∂–±–∞):</b> <a href="tel:101">101</a><br>
                    üöë <b>–®–≤–∏–¥–∫–∞ –¥–æ–ø–æ–º–æ–≥–∞:</b> <a href="tel:103">103</a><br>
                    üëÆ <b>–ü–æ–ª—ñ—Ü—ñ—è:</b> <a href="tel:102">102</a><br><br>

                    ‚ùó –£ —Ä–∞–∑—ñ –Ω–µ–±–µ–∑–ø–µ–∫–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—É–π—Ç–µ 101 –∞–±–æ 103.
                `;

            } else if (type === 'support') {
                title.innerText = "üíö –ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏";
                text.innerHTML = `
                    –î—è–∫—É—î–º–æ, —â–æ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç–µ –Ω–∞—à –ø—Ä–æ—î–∫—Ç!<br><br>
                    –í–∞—à—ñ –¥–æ–Ω–∞—Ç–∏ –¥–æ–ø–æ–º–∞–≥–∞—é—Ç—å –Ω–∞–º:<br>
                    ‚Ä¢ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Ä–æ–±–æ—Ç—É –±–æ—Ç–∞ üñ•Ô∏è<br>
                    ‚Ä¢ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫–∏ ‚ö°Ô∏è<br>
                    ‚Ä¢ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –Ω–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó üîß<br><br>
                    üîó <a href="https://send.monobank.ua/jar/6qoHuhpGgD" target="_blank">Monobank (–ë–∞–Ω–∫–∞)</a><br><br>
                    üí≥ –ê–±–æ –∫–∞—Ä—Ç–∫–æ—é:<br><b>4874 1000 2226 7571</b>
                `;
            } else if (type === 'collab') {
                title.innerText = "ü§ù –°–ø—ñ–≤–ø—Ä–∞—Ü—è";
                text.innerHTML = `
                    –ó –ø–∏—Ç–∞–Ω—å —Å–ø—ñ–≤–ø—Ä–∞—Ü—ñ —Ç–∞ —Ä–µ–∫–ª–∞–º–∏ –∑–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—å –¥–æ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞:<br><br>
                    üëâ <a href="https://t.me/svitlopromo" target="_blank">@svitlopromo</a>
                `;
            }

            overlay.classList.add('show');
            const fab = document.getElementById('fabContainer');
            const fabOverlay = document.getElementById('fabOverlay');
            if(fab) fab.classList.remove('active');
            if(fabOverlay) fabOverlay.classList.remove('active');
        }

        async function fetchDonation() {
            try {
                const url = `${CSV_PROXY_URL}?jar=true&t=${Date.now()}`;
                const r = await fetch(url);
                const data = await r.json();

                if (data.amount !== undefined) {
                    updateDonateUI(data.amount, data.goal);
                }
            } catch (e) {
                console.error("Donation error:", e);
                document.getElementById('donateAmount').innerText = "–ú–æ–Ω–æ–±–∞–Ω–∫–∞";
            }
        }

    function scrollToActiveQueue() {
        const list = document.getElementById('queueList');
        if (!list) return;
        const active = list.querySelector('.q-item.active');
        if (!active) return;
        const offset = active.offsetTop - list.clientHeight / 2;
        list.scrollTo({ top: offset, behavior: 'smooth' });
    }

    /* ====== –î–ê–õ–Ü –ô–î–ï –¢–í–û–Ø –Ü–°–ù–£–Æ–ß–ê –õ–û–ì–Ü–ö–ê –ü–ê–†–°–ò–ù–ì–£ / –†–ï–ù–î–ï–†–£ ====== */

    function parseCSV(text) {
        const rows = []; let currentRow = []; let currentVal = ''; let insideQuotes = false;
        for (let i = 0; i < text.length; i++) {
            const char = text[i]; const nextChar = text[i + 1];
            if (char === '"') {
                if (insideQuotes && nextChar === '"') { i++; currentVal += '"'; }
                else { insideQuotes = !insideQuotes; }
            }
            else if (char === ',' && !insideQuotes) {
                currentRow.push(currentVal); currentVal = '';
            }
            else if ((char === '\r' || char === '\n') && !insideQuotes) {
                if (char === '\r' && nextChar === '\n') i++;
                if (currentVal || currentRow.length) currentRow.push(currentVal);
                if (currentRow.length) rows.push(currentRow);
                currentRow = []; currentVal = '';
            } else { currentVal += char; }
        }
        if (currentVal || currentRow.length) currentRow.push(currentVal);
        if (currentRow.length) rows.push(currentRow);
        if (rows.length < 2) return [];
        const rawHeaders = rows[0].map(h => h.replace(/\uFEFF/g, '').replace(/\u00A0/g, ' ').replace(/[\u200B-\u200F]/g, '').trim().toLowerCase());
        return rows.slice(1).map(row => {
            const obj = {};
            rawHeaders.forEach((h, i) => {
                let val = row[i] ?? "";
                if (val.startsWith('"') && val.endsWith('"')) val = val.slice(1, -1);
                obj[h] = val.trim();
            });
            return obj;
        });
    }

    function normalizeHeaders(obj) {
        const fixed = {};
        for (let key in obj) {
            const clean = key.replace(/\uFEFF/g, "").replace(/\u00A0/g, " ").replace(/[\u200B-\u200F]/g, "").trim().toLowerCase();
            fixed[clean] = obj[key];
        }
        return fixed;
    }

    function getSchedule(fullText, targetDate) {
        if (!fullText) return null;
        const daysMap = ["–ù–µ–¥—ñ–ª—è", "–ü–æ–Ω–µ–¥—ñ–ª–æ–∫", "–í—ñ–≤—Ç–æ—Ä–æ–∫", "–°–µ—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä", "–ü º—è—Ç–Ω–∏—Ü—è", "–°—É–±–æ—Ç–∞"];
        const dayName = daysMap[targetDate.getDay()];
        const lines = fullText.replace(/\r\n/g, '\n').split('\n');
        let dayLine = lines.find(line => line.trim().startsWith(dayName));
        if (!dayLine || dayLine.includes(":-") || dayLine.includes(": -") || dayLine.trim().endsWith("-")) return null;
        let timesPart = dayLine.includes(':') ? dayLine.substring(dayLine.indexOf(':') + 1).trim() : "";
        if (!timesPart || timesPart === "-") return null;
        timesPart = timesPart.replace(/\+/g, "");
        const ranges = timesPart.split(',');
        let arr = [];
        let lastTime = 0;
        ranges.forEach(r => {
            const parts = r.split('-').map(s => s.trim());
            if (parts.length < 2) return;
            const startH = timeToH(parts[0]);
            const endH = timeToH(parts[1]);
            if (isNaN(startH) || isNaN(endH)) return;
            if (startH > lastTime) {
                arr.push(`${parseFloat((startH - lastTime).toFixed(2))}on`);
            }
            let dur;
            if (endH < startH) {
                dur = (24 - startH) + endH;
            } else {
                dur = endH - startH;
            }
            if (dur > 0) {
                arr.push(`${parseFloat(dur.toFixed(2))}off`);
            }
            lastTime = startH + dur;
        });
        if (lastTime < 24) {
            arr.push(`${parseFloat((24 - lastTime).toFixed(2))}on`);
        }
        if (arr.length === 0) return "24on";
        return arr.join(',');
    }

    function timeToH(t) { const [h, m] = t.split(':').map(Number); return h + (m / 60); }

    function toggleModal() {
        const modal = document.getElementById('modal');
        modal.classList.toggle('show');
        document.querySelector('.queue-select-btn').classList.toggle('open');
        setTimeout(() => {
            const active = document.querySelector(".q-item.active");
            if (active) scrollToActiveQueue();
        }, 200);
    }

    function selectQueue(q) {
        currentQueue = q; localStorage.setItem('savedQueue', q);
        try { tg.HapticFeedback.selectionChanged(); } catch (e) { }
        toggleModal(); buildMenu(); render(currentTab);
    }

    function buildMenu() {
        const list = document.getElementById('queueList');
        list.innerHTML = '<div style="text-align:center;margin-bottom:15px;color:var(--text-muted);font-size:12px">–û–ë–ï–†–Ü–¢–¨ –ß–ï–†–ì–£</div>';
        const queues = [...new Set(allData.map(i => i.group_id))].sort();
        queues.forEach(q => {
            if (!q) return;
            let d = document.createElement('div');
            d.className = `q-item ${q == currentQueue ? 'active' : ''}`;
            d.innerText = `–ß–µ—Ä–≥–∞ ${q}`;
            d.onclick = () => selectQueue(q);
            list.appendChild(d);
        });
        document.getElementById('queueTitle').innerText = `–ß–ï–†–ì–ê ${currentQueue}`;
    }

        function formatUpdateTime(raw) {
        if (!raw) return "";
        const months = ["—Å—ñ—á–Ω—è", "–ª—é—Ç–æ–≥–æ", "–±–µ—Ä–µ–∑–Ω—è", "–∫–≤—ñ—Ç–Ω—è", "—Ç—Ä–∞–≤–Ω—è", "—á–µ—Ä–≤–Ω—è", "–ª–∏–ø–Ω—è", "—Å–µ—Ä–ø–Ω—è", "–≤–µ—Ä–µ—Å–Ω—è", "–∂–æ–≤—Ç–Ω—è", "–ª–∏—Å—Ç–æ–ø–∞–¥–∞", "–≥—Ä—É–¥–Ω—è"];

        // –†–æ–∑–±–∏–≤–∞—î–º–æ —Ä—è–¥–æ–∫ "25.11.2025 22:25:34" –Ω–∞ –¥–∞—Ç—É —ñ —á–∞—Å
        const [datePart, timePart] = raw.split(" ");

        // üî• –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –¢–£–¢:
        // –ë—É–ª–æ: const [Y, M, D] = datePart.split("-").map(Number);
        // –°—Ç–∞–ª–æ (–¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É 25.11.2025):
        const [D, M, Y] = datePart.split(".").map(Number);

        const [h, m] = timePart.split(":").map(Number);

        const dt = new Date(Y, M - 1, D, h, m);
        const now = new Date();
        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        const yesterday = new Date(today); yesterday.setDate(yesterday.getDate() - 1);
        const dayOnly = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate());

        if (dayOnly.getTime() === today.getTime()) return `–û–Ω–æ–≤–ª–µ–Ω–æ: —Å—å–æ–≥–æ–¥–Ω—ñ –æ ${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}`;
        if (dayOnly.getTime() === yesterday.getTime()) return `–û–Ω–æ–≤–ª–µ–Ω–æ: –≤—á–æ—Ä–∞ –æ ${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}`;

        return `–û–Ω–æ–≤–ª–µ–Ω–æ: ${D} ${months[M - 1]} –æ ${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}`;
    }

    function switchTab(idx) {
        if (currentTab === idx) return;
        try { tg.HapticFeedback.impactOccurred('light'); } catch (e) { }
        const body = document.getElementById("dayBody");
        const dateBox = document.querySelector(".date-box");
        dateBox.classList.add("anim-hide");
        const direction = idx > currentTab ? 1 : -1;
        body.style.transition = "transform .25s ease, opacity .25s ease";
        body.style.transform = `translateX(${-40 * direction}px)`;
        body.style.opacity = "0";
        setTimeout(() => {
            currentTab = idx;
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            document.getElementById("tab" + idx).classList.add("active");
            body.style.transition = "none";
            body.style.transform = `translateX(${40 * direction}px)`;
            body.style.opacity = "0";
            render(idx);
            setTimeout(() => {
                body.style.transition = "transform .25s ease, opacity .25s ease";
                body.style.transform = "translateX(0)";
                body.style.opacity = "1";
                setTimeout(() => {
                    dateBox.classList.remove("anim-hide");
                    dateBox.classList.add("anim-show");
                    setTimeout(() => dateBox.classList.remove("anim-show"), 250);
                }, 40);
            }, 20);
        }, 250);
    }

function render(dayIdx) {
        const row = allData.find(r => r.group_id == currentQueue);
        if (!row) return;

        const targetDate = new Date();
        if (dayIdx === 2) targetDate.setDate(targetDate.getDate() + 1);

        const scheduleStr = getSchedule(row.schedule_text, targetDate);

        const d = String(targetDate.getDate()).padStart(2, '0');
        const m = String(targetDate.getMonth() + 1).padStart(2, '0');
        const daysMap = ["–ù–ï–î–Ü–õ–Ø", "–ü–û–ù–ï–î–Ü–õ–û–ö", "–í–Ü–í–¢–û–†–û–ö", "–°–ï–†–ï–î–ê", "–ß–ï–¢–í–ï–†", "–ü º–Ø–¢–ù–ò–¶–Ø", "–°–£–ë–û–¢–ê"];
        document.getElementById('dateDisplay').innerText = `${daysMap[targetDate.getDay()]} ${d}.${m}`;

        const track = document.getElementById('timelineTrack');
        const iBox = document.getElementById('infoBox');
        const lBox = document.getElementById('timeLabelsBox');
        const tlSec = document.getElementById('timelineSection');
        const totBox = document.getElementById('totalBox');
        const noData = document.getElementById('noDataMessage');
        const batSec = document.getElementById('batterySection');
        const detailBox = document.getElementById('detailCardContainer');
        const appContent = document.getElementById('app-content');

        // –û—á–∏—â–µ–Ω–Ω—è
        track.innerHTML = '';
        while (lBox.firstChild) lBox.removeChild(lBox.firstChild);
        iBox.innerHTML = '';
        detailBox.innerHTML = '';
        detailBox.classList.add('hidden');
        activeSegmentElement = null; activeListCard = null;

        // –ö—É—Ä—Å–æ—Ä
        ensureCursor();
        const tr = document.getElementById('timelineTrack') || document.querySelector('.timeline-track');
        if (tr) tr.appendChild(cursor);
        track.appendChild(cursor);
        cursor.style.display = (dayIdx === 1 ? 'block' : 'none');

        const isToday = (dayIdx === 1);
        document.getElementById("dayTitle").innerText = isToday ? "–ì—Ä–∞—Ñ—ñ–∫ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ" : "–ì—Ä–∞—Ñ—ñ–∫ –Ω–∞ –∑–∞–≤—Ç—Ä–∞";

        const bf = document.getElementById('batteryFill');
        bf.className = 'battery-fill';

        if (!scheduleStr) {
            tlSec.classList.add('hidden'); noData.classList.remove('hidden'); totBox.innerHTML = ''; batSec.classList.remove('hidden');
            document.getElementById('batteryTimer').innerText = "‚Äî";
            document.getElementById('batteryLabel').innerText = "–ù–µ–≤—ñ–¥–æ–º–æ";
            bf.style.width = "100%"; bf.style.background = "#555"; bf.style.boxShadow = "none";
            if (appContent) appContent.classList.remove('hidden');
            return;
        }

        tlSec.classList.remove('hidden'); noData.classList.add('hidden');

        if (!isToday) {
            const t = document.getElementById('batteryTimer').innerText;
            const l = document.getElementById('batteryLabel').innerText;
            document.getElementById('batteryTimer').innerText = t;
            document.getElementById('batteryLabel').innerText = l;
        }

        // --- –ê–Ω–∞–ª—ñ–∑ –∑–∞–≤—Ç—Ä–∞ ---
        let tomorrowFirstOff = null;
        if (isToday) {
            const tmr = new Date(targetDate); tmr.setDate(tmr.getDate() + 1);
            const tmrStr = getSchedule(row.schedule_text, tmr);
            if (tmrStr) {
                const tParts = tmrStr.split(',');
                let firstPart = tParts[0];
                let pType = firstPart.includes('off') ? 'off' : 'on';
                let pDur = parseFloat(firstPart.replace('on', '').replace('off', ''));
                if (pType === 'on') tomorrowFirstOff = pDur; 
            }
        }

        // --- –ê–Ω–∞–ª—ñ–∑ –≤—á–æ—Ä–∞ ---
        let yesterdayExtraOn = 0;
        let yesterdayExtraOff = 0;
        try {
            const yst = new Date(targetDate);
            yst.setDate(yst.getDate() - 1);
            const ystStr = getSchedule(row.schedule_text, yst);
            if (ystStr) {
                const yParts = ystStr.split(',');
                if (yParts.length > 0) {
                    const lastPart = yParts[yParts.length - 1];
                    const dur = parseFloat(lastPart.replace('on', '').replace('off', ''));
                    if (!isNaN(dur)) {
                        if (lastPart.includes('on')) yesterdayExtraOn = dur;
                        else yesterdayExtraOff = dur;
                    }
                }
            }
        } catch (e) { console.warn("Err yesterday", e); }

        let curH = 0; let totOff = 0;
        const now = new Date();
        const curFloat = now.getHours() + now.getMinutes() / 60 + now.getSeconds() / 3600;
        let foundState = false;
        let lastEndH = 0;
        let lastOffEndH = 0;

        addLabel(lBox, 0, "00:00", "start");

        const parts = scheduleStr.split(',');
        
        /* --- –ì–û–õ–û–í–ù–ò–ô –¶–ò–ö–õ --- */
        parts.forEach((part, index) => {
            let type = part.includes('off') ? 'off' : 'on';
            let dur = parseFloat(part.replace('on', '').replace('off', ''));
            if (isNaN(dur) || dur <= 0) return;
            
            let segStart = curH;
            let endH = curH + dur;
            let mathEndH = endH; 
            let displayEndH = endH;
            let fullDuration = dur;
            let connectsToTomorrow = false;

            if (type === 'off') lastOffEndH = endH;

            // –õ–æ–≥—ñ–∫–∞ —Å–∫–ª–µ—é–≤–∞–Ω–Ω—è –¥–Ω—ñ–≤
            if (Math.abs(endH - 24) < 0.1) {
                if (type === 'on' && tomorrowFirstOff !== null && tomorrowFirstOff > 0) {
                    connectsToTomorrow = true;
                    mathEndH = 24 + tomorrowFirstOff;
                    fullDuration += tomorrowFirstOff;
                    displayEndH = mathEndH; 
                }
            }

            // –ö–æ—Ä–µ–∫—Ü—ñ—è –ø–µ—Ä—à–æ–≥–æ –±–ª–æ–∫—É (–≤—á–æ—Ä–∞)
            let realStartH = segStart;
            if (index === 0) {
                if (type === 'on' && yesterdayExtraOn > 0) {
                    realStartH = 24 - yesterdayExtraOn;
                    fullDuration += yesterdayExtraOn; 
                }
                if (type === 'off' && yesterdayExtraOff > 0) {
                    let partYesterday = yesterdayExtraOff - dur;
                    realStartH = 24 - (yesterdayExtraOff > dur ? dur : yesterdayExtraOff);
                    if (type === 'off') fullDuration = yesterdayExtraOff; 
                }
            }

            const isActiveNow = (isToday && curFloat >= segStart && curFloat < endH);

            // --- –¢–ê–ô–ú–õ–ê–ô–ù ---
            let seg = document.createElement('div');
            seg.className = `segment ${type}`;
            if (isActiveNow) seg.classList.add('active-segment');
            seg.style.flexGrow = dur; 
            seg.style.flexBasis = '0';
            track.appendChild(seg);
            
            if (endH < 23.9 && (endH - lastEndH) > 2.0 && (24 - endH) > 1.5) {
                addLabel(lBox, endH, formatHM(endH), "mid"); lastEndH = endH;
            }

            seg.addEventListener('click', () => handleSegmentClick(seg, type, realStartH, displayEndH, fullDuration));


            // --- üî• –ì–û–¢–£–Ñ–ú–û –í–ú–Ü–°–¢ –ö–ê–†–¢–ö–ò ---
            
            let headerTimerHtml = "";
            if (isActiveNow) {
                const remaining = mathEndH - curFloat;
                const remText = fmtDur(remaining);
                headerTimerHtml = `<span class="mini-timer">‚è≥ ${remText}</span>`;
            }

            // 2. –î–µ—Ç–∞–ª—å–Ω–∏–π —Ç–µ–∫—Å—Ç (Body)
            let detailsHtml = "";
            
            let timeRangeMessage = "";
            if (type === 'on') {
                if (index === 0 && yesterdayExtraOn > 0) {
                    timeRangeMessage = `–°–≤—ñ—Ç–ª–æ —É–≤—ñ–º–∫–Ω—É–ª–∏ —â–µ <b>–≤—á–æ—Ä–∞ –æ ${formatHM(realStartH)}</b>. (—â–µ –¥–æ –ø—ñ–≤–Ω–æ—á—ñ).`;
                } else {
                    timeRangeMessage = `–°–≤—ñ—Ç–ª–æ –±—É–¥–µ –∑ <b>${formatHM(realStartH)}</b> –¥–æ <b>${formatHM(displayEndH)}</b>.`;
                }
            } else {
                timeRangeMessage = `–°–≤—ñ—Ç–ª–æ –±—É–¥–µ –≤–∏–º–∫–Ω–µ–Ω–µ –æ <b>${formatHM(realStartH)}</b> —ñ –ø–æ–≤–µ—Ä–Ω–µ—Ç—å—Å—è –æ <b>${formatHM(displayEndH)}</b>.`;
            }
            detailsHtml += `<p>${timeRangeMessage}</p>`;
            
            const durTxt = fmtDur(fullDuration);
            let totalDurationMsg = type === 'on' 
                ? `–ó–∞–≥–∞–ª—å–Ω–∞ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å: <b>${durTxt}</b>.` 
                : `–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è: <b>${durTxt}</b>.`;

            if (!(index === 0 && yesterdayExtraOn > 0 && type === 'on')) {
                 detailsHtml += `<p>${totalDurationMsg}</p>`;
            }


            // 3. –ù–∞—Å—Ç—É–ø–Ω–∞ –¥—ñ—è / –°—Ç–∞—Ç—É—Å
            if (type === 'on') {
                if (connectsToTomorrow) {
                    detailsHtml += `<p>–ù–∞—Å—Ç—É–ø–Ω–µ –≤–∏–º–∫–Ω–µ–Ω–Ω—è –æ—á—ñ–∫—É—î—Ç—å—Å—è <b>–∑–∞–≤—Ç—Ä–∞ –æ ${formatHM(tomorrowFirstOff)}</b>.</p>`;
                } else if (Math.abs(endH - 24) < 0.1) {
                    detailsHtml += `<p>–ù–∞—Å—Ç—É–ø–Ω–µ –≤–∏–º–∫–Ω–µ–Ω–Ω—è –æ—á—ñ–∫—É—î—Ç—å—Å—è <b>—Ä—ñ–≤–Ω–æ –æ –ø—ñ–≤–Ω–æ—á—ñ</b>.</p>`;
                } else {
                    detailsHtml += `<p>–ù–∞—Å—Ç—É–ø–Ω–µ –≤–∏–º–∫–Ω–µ–Ω–Ω—è –æ—á—ñ–∫—É—î—Ç—å—Å—è –æ <b>${formatHM(displayEndH)}</b>.</p>`;
                }
            } else {
                 detailsHtml += `<p>–ü–ª–∞–Ω–æ–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è.</p>`; 
            }
            

            detailsHtml += `<p class="detail-note" style="margin-top:8px; opacity:0.5"><i>* –ú–æ–∂–ª–∏–≤–∞ –Ω–µ–≤–µ–ª–∏–∫–∞ –ø–æ—Ö–∏–±–∫–∞ —É —á–∞—Å—ñ.</i></p>`;


            // --- –°–¢–í–û–†–ï–ù–ù–Ø –ö–ê–†–¢–ö–ò –í–†–£–ß–ù–£ ---
            let card = document.createElement('div');
            card.className = `card c-${type}`;
            
            let statusLabel = type === 'on' ? '–°–í–Ü–¢–õ–û –Ñ' : '–í–Ü–î–ö–õ–Æ–ß–ï–ù–ù–Ø';
            
            card.innerHTML = `
                <div class="card-header">
                    <div class="card-info">
                        <div class="c-icon">${type === 'on' ? 'üí°' : 'üîå'}</div>
                        <div class="c-times">
                            <div class="status-label">
                                ${statusLabel}${headerTimerHtml}
                            </div>
                            <div class="c-time">${formatHM(realStartH)} - ${formatHM(displayEndH)}</div>
                        </div>
                    </div>
                    
                    <div class="c-dur">${fmtDur(fullDuration)}</div>
                </div>
                
                <div class="card-details">${detailsHtml}</div>
                <div class="card-progress-track">
                    <div class="card-progress-fill" style="width: 0%"></div>
                </div>
            `;

            // –õ–æ–≥—ñ–∫–∞ —Ä–æ–∑–∫—Ä–∏—Ç—Ç—è
            card.addEventListener("click", (ev) => {
                ev.stopPropagation();
                if (activeListCard === card) {
                    card.classList.remove("expanded");
                    activeListCard = null;
                    return;
                }
                if (activeListCard) { activeListCard.classList.remove("expanded"); }
                card.classList.add("expanded");
                activeListCard = card;
            });


            // --- üî• –ê–ö–¢–ò–í–ù–ò–ô –°–¢–ê–ù: –§–Ü–ö–° –ü–†–û–ì–†–ï–°-–ë–ê–†–£ ---
            if (isActiveNow) {
                card.classList.add('active-now');
                
                // üî• NEW LOGIC: Use full duration and calculate elapsed time since true start
                const totalLen = fullDuration; 
                const remaining = mathEndH - curFloat; 
                const passed = totalLen - remaining; 

                let percent = (passed / totalLen) * 100;
                percent = Math.max(0, Math.min(100, percent));

                const bar = card.querySelector('.card-progress-fill');
                if (bar) bar.style.width = `${percent}%`;
                
                // –ë–∞—Ç–∞—Ä–µ–π–∫–∞
                if (!foundState) {
                    foundState = true;
                    // üî• –í–∏–∫–ª–∏–∫ —Ç–∞–π–º–µ—Ä–∞ –∑ –ø–æ–≤–Ω–∏–º –¥—ñ–∞–ø–∞–∑–æ–Ω–æ–º
                    startTimer(mathEndH, Math.floor(fullDuration * 3600), type === 'on');
                }
            }

            iBox.appendChild(card);
            if (type === 'off') totOff += dur;
            curH = endH;
        });

        addLabel(lBox, 24, "24:00", "end");

        if (isToday && !foundState) {
            if (totOff === 0) {
                 if (tomorrowFirstOff !== null && tomorrowFirstOff > 0) {
                    const targetH = 24 + tomorrowFirstOff;
                    const totalSec = Math.floor(((targetH - 0) + yesterdayExtraOn) * 3600);
                    startTimer(targetH, totalSec, true);
                 } else { setGreenBattery(); }
            } else if (tomorrowFirstOff !== null && tomorrowFirstOff > 0) {
                const targetH = 24 + tomorrowFirstOff;
                const totalSec = Math.floor((targetH - lastOffEndH) * 3600);
                startTimer(targetH, totalSec, true);
            } else { setGreenBattery(); }
        }

        totBox.innerHTML = `–í—Å—å–æ–≥–æ –±–µ–∑ —Å–≤—ñ—Ç–ª–∞: <b>${fmtDur(totOff)}</b>`;

        const shareWrap = document.getElementById("shareWrapper");
        shareWrap.classList.remove("hidden");
        if (!shareWrap.classList.contains("fade-in")) setTimeout(() => shareWrap.classList.add("fade-in"), 150);
        if (appContent) appContent.classList.remove('hidden');
    }

    function handleSegmentClick(segEl, type, startH, endH, durH) {
        const detailBox = document.getElementById('detailCardContainer');
        const cursorEl = document.getElementById('timeline-cursor');

        // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —á–∏ –∫—É—Ä—Å–æ—Ä –Ω–∞–¥ —Ü–∏–º —Å–µ–≥–º–µ–Ω—Ç–æ–º
        const now = new Date();
        const curFloat = now.getHours() + now.getMinutes() / 60 + now.getSeconds() / 3600;
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —Ü–µ —Å—å–æ–≥–æ–¥–Ω—ñ —ñ —á–∏ —á–∞—Å –≤—Ö–æ–¥–∏—Ç—å –≤ –º–µ–∂—ñ —Å–µ–≥–º–µ–Ω—Ç–∞
        // (currentTab === 1 –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —â–æ –º–∏ –Ω–∞ –≤–∫–ª–∞–¥—Ü—ñ "–°—å–æ–≥–æ–¥–Ω—ñ")
        const isCursorOnThisSegment = (currentTab === 1) && (curFloat >= startH && curFloat < endH);

        // --- –õ–û–ì–Ü–ö–ê –ó–ê–ö–†–ò–¢–¢–Ø (–Ø–∫—â–æ –∫–ª—ñ–∫–Ω—É–ª–∏ –Ω–∞ –≤–∂–µ –∞–∫—Ç–∏–≤–Ω–∏–π) ---
        if (activeSegmentElement === segEl) {
            segEl.classList.remove('segment-selected');
            
            // üî• –û–ü–£–°–ö–ê–Ñ–ú–û –ö–£–†–°–û–† –ù–ê–ó–ê–î
            if (cursorEl) cursorEl.classList.remove('cursor-elevated');

            const card = detailBox.querySelector('.detail-card');

            if (card) {
                const box = detailBox;
                const startHeight = box.scrollHeight;

                box.style.height = startHeight + "px";
                void box.offsetHeight;
                box.style.transition = "height 0.28s ease";
                box.style.height = "0px";

                card.classList.add("closing");

                box.addEventListener("transitionend", () => {
                    box.style.transition = "";
                    box.style.height = "";
                    box.classList.add("hidden");
                    box.innerHTML = "";
                    activeSegmentElement = null;
                }, { once: true });

            } else {
                detailBox.classList.add("hidden");
                detailBox.innerHTML = "";
                activeSegmentElement = null;
            }
            return;
        }

        // --- –õ–û–ì–Ü–ö–ê –í–Ü–î–ö–†–ò–¢–¢–Ø (–ù–æ–≤–∏–π —Å–µ–≥–º–µ–Ω—Ç) ---
        
        // –ó–Ω—ñ–º–∞—î–º–æ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ
        if (activeSegmentElement) {
            activeSegmentElement.classList.remove('segment-selected');
        }

        // –í–∏–¥—ñ–ª—è—î–º–æ –Ω–æ–≤–∏–π
        activeSegmentElement = segEl;
        segEl.classList.add('segment-selected');

        // üî• –õ–û–ì–Ü–ö–ê –î–õ–Ø –ö–£–†–°–û–†–ê:
        // –°–ø–æ—á–∞—Ç–∫—É —Å–∫–∏–¥–∞—î–º–æ (–Ω–∞ –≤–∏–ø–∞–¥–æ–∫ –ø–µ—Ä–µ—Ö–æ–¥—É –∑ —ñ–Ω—à–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞)
        if (cursorEl) cursorEl.classList.remove('cursor-elevated');
        
        // –Ø–∫—â–æ –∫—É—Ä—Å–æ—Ä —Ñ—ñ–∑–∏—á–Ω–æ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —á–∞—Å—ñ —Ü—å–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ ‚Äî –ø—ñ–¥–Ω—ñ–º–∞—î–º–æ –π–æ–≥–æ
        if (isCursorOnThisSegment && cursorEl) {
            cursorEl.classList.add('cursor-elevated');
        }

        showDetailCard(type, startH, endH, durH);

        const box = detailBox;
        box.classList.remove("hidden");

        box.style.height = "auto";
        const targetHeight = box.scrollHeight;

        box.style.height = "0px";
        void box.offsetHeight;

        box.style.transition = "height 0.28s ease";
        box.style.height = targetHeight + "px";

        box.addEventListener("transitionend", () => {
            box.style.transition = "";
            box.style.height = "auto";
        }, { once: true });

        try { tg.HapticFeedback.selectionChanged(); } catch (e) {}
    }


    function showDetailCard(type, startH, endH, durH) {
        const box = document.getElementById('detailCardContainer');
        if (!box) return;
        const startStr = formatHM(startH);
        const endStr = formatHM(endH);
        const durStr = fmtDur(durH);
        let titleStatus, icon, headerClass, bodyHtml;
        
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ —ñ–Ω—Ç–µ—Ä–≤–∞–ª –ø–æ—á–∞–≤—Å—è –≤—á–æ—Ä–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 23:00 - 01:00)
        const isOvernight = startH > endH; 

        if (type === 'on') {
            titleStatus = '–°–í–Ü–¢–õ–û –Ñ'; icon = 'üí°'; headerClass = 'detail-status-on';
            
            // üî• –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∫—ñ–Ω–µ—Ü—å –≤–∏—Ö–æ–¥–∏—Ç—å –∑–∞ –º–µ–∂—ñ 24 –≥–æ–¥–∏–Ω
            let nextOffText = `–ù–∞—Å—Ç—É–ø–Ω–µ –≤–∏–º–∫–Ω–µ–Ω–Ω—è –æ—á—ñ–∫—É—î—Ç—å—Å—è –æ <b>${endStr}</b>.`;
            if (endH >= 24) {
                 nextOffText = `–ù–∞—Å—Ç—É–ø–Ω–µ –≤–∏–º–∫–Ω–µ–Ω–Ω—è –æ—á—ñ–∫—É—î—Ç—å—Å—è <b>–∑–∞–≤—Ç—Ä–∞ –æ ${endStr}</b>.`;
            }

            if (isOvernight) {
                 bodyHtml = `<p>–°–≤—ñ—Ç–ª–æ —É–≤—ñ–º–∫–Ω—É–ª–∏ –≤—á–æ—Ä–∞ –æ <b>${startStr}</b>, –≤–∏–º–∫–Ω–µ–Ω–Ω—è –æ—á—ñ–∫—É—î—Ç—å—Å—è –æ <b>${endStr}</b>.</p>`;
            } else {
                 bodyHtml = `<p>–°–≤—ñ—Ç–ª–æ –±—É–¥–µ –∑ <b>${startStr}</b> –¥–æ <b>${endStr}</b>.</p><p>${nextOffText}</p>`;
            }

        } else {
            titleStatus = '–í–Ü–î–ö–õ–Æ–ß–ï–ù–ù–Ø'; icon = 'üîå'; headerClass = 'detail-status-off';
            
            if (isOvernight) {
                bodyHtml = `<p>–í–∏–º–∫–Ω–µ–Ω–Ω—è —Ç—Ä–∏–≤–∞—î –∑ –≤—á–æ—Ä–∞ <b>(${startStr})</b> —ñ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –æ <b>${endStr}</b>.</p><p>–ü–ª–∞–Ω–æ–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è.</p>`;
            } else {
                // –Ø–∫—â–æ –∫—ñ–Ω–µ—Ü—å > 24, –ø–∏—à–µ–º–æ "–ø–æ–≤–µ—Ä–Ω–µ—Ç—å—Å—è –∑–∞–≤—Ç—Ä–∞"
                if (endH >= 24) {
                    bodyHtml = `<p>–°–≤—ñ—Ç–ª–æ –±—É–¥–µ –≤–∏–º–∫–Ω–µ–Ω–µ –æ <b>${startStr}</b> —ñ –ø–æ–≤–µ—Ä–Ω–µ—Ç—å—Å—è <b>–∑–∞–≤—Ç—Ä–∞ –æ ${endStr}</b>.</p><p>–ü–ª–∞–Ω–æ–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è.</p>`;
                } else {
                    bodyHtml = `<p>–°–≤—ñ—Ç–ª–æ –±—É–¥–µ –≤–∏–º–∫–Ω–µ–Ω–µ –æ <b>${startStr}</b> —ñ –ø–æ–≤–µ—Ä–Ω–µ—Ç—å—Å—è –æ <b>${endStr}</b>.</p><p>–ü–ª–∞–Ω–æ–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è.</p>`;
                }
            }
        }
        
        box.classList.remove('hidden');
        box.innerHTML = `
            <div class="detail-card ${type === 'on' ? 'on' : 'off'}">
                <div class="detail-header">
                    <div class="detail-left">
                        <div class="detail-icon">${icon}</div>
                        <div class="detail-main">
                            <div class="detail-status ${headerClass}">${titleStatus}</div>
                            <div class="detail-time">${startStr} - ${endStr}</div>
                        </div>
                    </div>
                    <div class="detail-duration">${durStr}</div>
                </div>
                <div class="detail-divider"></div>
                <div class="detail-body">
                    ${bodyHtml}
                    <p class="detail-note">* –í–∫–ª—é—á–µ–Ω–Ω—è/–≤–∏–º–∫–Ω–µ–Ω–Ω—è –º–æ–∂–µ –≤—ñ–¥–±—É–≤–∞—Ç–∏—Å—è –∑ –Ω–µ–≤–µ–ª–∏–∫–æ—é –ø–æ—Ö–∏–±–∫–æ—é —É —á–∞—Å—ñ.</p>
                </div>
            </div>`;
    }

    function createCard(s, e, d, type, nextOffInfo = null, customMainText = null) {
        let c = document.createElement('div');
        c.className = `card c-${type}`;
        let detailsHtml = '';

        if (type === 'on') {
            let nextStr = `–ù–∞—Å—Ç—É–ø–Ω–µ –≤–∏–º–∫–Ω–µ–Ω–Ω—è –æ—á—ñ–∫—É—î—Ç—å—Å—è –æ <b>${formatHM(e)}</b>.`;
            if (nextOffInfo) nextStr = nextOffInfo;

            // üî• –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –Ø–∫—â–æ —î —Å–ø–µ—Ü. —Ç–µ–∫—Å—Ç (–ø—Ä–æ –≤—á–æ—Ä–∞), –±–µ—Ä–µ–º–æ –π–æ–≥–æ. –Ø–∫—â–æ –Ω—ñ ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π.
            let mainMessage = customMainText 
                ? customMainText 
                : `–°–≤—ñ—Ç–ª–æ –±—É–¥–µ –∑ <b>${formatHM(s)}</b> –¥–æ <b>${formatHM(e)}</b>.`;

            detailsHtml = `${mainMessage}<br>${nextStr}<br><br><i>* –í–∫–ª—é—á–µ–Ω–Ω—è/–≤–∏–º–∫–Ω–µ–Ω–Ω—è –º–æ–∂–µ –±—É—Ç–∏ –∑ –Ω–µ–≤–µ–ª–∏–∫–æ—é –ø–æ—Ö–∏–±–∫–æ—é.</i>`;
        
        } else {
            let mainStr = `–°–≤—ñ—Ç–ª–æ –±—É–¥–µ –≤–∏–º–∫–Ω–µ–Ω–µ –æ <b>${formatHM(s)}</b> —ñ –ø–æ–≤–µ—Ä–Ω–µ—Ç—å—Å—è –æ <b>${formatHM(e)}</b>.`;
            if (customMainText) mainStr = customMainText;
            
            detailsHtml = `${mainStr}<br>–ü–ª–∞–Ω–æ–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è.<br><br><i>* –í–∫–ª—é—á–µ–Ω–Ω—è/–≤–∏–º–∫–Ω–µ–Ω–Ω—è –º–æ–∂–µ –≤—ñ–¥–±—É–≤–∞—Ç–∏—Å—è –∑ –Ω–µ–≤–µ–ª–∏–∫–æ—é –ø–æ—Ö–∏–±–∫–æ—é —É —á–∞—Å—ñ.</i>`;
        }

        c.innerHTML = `
            <div class="card-header">
                <div class="card-info">
                    <div class="c-icon">${type === 'on' ? 'üí°' : 'üîå'}</div>
                    <div class="c-times">
                        <div class="status-label">${type === 'on' ? '–°–í–Ü–¢–õ–û –Ñ' : '–í–Ü–î–ö–õ–Æ–ß–ï–ù–ù–Ø'}</div>
                        <div class="c-time">${formatHM(s)} - ${formatHM(e)}</div>
                    </div>
                </div>
                <div class="c-dur">${fmtDur(d)}</div>
            </div>
            <div class="card-details">${detailsHtml}</div>
            
            <div class="card-progress-track">
                <div class="card-progress-fill" style="width: 0%"></div>
            </div>
        `;
            
        c.addEventListener("click", (ev) => {
            ev.stopPropagation();
            if (activeListCard === c) {
                c.classList.remove("expanded");
                activeListCard = null;
                return;
            }
            if (activeListCard) { activeListCard.classList.remove("expanded"); }
            c.classList.add("expanded");
            activeListCard = c;
        });
        return c;
    }

    function setGreenBattery() {
        const f = document.getElementById('batteryFill');
        const tip = document.querySelector('.battery-tip');
        const label = document.getElementById('batteryLabel');
        f.classList.remove('discharging');
        f.style.width = "100%";
        f.style.background = "linear-gradient(90deg, #1abc9c, #2ecc71)";
        f.style.boxShadow = "0 0 15px #2ecc71";
        if (tip) {
            tip.style.background = "#2ecc71";
            tip.style.boxShadow = "0 0 10px #2ecc71";
        }
        document.getElementById('batteryTimer').innerText = "";
        clearInterval(countdownInterval);
        label.innerText = "–í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —â–µ –Ω–µ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ";
    }

    function setBat(pct, isOn, customText = null) {
        pct = Math.min(Math.max(pct, 0), 1);

        const f = document.getElementById('batteryFill');
        const label = document.getElementById('batteryLabel');
        const tip = document.querySelector('.battery-tip');
        
        // üî• –ü–†–ê–í–ò–õ–¨–ù–ê –ü–ï–†–ï–í–Ü–†–ö–ê –¢–ï–ú–ò (—á–µ—Ä–µ–∑ –∞—Ç—Ä–∏–±—É—Ç, –∞ –Ω–µ –∫–ª–∞—Å)
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const isLightMode = (currentTheme === 'light');

        let visualPct;
        let hue;

        if (isOn) {
            visualPct = pct;
            hue = visualPct * 120; 
            f.classList.add('discharging');
        } else {
            visualPct = 1 - pct;
            hue = visualPct * 120;
            f.classList.remove('discharging');
        }

        // –ö–æ–ª—ñ—Ä —Å–∞–º–æ—ó –±–∞—Ç–∞—Ä–µ–π–∫–∏ (–∑–∞–≤–∂–¥–∏ —è—Å–∫—Ä–∞–≤–∏–π)
        const batColor = `hsl(${hue}, 90%, 50%)`;
        
        f.style.width = Math.max(visualPct * 100, 0) + "%";
        f.style.background = batColor;
        f.style.boxShadow = `0 0 12px ${batColor}`;

        if (tip) {
            tip.style.background = batColor;
        }

        // üî• –õ–û–ì–Ü–ö–ê –ö–û–õ–¨–û–†–£ –¢–ï–ö–°–¢–£
        let textColor;
        let textShadow;

        if (isLightMode) {
            // ‚ö™Ô∏è –î–õ–Ø –°–í–Ü–¢–õ–û–á –¢–ï–ú–ò:
            // –†–æ–±–∏–º–æ —Ç–µ–º–Ω–∏–π, –Ω–∞—Å–∏—á–µ–Ω–∏–π –∫–æ–ª—ñ—Ä (lightness 35%), —â–æ–± —á–∏—Ç–∞–ª–æ—Å—å –Ω–∞ –±—ñ–ª–æ–º—É
            textColor = `hsl(${hue}, 90%, 35%)`; 
            textShadow = `none`; 
        } else {
            // ‚ö´Ô∏è –î–õ–Ø –¢–ï–ú–ù–û–á –¢–ï–ú–ò:
            // –Ø—Å–∫—Ä–∞–≤–∏–π –Ω–µ–æ–Ω
            textColor = `hsl(${hue}, 90%, 50%)`;
            textShadow = `0 0 10px hsla(${hue}, 90%, 50%, 0.6)`;
        }

        // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ
        label.style.color = textColor;
        label.style.textShadow = textShadow;

        if (customText) {
            label.innerText = customText;
        } else {
            label.innerText = isOn ? "–î–æ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è" : "–î–æ –≤–∫–ª—é—á–µ–Ω–Ω—è";
        }
    }


    function updateNativeShareLink() {
        const text = `‚ö°Ô∏è –Ø –∫–æ—Ä–∏—Å—Ç—É—é—Å—å –±–æ—Ç–æ–º –¥–ª—è —Å–≤—ñ—Ç–ª–∞ —É –ë—Ä–æ–≤–∞—Ä–∞—Ö. –ú–æ—è —á–µ—Ä–≥–∞ ${currentQueue}. –ü—Ä–∏—î–¥–Ω—É–π—Å—è!`;
        const url = "https://t.me/SvitloBroBot";
        document.getElementById("telegramShareNative").href = "https://t.me/share/url?url=" + encodeURIComponent(url) + "&text=" + encodeURIComponent(text);
    }

    function updateDonateUI(amount, goal) {
        const target = goal > 0 ? goal : (amount > 0 ? amount * 1.2 : 5000);
        let pct = (amount / target) * 100;
        if (pct > 100) pct = 100;
        const progress = document.getElementById('donateProgress');
        if (progress) progress.style.width = `${pct}%`;
        const fmtAmount = amount.toLocaleString('uk-UA', { maximumFractionDigits: 0 });
        const fmtGoal = target.toLocaleString('uk-UA', { maximumFractionDigits: 0 });
        const amountEl = document.getElementById('donateAmount');
        if (amountEl) {
            if (goal > 0) {
                amountEl.innerText = `${fmtAmount} / ${fmtGoal} ‚Ç¥`;
            } else {
                amountEl.innerText = `${fmtAmount} ‚Ç¥`;
            }
        }
    }

function checkDonatePopup() {
            // 1. –û—Ç—Ä–∏–º—É—î–º–æ —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—é –¥–∞—Ç—É
            const today = new Date().toLocaleDateString();

            // 2. –î—ñ—Å—Ç–∞—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑ –ø–∞–º'—è—Ç—ñ
            let data = JSON.parse(localStorage.getItem('launch_stats') || '{"date": "", "count": 0}');

            // 3. –õ–æ–≥—ñ–∫–∞ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞
            if (data.date !== today) {
                data.date = today;
                data.count = 1;
            } else {
                data.count++;
            }

            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ
            localStorage.setItem('launch_stats', JSON.stringify(data));

            // –£–º–æ–≤–∞: 2-–π, 5-–π –∞–±–æ 8-–π –≤—Ö—ñ–¥ –∑–∞ –¥–µ–Ω—å
            if (data.count === 2 || data.count === 5 || data.count === 8) {

                // –ó–∞—Ç—Ä–∏–º–∫–∞ 7 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    const overlay = document.getElementById('infoModal');
                    const title = document.getElementById('infoTitle');
                    const text = document.getElementById('infoText');

                    title.innerText = "";

                    text.innerHTML = `
                        <div class="donate-hero">
                            <span class="donate-emoji-big">üíö</span>
                            <h3 style="margin:0; color:var(--text-main); font-size:22px;">–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ—î–∫—Ç</h3>

                            <p style="font-size:14px; color:var(--text-muted); margin-top:12px; line-height:1.5;">
                                –î—Ä—É–∑—ñ, —è–∫—â–æ –Ω–∞—à –±–æ—Ç –¥–æ–ø–æ–º–∞–≥–∞—î –≤–∞–º –æ—Ä—ñ—î–Ω—Ç—É–≤–∞—Ç–∏—Å—å —É –≥—Ä–∞—Ñ—ñ–∫–∞—Ö —Ç–∞ –≤—á–∞—Å–Ω–æ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ —Å–≤—ñ—Ç–ª–æ ‚Äî –±—É–¥–µ–º–æ –≤–¥—è—á–Ω—ñ –∑–∞ –≤–∞—à—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É.
                            </p>
                            <p style="font-size:14px; color:var(--text-muted); margin-top:8px; line-height:1.5;">
                                –ù–∞–≤—ñ—Ç—å –Ω–µ–≤–µ–ª–∏–∫–∏–π –≤–Ω–µ—Å–æ–∫ –¥–æ–ø–æ–º–∞–≥–∞—î –Ω–∞–º –ø–æ–∫—Ä–∏–≤–∞—Ç–∏ –≤–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∏ —Ç–∞ —Ä–æ–∑–≤–∏—Ç–æ–∫ –ø—Ä–æ—î–∫—Ç—É.
                            </p>
                        </div>

                        <a href="https://send.monobank.ua/jar/6qoHuhpGgD" target="_blank" class="btn-mono">
                            <span style="font-size:20px">üêà‚Äç‚¨õ</span>
                            <span>Monobank (–ë–∞–Ω–∫–∞)</span>
                        </a>

                        <div class="donate-divider">–∞–±–æ –∫–∞—Ä—Ç–∫–∞</div>

                        <div class="card-copy-box" onclick="copyDonateCard(this)">
                            <span class="cc-num">4874 1000 2226 7572</span>
                            <span class="cc-icon">üìã</span>
                        </div>

                        <p style="font-size:12px; color:var(--text-muted); text-align:center; margin-top:12px; opacity:0.6">
                            –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –Ω–æ–º–µ—Ä, —â–æ–± —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏
                        </p>
                    `;

                    overlay.classList.add('show');
                    try { tg.HapticFeedback.notificationOccurred('success'); } catch(e){}
                }, 7000);
            }
        }

        function copyDonateCard(element) {
            const cardNumber = "4874100022267572";
            const numSpan = element.querySelector('.cc-num');
            const iconSpan = element.querySelector('.cc-icon');

            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Å—Ç–∞—Ä–∏–π —Ç–µ–∫—Å—Ç
            const originalNum = numSpan ? numSpan.innerText : cardNumber;
            const originalIcon = iconSpan ? iconSpan.innerText : "üìã";

            navigator.clipboard.writeText(cardNumber).then(() => {
                // –ï—Ñ–µ–∫—Ç —É—Å–ø—ñ—Ö—É
                element.style.borderColor = "#2ecc71";
                element.style.background = "rgba(46, 204, 113, 0.1)";

                if(numSpan) numSpan.innerText = "–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ! ‚úÖ";
                if(iconSpan) iconSpan.innerText = "";

                try { tg.HapticFeedback.notificationOccurred('success'); } catch(e){}

                // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –Ω–∞–∑–∞–¥ —á–µ—Ä–µ–∑ 2 —Å–µ–∫
                setTimeout(() => {
                    element.style.borderColor = "rgba(255, 255, 255, 0.2)";
                    element.style.background = "rgba(255, 255, 255, 0.08)";
                    if(numSpan) numSpan.innerText = originalNum;
                    if(iconSpan) iconSpan.innerText = originalIcon;
                }, 2000);
            });
        }

    function closeInfo() {
        document.getElementById('infoModal').classList.remove('show');
    }

    let currentDayNum = new Date().getDate();
    setInterval(() => {
        const now = new Date();
        if (now.getDate() !== currentDayNum) { currentDayNum = now.getDate(); init(); }
    }, 1000);

    init();

        document.body.classList.add("no-anim");

        setTimeout(() => {
            document.body.classList.remove("no-anim");
            fetchDonation();

            // üëá –¶–ï–ô –†–Ø–î–û–ö –û–ë–û–í'–Ø–ó–ö–û–í–û –ú–ê–Ñ –ë–£–¢–ò –¢–£–¢:
            checkDonatePopup();

        }, 300);
    </script>
</body>
</html>
