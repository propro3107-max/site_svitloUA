<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>SvitloUA –ö–∏—ó–≤—â–∏–Ω–∞ ‚Äî –≥—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Light Theme Variables */
            --bg-gradient: radial-gradient(circle at top left, #f8fbff 0, #edf4ff 30%, #f5f0ff 60%, #f9fafc 100%);
            --primary: #2563eb;
            --text-main: #0f172a;
            --text-muted: #6b7280;
            --surface: #ffffff;
            --surface-soft: rgba(255,255,255,0.7);
            --border-subtle: rgba(148,163,184,0.25);
            --shadow-soft: 0 18px 45px rgba(15,23,42,0.10);
            --timeline-bg: #e5e7eb;
            --timeline-off-bg: linear-gradient(90deg, #0f172a, #111827);
            --countdown-bg: linear-gradient(145deg, #0f172a, #020617);
            --countdown-color: #e5e7eb;
            
            /* –ù–æ–≤—ñ –∑–º—ñ–Ω–Ω—ñ –¥–ª—è —Å—Ç–∞—Ç—É—Å—ñ–≤ (–°–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞) */
            --status-on-bg: #dcfce7;
            --status-on-text: #15803d;
            --status-on-border: #bbf7d0;
            
            --status-off-bg: #fee2e2;
            --status-off-text: #b91c1c;
            --status-off-border: #fecaca;
            
            --chart-on: #22c55e;
            --chart-off: #ef4444;

            --radius-lg: 26px;
            --radius-pill: 999px;
        }

        /* Dark Theme Overrides */
        body.dark-mode {
            --bg-gradient: linear-gradient(135deg, #090a19 0%, #151928 100%);
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --surface: #1e293b;
            --surface-soft: rgba(30,41,59,0.7);
            --border-subtle: rgba(255,255,255,0.12);
            --shadow-soft: 0 18px 45px rgba(0,0,0,0.40);
            --timeline-bg: #334155;
            
            /* –ê–¥–∞–ø—Ç–∞—Ü—ñ—è —Å—Ç–∞—Ç—É—Å—ñ–≤ –ø—ñ–¥ —Ç–µ–º–Ω—É —Ç–µ–º—É (–Ω–∞–ø—ñ–≤–ø—Ä–æ–∑–æ—Ä—ñ) */
            --status-on-bg: rgba(34,197,94,0.15);
            --status-on-text: #4ade80;
            --status-on-border: rgba(34,197,94,0.3);
            
            --status-off-bg: rgba(239,68,68,0.15);
            --status-off-text: #f87171;
            --status-off-border: rgba(239,68,68,0.3);
            
            --chart-on: #22c55e;
            --chart-off: #ef4444;
        }

        /* General Styles */
        * { box-sizing: border-box; }
        html, body {
            margin: 0; padding: 0;
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            color: var(--text-main);
            background: var(--bg-gradient);
            transition: background-color 0.3s, color 0.3s;
        }
        body { min-height: 100vh; display: flex; flex-direction: column; }
        .page {
            padding: 16px 12px 24px; /* –ú–µ–Ω—à—ñ –≤—ñ–¥—Å—Ç—É–ø–∏ –ø–æ –±–æ–∫–∞—Ö */
            width: 100%;
        }

        /* HEADER */
        .top-bar {
            display: flex;
            flex-wrap: wrap; /* –î–æ–∑–≤–æ–ª—è—î–º–æ –ø–µ—Ä–µ–Ω–æ—Å –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ */
            gap: 12px;
            margin-bottom: 20px;
        }

        .brand {
            /* –õ–æ–≥–æ—Ç–∏–ø –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –∑–ª—ñ–≤–∞, –∞–ª–µ —è–∫—â–æ —Ç—Ä–µ–±–∞ - –ø–æ—Å—É–Ω–µ—Ç—å—Å—è */
            flex-grow: 1; 
            margin-right: auto;
        }
        .header-controls {
                /* –ü–∞–Ω–µ–ª—å –∑ —Ä–µ–≥—ñ–æ–Ω–æ–º —ñ —Ç–µ–º–æ—é –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å—Å—è –Ω–∞ –Ω–æ–≤–∏–π —Ä—è–¥–æ–∫ */
            width: 100%; 
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }
        .region-chip {
                /* –¶–µ–π –µ–ª–µ–º–µ–Ω—Ç —Ç–µ–ø–µ—Ä –≥—É–º–æ–≤–∏–π, —â–æ–± –Ω–µ –≤–∏—à—Ç–æ–≤—Ö—É–≤–∞—Ç–∏ –∫–Ω–æ–ø–∫—É —Ç–µ–º–∏ */
            flex: 1; 
            min-width: 0; /* –ú–∞–≥—ñ—è CSS: –¥–æ–∑–≤–æ–ª—è—î —Ç–µ–∫—Å—Ç—É —Å–∫–æ—Ä–æ—á—É–≤–∞—Ç–∏—Å—å (...) */
            justify-content: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .dark-mode .region-chip {
             background: rgba(255,255,255,0.05);
        }

        .region-dot {
            width: 7px;
            height: 7px;
            border-radius: var(--radius-pill);
            background: #22c55e;
            box-shadow: 0 0 0 4px rgba(34,197,94,0.25);
        }

        .theme-switch {
            border: none;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--surface);
            border: 1px solid var(--border-subtle);
            color: var(--text-main);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            line-height: 1;
            transition: background-color 0.3s, color 0.3s;
            flex-shrink: 0;
        }
        
        .brand-logo {
            width: 40px; height: 40px; border-radius: 14px;
            background: radial-gradient(circle at 20% 0, #4ade80, #22c55e 35%, #15803d 100%);
            display: inline-flex; align-items: center; justify-content: center;
            box-shadow: 0 0 0 2px rgba(34,197,94,0.2), 0 16px 35px rgba(22,163,74,0.7);
        }

        .brand-logo svg {
            width: 26px; height: 26px;
        }

        .brand-text {
            display: flex; flex-direction: column; gap: 2px;
        }

        .brand-name {
            font-family: 'Montserrat', sans-serif; /* –°—Ç–∏–ª—å–Ω–∏–π —à—Ä–∏—Ñ—Ç */
            font-weight: 800; /* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∂–∏—Ä–Ω—ñ—Å—Ç—å */
            font-size: 20px;
            letter-spacing: -0.5px;
            
            /* –ì—Ä–∞–¥—ñ—î–Ω—Ç –¥–ª—è —Ç–µ–∫—Å—Ç—É */
            background: linear-gradient(120deg, var(--text-main) 40%, var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            color: var(--text-main);
        }

        .brand-sub {
            font-family: 'Montserrat', sans-serif;
            font-size: 10px; 
            font-weight: 700; /* –ñ–∏—Ä–Ω—ñ—à–∏–π –ø—ñ–¥–ø–∏—Å */
            color: var(--text-muted); 
            text-transform: uppercase; 
            letter-spacing: 0.15em; /* –®–∏—Ä–æ–∫—ñ –ª—ñ—Ç–µ—Ä–∏ –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç—É */
            margin-top: -2px; /* –¢—Ä–æ—Ö–∏ –ø—ñ–¥—Ç—è–≥—É—î–º–æ –¥–æ–≥–æ—Ä–∏ */
        }
        
        /* HERO */
        .hero-card {
            padding: 18px 16px;
        }

        .dark-mode .hero-card {
            background: linear-gradient(135deg, rgba(30,41,59,0.92), rgba(30,41,59,0.9));
        }

        .hero-card::before {
            content: "";
            position: absolute;
            right: -40px;
            top: -60px;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(59,130,246,0.14), transparent 70%);
            pointer-events: none;
        }

        .hero-main {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .hero-title {
            font-size: 22px;
            line-height: 1.2;
            font-weight: 700;
            max-width: 560px;
            margin-bottom: 2px;
        }

        .hero-title span {
            color: var(--primary);
        }

        .hero-subline {
            font-size: 13px;
            line-height: 1.4;
            color: var(--text-muted);
            margin-bottom: 4px;
            max-width: 480px;
        }

        .hero-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .primary-btn {
            border: none;
            outline: none;
            cursor: pointer;
            border-radius: var(--radius-pill);
            padding: 11px 18px;
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: #fff;
            font-size: 14px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 16px 35px rgba(37,99,235,0.35);
            text-decoration: none; /* üëà –î–æ–¥–∞–π —Ü–µ, —â–æ–± –ø—Ä–∏–±—Ä–∞—Ç–∏ –ø—ñ–¥–∫—Ä–µ—Å–ª–µ–Ω–Ω—è */
            justify-content: center; /* –¶–µ–Ω—Ç—Ä—É—î–º–æ —Ç–µ–∫—Å—Ç */
        }

        .primary-btn:hover {
             opacity: 0.9;
        }

        .primary-btn span.icon {
            display: inline-flex;
            width: 20px;
            height: 20px;
            border-radius: var(--radius-pill);
            background: rgba(255,255,255,0.18);
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .secondary-pill {
            font-size: 12px;
            padding: 7px 11px;
            border-radius: var(--radius-pill);
            border: 1px dashed var(--text-muted);
            background: var(--surface-soft);
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: var(--text-muted);
            transition: background-color 0.3s, border-color 0.3s;
        }
        
        .dark-mode .secondary-pill {
             border-color: rgba(255,255,255,0.3);
        }

        .secondary-pill strong {
            font-weight: 600;
            color: var(--text-main);
            transition: color 0.3s;
        }

        .hero-footer {
            margin-top: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: var(--text-muted);
            flex-wrap: wrap;
        }

        .hero-footer span.badge {
            padding: 5px 9px;
            border-radius: var(--radius-pill);
            background: rgba(22,163,74,0.08);
            border: 1px solid rgba(22,163,74,0.16);
            color: #15803d;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .dark-mode .hero-footer span.badge {
             background: rgba(22,163,74,0.25);
             border-color: rgba(22,163,74,0.5);
             color: #dcfce7;
        }

        .hero-footer span.badge svg {
            width: 13px;
            height: 13px;
        }
        
        .dark-mode .hero-footer span.badge svg path {
             fill: #dcfce7 !important;
        }
        
        .dark-mode .hero-footer span.badge svg path:nth-child(2) {
             fill: #22c55e !important;
        }


        /* GRID MAIN */

        .main-grid {
            margin-top: 18px;
            display: grid;
            grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.2fr);
            gap: 18px;
            align-items: flex-start;
        }

        /* CARD (NEXT OUTAGE / LEGEND / TIMELINE) */

        .card {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 16px 16px 14px;
            border: 1px solid var(--border-subtle);
            box-shadow: var(--shadow-soft);
            transition: background 0.3s, border-color 0.3s, box-shadow 0.3s;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
        }

        .chip {
            padding: 4px 8px;
            border-radius: var(--radius-pill);
            font-size: 11px;
            background: rgba(37,99,235,0.08);
            color: #1d4ed8;
            transition: background-color 0.3s, color 0.3s;
        }

        .dark-mode .chip {
            background: rgba(59,130,246,0.3);
            color: #bfdbfe;
        }

        .countdown {
            display: flex;
            gap: 10px;
            margin-top: 6px;
        }

        .countdown-block {
            flex: 1 1 0;
            min-width: 0;
            padding: 10px 8px;
            border-radius: 16px;
            background: var(--countdown-bg);
            color: var(--countdown-color);
            text-align: center;
            transition: background 0.3s, color 0.3s;
        }

        .countdown-value {
            font-size: 22px;
            font-weight: 700;
            letter-spacing: 0.06em;
        }

        .countdown-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            opacity: .7;
        }

        .next-info {
            margin-top: 8px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .next-info strong {
            color: var(--text-main);
            transition: color 0.3s;
        }

        /* QUEUE SELECTOR */

        .queue-select {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .select-wrapper {
            position: relative;
        }

        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding: 8px 28px 8px 12px;
            border-radius: var(--radius-pill);
            border: 1px solid rgba(148,163,184,0.7);
            font-size: 13px;
            background: var(--surface-soft);
            color: var(--text-main);
            outline: none;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        .dark-mode select {
             border-color: rgba(255,255,255,0.3);
             background: #1e293b;
        }

        .select-wrapper::after {
            content: "‚ñæ";
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            color: var(--text-muted);
            pointer-events: none;
        }

        /* TIMELINE */

        .timeline-card {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 14px 14px 10px;
            border: 1px solid var(--border-subtle);
            box-shadow: var(--shadow-soft);
            transition: background 0.3s, border-color 0.3s, box-shadow 0.3s;
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .timeline-title {
            font-size: 15px;
            font-weight: 600;
        }

        .day-tabs {
            display: inline-flex;
            padding: 3px;
            border-radius: var(--radius-pill);
            background: rgba(148,163,184,0.1);
            transition: background-color 0.3s;
        }
        
        .dark-mode .day-tabs {
             background: rgba(255,255,255,0.1);
        }

        .day-tab {
            border: none;
            background: transparent;
            padding: 5px 10px;
            border-radius: var(--radius-pill);
            font-size: 11px;
            cursor: pointer;
            color: var(--text-muted);
            transition: background 0.3s, color 0.3s, box-shadow 0.3s;
        }

        .day-tab.active {
            background: var(--surface);
            color: var(--text-main);
            font-weight: 600;
            box-shadow: 0 1px 4px rgba(15,23,42,0.2);
        }
        
        .dark-mode .day-tab.active {
             box-shadow: 0 1px 4px rgba(0,0,0,0.5);
        }

        .timeline-track {
            position: relative;
            width: 100%;
            height: 32px;
            border-radius: var(--radius-pill);
            background: var(--timeline-bg);
            /* –í–∞–∂–ª–∏–≤–æ: —Ç—É—Ç –ù–ï —Ç—Ä–µ–±–∞ flex, –±–æ —Ç—É—Ç –ª–µ–∂–∞—Ç—å —à–∞—Ä–∏ (—Ç—Ä–µ–∫ —ñ –∫—É—Ä—Å–æ—Ä) */
            display: block; 
            overflow: hidden; /* –û–±—Ä—ñ–∑–∞—î–º–æ –≤—Å–µ, —â–æ –≤–∏–ª–∞–∑–∏—Ç—å –∑–∞ –∫—Ä—É–≥–ª—ñ –∫—Ä–∞—ó */
            margin-bottom: 6px;
        }

        #timelineTrack {
            position: absolute;
            inset: 0; /* –†–æ–∑—Ç—è–≥—É—î–º–æ –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É/–≤–∏—Å–æ—Ç—É –±–∞—Ç—å–∫–∞ */
            display: flex; /* –ê –æ—Å—å —Ç—É—Ç –≤–∂–µ flex –¥–ª—è —à–º–∞—Ç–æ—á–∫—ñ–≤ */
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .timeline-bg {
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(
                90deg,
                #0003,
                #0003 4px,
                transparent 4px,
                transparent 8px
            );
        }

        #timelineFill {
            position: absolute;
            inset: 0;
            display: flex;
        }

        .timeline-segment {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            overflow: hidden;
            white-space: nowrap;
            
            /* –¶–µ –∑–º—É—à—É—î —Å–µ–≥–º–µ–Ω—Ç–∏ —Å–ª—É—Ö–∞—Ç–∏—Å—è JS flex-grow —ñ –Ω–µ –º–∞—Ç–∏ —Å–≤–æ—î—ó —à–∏—Ä–∏–Ω–∏ */
            min-width: 0 !important;
            width: 0 !important; 
            flex-basis: 0;
            
            /* –î–æ–¥–∞—î–º–æ —Ä–æ–∑–¥—ñ–ª—é–≤–∞—á –º—ñ–∂ —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏ */
            border-right: 1px solid rgba(0,0,0,0.1); 
            box-sizing: border-box;
        }

        /* –ü—Ä–∏–±–∏—Ä–∞—î–º–æ —Ä–∞–º–∫—É –≤ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ */
        .timeline-segment:last-child {
            border-right: none;
        }

        .timeline-segment.off {
            background: var(--chart-off) !important; 
            color: #ffffff !important;      
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        
        /* –ó–µ–ª–µ–Ω–∏–π —Å—Ç–∏–ª—å —Ç–µ–∂ –ø–µ—Ä–µ–≤—ñ—Ä, —â–æ–± –±—É–≤ —Ç–∞–∫–∏–º: */
        .timeline-segment.on {
            background: var(--chart-on);
            color: #fff !important; 
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        .timeline-now-indicator {
            position: absolute;
            top: 0;
            bottom: 0; /* –ù–∞ –≤—Å—é –≤–∏—Å–æ—Ç—É */
            width: 2px;
            background: #ffffff; /* –ë—ñ–ª–∞ –ª—ñ–Ω—ñ—è –∫—Ä–∞—â–µ —á–∏—Ç–∞—î—Ç—å—Å—è –Ω–∞ –∫–æ–ª—å–æ—Ä–æ–≤–æ–º—É */
            box-shadow: 0 0 4px rgba(0,0,0,0.5);
            z-index: 10; /* –ü–æ–≤–µ—Ä—Ö –≥—Ä–∞—Ñ—ñ–∫—É */
            pointer-events: none;
            border-radius: 0;
            height: auto; /* –°–∫–∏–¥–∞—î–º–æ —Ñ—ñ–∫—Å–æ–≤–∞–Ω—É –≤–∏—Å–æ—Ç—É */
        }

        .timeline-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 4px;
            font-size: 10px;
            color: var(--text-muted);
        }

        .slots-list {
            margin-top: 8px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            font-size: 12px;
        }

        .slot-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-subtle);
            padding-bottom: 6px;
        }
        
        .slots-list > .slot-row:last-child {
             border-bottom: none;
        }

        .slot-time {
            font-weight: 600;
        }

        .slot-duration {
            color: var(--text-muted);
            font-size: 11px;
        }

        .slot-tag {
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 11px;
            transition: 0.3s;
            border: 1px solid transparent; /* —Ä–∞–º–∫–∞ */
        }

        .slot-tag.on {
            background: var(--status-on-bg);
            color: var(--status-on-text);
            border-color: var(--status-on-border);
        }
        
        .slot-tag.off {
            background: var(--status-off-bg);
            color: var(--status-off-text);
            border-color: var(--status-off-border);
        }

        .dark-mode .slot-tag {
             background: rgba(255,255,255,0.1);
        }

        /* SIDE CARD: LEGEND, INFO */

        .info-list {
            margin-top: 6px;
            padding-left: 18px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .legend {
            margin-top: 8px;
            display: grid;
            grid-template-columns: minmax(0,1fr);
            gap: 4px;
            font-size: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-dot.on {
            background: var(--timeline-bg);
        }

        .legend-dot.off {
            background: var(--timeline-off-bg);
        }

        .support-section {
            margin-top: 10px;
            padding-top: 9px;
            border-top: 1px dashed rgba(148,163,184,0.3);
            display: flex;
            flex-direction: column;
            gap: 6px;
            font-size: 12px;
        }
        
        .dark-mode .support-section {
             border-top-color: rgba(255,255,255,0.3);
        }


        .support-btn {
            border-radius: var(--radius-pill);
            padding: 9px 12px;
            border: none;
            cursor: pointer;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: #ecfdf5;
            font-size: 13px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .support-btn:hover {
            opacity: 0.9;
        }

        .support-btn span.icon {
            font-size: 15px;
        }

        footer {
            margin-top: 20px;
            font-size: 11px;
            color: var(--text-muted);
            display: flex;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
        }

        footer a {
            color: var(--primary);
            text-decoration: none;
            transition: color 0.3s;
        }

        /* MOBILE */
/* MOBILE OPTIMIZATIONS (FIXED SIZE) */
        @media (max-width: 840px) {
            
            html, body {
                overflow-x: hidden;
                width: 100%;
            }

            .page {
                padding: 16px 12px 24px;
                width: 100%;
                overflow: hidden;
            }

            /* --- –®–ê–ü–ö–ê: –í–ï–õ–ò–ö–ê –Ü –ê–ö–£–†–ê–¢–ù–ê --- */
            .top-bar {
                display: flex;
                flex-direction: row; 
                align-items: center; 
                justify-content: space-between; 
                flex-wrap: nowrap; 
                gap: 4px; /* –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –≤—ñ–¥—Å—Ç—É–ø –º—ñ–∂ –ª—ñ–≤–æ—é —ñ –ø—Ä–∞–≤–æ—é —á–∞—Å—Ç–∏–Ω–æ—é */
                margin-bottom: 20px;
                min-height: 48px; /* –¢—Ä–æ—Ö–∏ –≤–∏—â–∞ —à–∞–ø–∫–∞ */
            }

            /* –õ–Ü–í–ê –ß–ê–°–¢–ò–ù–ê (–õ–û–ì–û + –¢–ï–ö–°–¢) */
            .brand {
                display: flex;
                align-items: center;
                gap: 8px;
                flex-shrink: 1; /* –î–æ–∑–≤–æ–ª—è—î–º–æ —Ü—ñ–π —á–∞—Å—Ç–∏–Ω—ñ —Ç—Ä–æ—Ö–∏ —Å—Ç–∏—Å–∫–∞—Ç–∏—Å—å, —è–∫—â–æ –µ–∫—Ä–∞–Ω –≤—É–∑—å–∫–∏–π */
                min-width: 0;
                overflow: hidden; /* –û–±—Ä—ñ–∑–∞—î–º–æ, —è–∫—â–æ —â–æ—Å—å –≤–∏–ª–∞–∑–∏—Ç—å */
            }

            .brand-logo {
                width: 38px; height: 38px; /* üî• –ü–æ–≤–µ—Ä–Ω—É–≤ –≤–µ–ª–∏–∫–∏–π —Ä–æ–∑–º—ñ—Ä */
                flex-shrink: 0;
            }
            .brand-logo svg { width: 24px; height: 24px; }

            .brand-text {
                display: flex; flex-direction: column; justify-content: center;
                min-width: 0;
            }

            .brand-name {
                font-size: 20px; /* üî• –ü–æ–≤–µ—Ä–Ω—É–≤ –≤–µ–ª–∏–∫–∏–π —à—Ä–∏—Ñ—Ç */
                line-height: 1.1;
                white-space: nowrap;
            }
            
            .brand-sub {
                display: block; /* üî• –ü–æ–≤–µ—Ä–Ω—É–≤ –ø—ñ–¥–ø–∏—Å "–ö–∏—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å" */
                font-size: 10px;
                line-height: 1.2;
                white-space: nowrap;
                opacity: 0.8;
                margin-top: -2px;
                
                /* –Ø–∫—â–æ –µ–∫—Ä–∞–Ω —Å—É–ø–µ—Ä –≤—É–∑—å–∫–∏–π - —Å—Ç–∞–≤–∏–º–æ —Ç—Ä–∏ –∫—Ä–∞–ø–∫–∏ */
                overflow: hidden;
                text-overflow: ellipsis; 
            }

            /* –ü–†–ê–í–ê –ß–ê–°–¢–ò–ù–ê (–ö–ù–û–ü–ö–ò) */
            .header-controls {
                flex-shrink: 0; /* –ü—Ä–∞–≤–∞ —á–∞—Å—Ç–∏–Ω–∞ –∑–∞–≤–∂–¥–∏ —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∞ */
                display: flex; align-items: center; gap: 6px;
                margin-left: auto; /* –ü—Ä–∏—Ç–∏—Å–∫–∞—î–º–æ –≤–ø—Ä–∞–≤–æ */
            }
            
            .theme-switch {
                width: 38px; height: 38px; /* –ë—ñ–ª—å—à–∞ –∫–Ω–æ–ø–∫–∞ */
                font-size: 18px;
            }

            .region-chip {
                padding: 6px 10px;
                font-size: 11px;
                white-space: nowrap;
            }
            
            /* –•–ò–¢–†–Ü–°–¢–¨: –Ø–∫—â–æ –µ–∫—Ä–∞–Ω –º–µ–Ω—à–µ 370px (—Å—Ç–∞—Ä—ñ –∞–π—Ñ–æ–Ω–∏), —Ö–æ–≤–∞—î–º–æ —Å–ª–æ–≤–æ "–ì—Ä–∞—Ñ—ñ–∫", –ª–∏—à–∞—î–º–æ —Ç–æ—á–∫—É */
            @media (max-width: 370px) {
                .chip-text { display: none; }
                .region-chip { padding: 8px; } /* –ö–≤–∞–¥—Ä–∞—Ç–Ω–∞ –∫–Ω–æ–ø–∫–∞ */
                .brand-name { font-size: 18px; } /* –¢—Ä–æ—Ö–∏ –º–µ–Ω—à–∏–π —à—Ä–∏—Ñ—Ç */
            }

            /* –Ü–ù–®–Ü –°–¢–ò–õ–Ü –ë–ï–ó –ó–ú–Ü–ù */
            .hero-card { padding: 18px 16px; }
            .hero-title { font-size: 20px; }
            .hero-controls { flex-direction: column; width: 100%; gap: 8px; }
            .primary-btn, .secondary-pill { width: 100%; justify-content: center; }
            .main-grid { grid-template-columns: 1fr; gap: 16px; }
            .timeline-header { flex-direction: column; align-items: stretch; gap: 12px; }
            .day-tabs { width: 100%; display: flex; }
            .day-tab { flex: 1; justify-content: center; }
            .timeline-segment { font-size: 9px; padding: 0 1px; }
            .queue-select, .select-wrapper, select { width: 100%; }
            footer { flex-direction: column; text-align: center; gap: 8px; }
        }
    </style>
</head>
<body>
<div class="page">
    <header class="top-bar">
        <div class="brand">
            <div class="brand-logo" aria-hidden="true">
                <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="boltGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#fefce8"/>
                            <stop offset="45%" stop-color="#facc15"/>
                            <stop offset="100%" stop-color="#f97316"/>
                        </linearGradient>
                    </defs>
                    <circle cx="20" cy="20" r="18" fill="rgba(15,23,42,0.35)"/>
                    <circle cx="20" cy="20" r="13" fill="url(#boltGrad)"/>
                    <path d="M22.8 8.5 13.2 22.1c-.4.6 0 1.4.7 1.4h4.3l-1.0 7.9c-.1.9.9 1.4 1.5.7l9.5-13.9c.4-.6 0-1.4-.7-1.4h-4.3l1.1-7.7c.1-.9-.9-1.5-1.5-.8z"
                          fill="#f97316" opacity="0.22"/>
                    <path d="M22.2 9.5 14 21.4c-.5.7 0 1.6.8 1.6h3.9l-1.0 6.6c-.2 1 1 1.6 1.7.8L27.7 19c.5-.7 0-1.6-.8-1.6H23l1.0-6.2c.3-1-0.9-1.8-1.8-1.1z"
                          fill="url(#boltGrad)"/>
                </svg>
            </div>
            
            <div class="brand-text">
                <div class="brand-name">SvitloUA</div>
                <div class="brand-sub">–ö–∏—ó–≤—â–∏–Ω–∞</div> </div>
        </div>

        <div class="header-controls"> 
            <div class="region-chip">
                <span class="region-dot"></span>
                <span class="chip-text">–ì—Ä–∞—Ñ—ñ–∫</span>
            </div>
            <button class="theme-switch" id="themeToggle" title="–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ —Ç–µ–º—É">
                üåô
            </button>
        </div>
    </header>


    <section class="hero-card">
        <div class="hero-main">
            <h1 class="hero-title">
                –ì—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥—ñ—ó —É <span>–ö–∏—ó–≤—Å—å–∫—ñ–π –æ–±–ª–∞—Å—Ç—ñ</span>
            </h1>
            <p class="hero-subline">
                –û–±–∏—Ä–∞–π—Ç–µ —Å–≤–æ—é —á–µ—Ä–≥—É ‚Äî –æ—Ç—Ä–∏–º—É–π—Ç–µ –∑—Ä–æ–∑—É–º—ñ–ª–∏–π –≥—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å, —Ç–∞–π–º–µ—Ä –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ
                –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Ç–∞ –Ω–∞–æ—á–Ω—É —à–∫–∞–ª—É –Ω–∞ 24&nbsp;–≥–æ–¥–∏–Ω–∏.
            </p>

            <div class="hero-controls">
                <a href="https://t.me/SvitloBroBot" target="_blank" class="primary-btn">
                    <span class="icon">‚ö°</span>
                    –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
                </a>

                <div class="secondary-pill">
                    –°—å–æ–≥–æ–¥–Ω—ñ: <strong id="currentQueueLabel">1.1 —á–µ—Ä–≥–∞</strong>
                    <span style="opacity:.7;">‚Ä¢ –¥–∞–Ω—ñ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –∑ Google Sheets</span>
                </div>
            </div>

            <div class="hero-footer">
                <span class="badge">
                    <svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 1.5 4 3.5v5.6c0 3.6 2.5 6.9 6 7.9 3.5-1 6-4.3 6-7.9V3.5L10 1.5z"
                              fill="#bbf7d0"/>
                        <path d="M10 3 5.5 4.5v4.5C5.5 11.9 7.3 14.1 10 15c2.7-.9 4.5-3.1 4.5-6V4.5L10 3z"
                              fill="#22c55e"/>
                        <path d="M9.1 11.5 7.3 9.7l.9-.9 1 1 3-3 .9.9-3.9 3.8z" fill="#f0fdf4"/>
                    </svg>
                    –î–∞–Ω—ñ –Ω–µ–æ—Ñ—ñ—Ü—ñ–π–Ω—ñ, –∞–ª–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±–ª–∏–∑—å–∫—ñ –¥–æ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—ñ
                </span>
                <span>–ë–∞–∑—É—î—Ç—å—Å—è –Ω–∞ –≤—ñ–¥–∫—Ä–∏—Ç—ñ–π —Ç–∞–±–ª–∏—Ü—ñ Google Sheets. –§–∞–∫—Ç–∏—á–Ω—ñ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –º–æ–∂—É—Ç—å –≤—ñ–¥—Ä—ñ–∑–Ω—è—Ç–∏—Å—è —á–µ—Ä–µ–∑ –∞–≤–∞—Ä—ñ—ó —Ç–∞ –µ–∫—Å—Ç—Ä–µ–Ω—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è.</span>
            </div>
        </div>
    </section>

    <div class="main-grid">
        <div class="timeline-card">
            <div class="timeline-header">
                <div class="timeline-title">–í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å—å–æ–≥–æ–¥–Ω—ñ</div>
                <div class="day-tabs" id="dayTabs">
                    <button class="day-tab active" data-day="today">–°—å–æ–≥–æ–¥–Ω—ñ</button>
                    <button class="day-tab" data-day="tomorrow">–ó–∞–≤—Ç—Ä–∞</button>
                </div>
            </div>

            <div class="queue-select">
                <div class="select-wrapper">
                    <select id="queueSelect">
                        <option value="1.1">1 —á–µ—Ä–≥–∞ (1 –ø—ñ–¥–≥—Ä—É–ø–∞)</option>
                        <option value="1.2">1 —á–µ—Ä–≥–∞ (2 –ø—ñ–¥–≥—Ä—É–ø–∞)</option>
                        <option value="2.1">2 —á–µ—Ä–≥–∞ (1 –ø—ñ–¥–≥—Ä—É–ø–∞)</option>
                        <option value="2.2">2 —á–µ—Ä–≥–∞ (2 –ø—ñ–¥–≥—Ä—É–ø–∞)</option>
                        <option value="3.1">3 —á–µ—Ä–≥–∞ (1 –ø—ñ–¥–≥—Ä—É–ø–∞)</option>
                        <option value="3.2">3 —á–µ—Ä–≥–∞ (2 –ø—ñ–¥–≥—Ä—É–ø–∞)</option>
                        <option value="4.1">4 —á–µ—Ä–≥–∞ (1 –ø—ñ–¥–≥—Ä—É–ø–∞)</option>
                        <option value="4.2">4 —á–µ—Ä–≥–∞ (2 –ø—ñ–¥–≥—Ä—É–ø–∞)</option>
                        <option value="5.1">5 —á–µ—Ä–≥–∞ (1 –ø—ñ–¥–≥—Ä—É–ø–∞)</option>
                        <option value="5.2">5 —á–µ—Ä–≥–∞ (2 –ø—ñ–¥–≥—Ä—É–ø–∞)</option>
                        <option value="6.1">6 —á–µ—Ä–≥–∞ (1 –ø—ñ–¥–≥—Ä—É–ø–∞)</option>
                        <option value="6.2">6 —á–µ—Ä–≥–∞ (2 –ø—ñ–¥–≥—Ä—É–ø–∞)</option>
                    </select>
                </div>

                <span style="font-size:12px;color:var(--text-muted);">
                    –ì—Ä–∞—Ñ—ñ–∫ –ø—ñ–¥—Ç—è–≥—É—î—Ç—å—Å—è –∑ —Ç–∞–±–ª–∏—Ü—ñ Google ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ –∫—ñ–ª—å–∫–∞ —Ö–≤–∏–ª–∏–Ω.
                </span>
            </div>

            <div style="margin-top:12px;">
                <div class="timeline-track">
                    <div id="timelineTrack"></div>
                    <div class="timeline-now-indicator" id="nowIndicator" style="display:none;"></div>
                </div>
                <div class="timeline-labels">
                    <span>00:00</span>
                    <span>06:00</span>
                    <span>12:00</span>
                    <span>18:00</span>
                    <span>24:00</span>
                </div>
            </div>

            <div class="slots-list" id="slotsList">
                </div>
        </div>

        <aside class="card">
            <div class="card-header">
                <div class="card-title">–ù–∞–π–±–ª–∏–∂—á–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è</div>
                <div class="chip" id="queueShortLabel">1.1 —á–µ—Ä–≥–∞</div>
            </div>

            <div class="countdown" id="countdownBox">
                <div class="countdown-block">
                    <div class="countdown-value" id="cdHours">--</div>
                    <div class="countdown-label">–≥–æ–¥</div>
                </div>
                <div class="countdown-block">
                    <div class="countdown-value" id="cdMinutes">--</div>
                    <div class="countdown-label">—Ö–≤</div>
                </div>
                <div class="countdown-block">
                    <div class="countdown-value" id="cdSeconds">--</div>
                    <div class="countdown-label">—Å–µ–∫</div>
                </div>
            </div>

            <div class="next-info" id="nextInfoText">
                –û—á—ñ–∫—É—î–º–æ –¥–∞–Ω—ñ –∑ —Ç–∞–±–ª–∏—Ü—ñ‚Ä¶
            </div>

            <ul class="info-list">
                <li>–ì—Ä–∞—Ñ—ñ–∫ —î –æ—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∏–º. –ü—Ä–∏ –µ–∫—Å—Ç—Ä–µ–Ω–∏—Ö –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è—Ö —á–∞—Å –º–æ–∂–µ –∑–º—ñ—â—É–≤–∞—Ç–∏—Å—è.</li>
                <li>–ú—ñ—Å—Ü–µ–≤—ñ –∞–≤–∞—Ä—ñ—ó (–æ–±—Ä–∏–≤–∏, –ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è –∫–∞–±–µ–ª—ñ–≤, —Ä–æ–±–æ—Ç–∏ –ñ–ï–ö—ñ–≤) —Ç—É—Ç –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è.</li>
            </ul>

            <div class="legend">
                <div class="legend-item">
                    <span class="legend-dot off"></span>
                    <span>–¢–µ–º–Ω–∞ –¥—ñ–ª—è–Ω–∫–∞ ‚Äî –Ω–µ–º–∞—î –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥—ñ—ó</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot on"></span>
                    <span>–°–≤—ñ—Ç–ª–∞ –¥—ñ–ª—è–Ω–∫–∞ ‚Äî –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥—ñ—è –ø—Ä–∏—Å—É—Ç–Ω—è</span>
                </div>
            </div>

            <div class="support-section">
                <div>–Ø–∫—â–æ —É –≤–∞—Å —î —Å–≤—ñ—Ç–ª–æ ‚Äî –±—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥—ñ—é —Ä–æ–∑—É–º–Ω–æ. –ù–µ –≤–º–∏–∫–∞–π—Ç–µ –ø–æ—Ç—É–∂–Ω—ñ –ø—Ä–∏–ª–∞–¥–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ.</div>
                <button class="support-btn" type="button" onclick="window.open('https://send.monobank.ua', '_blank')">
                    <span class="icon">üíö</span>
                    –ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ—î–∫—Ç SvitloUA
                </button>
            </div>
        </aside>
    </div>

    <footer>
        <span>¬© <span id="year"></span> SvitloUA –ö–∏—ó–≤—â–∏–Ω–∞. –ù–µ–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π —Å–µ—Ä–≤—ñ—Å –¥–ª—è –∑—Ä—É—á–Ω–æ–≥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É –≥—Ä–∞—Ñ—ñ–∫—ñ–≤.</span>
        <span>–î–∂–µ—Ä–µ–ª–æ –≥—Ä–∞—Ñ—ñ–∫—ñ–≤: <a href="https://docs.google.com/spreadsheets/d/1LZWXZ6w5R4Lq5afipAa1YHjLyO8lVizPvRCPdOvdmbc" target="_blank" rel="noopener noreferrer">Google Sheets</a></span>
    </footer>
</div>

<script>
    const SHEET_ID = "1LZWXZ6w5R4Lq5afipAa1YHjLyO8lVizPvRCPdOvdmbc";
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

    const COLUMN_GROUP_ID = "group_id";
    const COLUMN_SCHEDULE_TEXT = "schedule_text";
    const dayNamesUa = ["–ù–µ–¥—ñ–ª—è", "–ü–æ–Ω–µ–¥—ñ–ª–æ–∫", "–í—ñ–≤—Ç–æ—Ä–æ–∫", "–°–µ—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä", "–ü º—è—Ç–Ω–∏—Ü—è", "–°—É–±–æ—Ç–∞"];

    let allRows = [];
    let currentQueue = "1.1";
    let currentDayMode = "today";
    let countdownInterval = null;

    // –ï–ª–µ–º–µ–Ω—Ç–∏
    const timelineTrack = document.getElementById("timelineTrack");
    const nowIndicator = document.getElementById("nowIndicator");
    const slotsList = document.getElementById("slotsList");
    const cdH = document.getElementById("cdHours");
    const cdM = document.getElementById("cdMinutes");
    const cdS = document.getElementById("cdSeconds");
    const nextInfo = document.getElementById("nextInfoText");
    const queueSelect = document.getElementById("queueSelect");
    const queueShortLabel = document.getElementById("queueShortLabel");
    const currentQueueLabel = document.getElementById("currentQueueLabel");
    const body = document.body;
    const themeToggle = document.getElementById("themeToggle");

    // === 1. –ü–ê–†–°–ò–ù–ì –î–ê–ù–ò–• ===

    function parseGviz(jsonText) {
        try {
            const start = jsonText.indexOf("{");
            const end = jsonText.lastIndexOf("}");
            const json = JSON.parse(jsonText.substring(start, end + 1));
            
            let lastGroupId = null;
            const outputRows = [];
            
        json.table.rows.forEach(r => {
                const rowData = r.c;
                if (!rowData) return;

                let currentGroupId = '';
                // üí° –ü–†–ê–í–ö–ê: –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –Ω–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤–∞–Ω–∏–π —Ç–µ–∫—Å—Ç (.f), –±–æ .v –º–æ–∂–µ –±—É—Ç–∏ Date(...)
                if (rowData[0]) {
                    currentGroupId = String(rowData[0].f || rowData[0].v || '').trim();
                }
                
                let scheduleText = '';
                if (rowData[1]) {
                    scheduleText = String(rowData[1].v || rowData[1].f || '').trim();
                }

                // –õ–æ–≥—ñ–∫–∞ –æ–±'—î–¥–Ω–∞–Ω–Ω—è –∫–æ–º—ñ—Ä–æ–∫
                if ((currentGroupId === '' || currentGroupId === 'null') && lastGroupId !== null) {
                    currentGroupId = lastGroupId;
                } else if (currentGroupId !== '' && currentGroupId !== 'null') {
                    lastGroupId = currentGroupId;
                }

                if (currentGroupId && scheduleText) {
                    outputRows.push({
                        [COLUMN_GROUP_ID]: currentGroupId,
                        [COLUMN_SCHEDULE_TEXT]: scheduleText
                    });
                }
            });
            return outputRows;
        } catch (e) {
            console.error("–ü–æ–º–∏–ª–∫–∞ JSON:", e);
            return [];
        }
    }

    // === 2. –î–û–ü–û–ú–Ü–ñ–ù–Ü –§–£–ù–ö–¶–Ü–á ===

    function timeToMinutes(t) {
        const [h, m] = t.split(":").map(Number);
        if (h === 24) return 24 * 60;
        return h * 60 + m;
    }

    function minutesToTime(min) {
        const h = Math.floor(min / 60);
        const m = min % 60;
        return `${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}`;
    }

    function durationLabel(min) {
        const h = Math.floor(min / 60);
        const m = min % 60;
        if (min < 0) return "--";
        if (!h) return `${m} —Ö–≤`;
        if (!m) return `${h} –≥–æ–¥`;
        return `${h} –≥–æ–¥ ${m} —Ö–≤`;
    }

    function parseTimesString(scheduleText, targetDayName) {
        if (!scheduleText || typeof scheduleText !== "string") return [];
        let dayTimesString = "";
        const dayRegex = new RegExp(`${targetDayName}\\s*:\\s*([^\\n]+)`, 'i');
        const match = scheduleText.match(dayRegex);

        if (match && match[1]) dayTimesString = match[1].trim();
        if (!dayTimesString || dayTimesString === '-') return [];

        return dayTimesString
            .replace(/\+/g, '')
            .split(',')
            .map(part => part.trim())
            .filter(Boolean)
            .map(part => {
                const parts = part.split('-').map(s => s.trim());
                if (parts.length !== 2) return null;
                const [from, to] = parts;
                if (!/^\d{2}:\d{2}$/.test(from) || !/^\d{2}:\d{2}$/.test(to)) return null;
                return { off: from, on: to };
            })
            .filter(Boolean)
            .sort((a, b) => timeToMinutes(a.off) - timeToMinutes(b.off));
    }

    function getTodayTomorrowNames() {
        const now = new Date();
        const todayIdx = now.getDay();
        const tomorrowIdx = (todayIdx + 1) % 7;
        return {
            todayName: dayNamesUa[todayIdx],
            tomorrowName: dayNamesUa[tomorrowIdx]
        };
    }

    function filterRowsFor(queue, dayMode) {
        const { todayName, tomorrowName } = getTodayTomorrowNames();
        const targetDayName = (dayMode === "today") ? todayName : tomorrowName;
        const row = allRows.find(r => String(r[COLUMN_GROUP_ID]).trim() === String(queue).trim());
        
        if (!row) return { intervals: [], dayName: targetDayName };

        const scheduleText = row[COLUMN_SCHEDULE_TEXT] || "";
        const normalized = scheduleText.replace(/\r/g, "");
        return { intervals: parseTimesString(normalized, targetDayName), dayName: targetDayName };
    }

    // === 3. –ü–û–ë–£–î–û–í–ê –ì–†–ê–§–Ü–ö–£ ===

    function makeTimeline(queue, dayMode) {
        // –û—á–∏—Å—Ç–∫–∞
        if (countdownInterval) { cancelAnimationFrame(countdownInterval); }
        timelineTrack.innerHTML = "";
        slotsList.innerHTML = "";

        const { intervals, dayName } = filterRowsFor(queue, dayMode);
        
        // –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä "–∑–∞—Ä–∞–∑"
        const now = new Date();
        if (dayMode === "today") {
            const minNow = now.getHours() * 60 + now.getMinutes();
            nowIndicator.style.left = `${(minNow / 1440) * 100}%`;
            nowIndicator.style.display = "block";
        } else {
            nowIndicator.style.display = "none";
        }

        // –Ø–∫—â–æ —Å–≤—ñ—Ç–ª–æ –≤–µ—Å—å –¥–µ–Ω—å
        if (!intervals.length) {
            timelineTrack.innerHTML = `<div class="timeline-segment on" style="flex-grow:1">24 –≥–æ–¥–∏–Ω–∏ —Å–≤—ñ—Ç–ª–æ</div>`;
            slotsList.innerHTML = `
                <div class="slot-row">
                    <div><div class="slot-time">00:00 ‚Äì 24:00</div></div>
                    <div class="slot-tag on">‚ö° –°–≤—ñ—Ç–ª–æ —î</div>
                </div>`;
            updateCountdown([], dayMode);
            return;
        }

        let pointer = 0; // –°–¢–ê–†–¢–£–Ñ–ú–û –ó 00:00

        intervals.forEach((intv) => {
            const start = timeToMinutes(intv.off);
            const end = timeToMinutes(intv.on);

            // üü¢ –ö–†–û–ö 1: –ß–∏ —î —Å–≤—ñ—Ç–ª–æ –ø–µ—Ä–µ–¥ —Ü–∏–º –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è–º?
            // –Ø–∫—â–æ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –æ 12:30, –∞ pointer –Ω–∞ 00:00, —Ç–æ duration = 750 —Ö–≤ —Å–≤—ñ—Ç–ª–∞
            if (start > pointer) {
                const duration = start - pointer;
                const timeLabel = `${minutesToTime(pointer)} ‚Äì ${intv.off}`;
                
                // –ú–∞–ª—é—î–º–æ –ó–ï–õ–ï–ù–ò–ô —à–º–∞—Ç–æ–∫ (–≤—ñ–¥—Å—Ç—É–ø)
                const segOn = document.createElement("div");
                segOn.className = "timeline-segment on";
                segOn.style.flexGrow = duration; // –¶–ï –†–û–ë–ò–¢–¨ –í–Ü–î–°–¢–£–ü
                if (duration > 50) segOn.textContent = timeLabel;
                timelineTrack.appendChild(segOn);

                addSlotToList(timeLabel, durationLabel(duration), true);
            }

            // üî¥ –ö–†–û–ö 2: –ú–∞–ª—é—î–º–æ —Å–∞–º–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
            const durationOff = end - start;
            const timeLabelOff = `${intv.off} ‚Äì ${intv.on}`;

            const segOff = document.createElement("div");
            segOff.className = "timeline-segment off";
            segOff.style.flexGrow = durationOff;
            if (durationOff > 50) segOff.textContent = timeLabelOff;
            timelineTrack.appendChild(segOff);

            addSlotToList(timeLabelOff, durationLabel(durationOff), false);

            pointer = end; // –ü–µ—Ä–µ—Å—É–≤–∞—î–º–æ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ –∫—ñ–Ω–µ—Ü—å –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
        });

        // üü¢ –ö–†–û–ö 3: –•–≤—ñ—Å—Ç —Å–≤—ñ—Ç–ª–∞ –¥–æ –∫—ñ–Ω—Ü—è –¥–æ–±–∏
        if (pointer < 1440) {
            const duration = 1440 - pointer;
            const timeLabel = `${minutesToTime(pointer)} ‚Äì 00:00`;
            
            const segTail = document.createElement("div");
            segTail.className = "timeline-segment on";
            segTail.style.flexGrow = duration;
            if (duration > 50) segTail.textContent = timeLabel;
            timelineTrack.appendChild(segTail);

            addSlotToList(timeLabel, durationLabel(duration), true);
        }

        updateCountdown(intervals, dayMode);
    }

    function addSlotToList(timeRange, duration, isLightOn) {
        const row = document.createElement("div");
        row.className = "slot-row";
        const statusClass = isLightOn ? "on" : "off";
        const text = isLightOn ? "–°–≤—ñ—Ç–ª–æ —î" : "–í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è";
        const icon = isLightOn ? "‚ö°" : "üåë";

        row.innerHTML = `
            <div>
                <div class="slot-time">${timeRange}</div>
                <div class="slot-duration" style="font-size:11px; opacity:0.7">${duration}</div>
            </div>
            <div class="slot-tag ${statusClass}">
                ${icon} ${text}
            </div>
        `;
        slotsList.appendChild(row);
    }

    // === 4. –¢–ê–ô–ú–ï–† ===

    function updateCountdown(intervals, dayMode) {
        if (countdownInterval) { cancelAnimationFrame(countdownInterval); }

        // –Ø–∫—â–æ –Ω–µ–º–∞—î –¥–∞–Ω–∏—Ö
        if (dayMode !== "today" || !intervals || !intervals.length) {
            cdH.textContent = "--"; cdM.textContent = "--"; cdS.textContent = "--";
            // –°–∫–∏–¥–∞—î–º–æ –∫–æ–ª—ñ—Ä –Ω–∞ –∑–≤–∏—á–∞–π–Ω–∏–π
            [cdH, cdM, cdS].forEach(el => el.style.color = 'var(--countdown-color)');
            nextInfo.textContent = (dayMode !== "today") 
                ? `–¢–∞–π–º–µ—Ä —Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ä–µ–∂–∏–º—É "–°—å–æ–≥–æ–¥–Ω—ñ".` 
                : "–°–≤—ñ—Ç–ª–∏—Ö –∑–æ–Ω –∑–∞ –≥—Ä–∞—Ñ—ñ–∫–æ–º –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ –±—ñ–ª—å—à–µ –Ω–µ–º–∞—î.";
            return;
        }

        function tick() {
            const now = new Date();
            const totalNowMin = now.getHours() * 60 + now.getMinutes();
            const nowSec = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();

            let targetTimeSec = null;
            let message = "";
            let isCurrentOutage = false;

            for (const intv of intervals) {
                const start = timeToMinutes(intv.off);
                const end = timeToMinutes(intv.on);

                if (totalNowMin >= start && totalNowMin < end) {
                    isCurrentOutage = true;
                    targetTimeSec = end * 60;
                    message = `–ó–∞—Ä–∞–∑ –¥—ñ—î –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è. –°–≤—ñ—Ç–ª–æ –æ—Ä—ñ—î–Ω—Ç–æ–≤–Ω–æ –∑'—è–≤–∏—Ç—å—Å—è –æ ${intv.on}`;
                    break;
                }
                
                if (start > totalNowMin) {
                    targetTimeSec = start * 60;
                    message = `–°–≤—ñ—Ç–ª–æ —î. –ù–∞—Å—Ç—É–ø–Ω–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –æ ${intv.off}`;
                    break;
                }
            }

            if (targetTimeSec === null) {
                cdH.textContent = "00"; cdM.textContent = "00"; cdS.textContent = "00";
                [cdH, cdM, cdS].forEach(el => el.style.color = 'var(--countdown-color)');
                nextInfo.textContent = "–ù–∞ —Å—å–æ–≥–æ–¥–Ω—ñ –ø–ª–∞–Ω–æ–≤—ñ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—è.";
                return;
            }

            let diff = targetTimeSec - nowSec;

            if (diff <= 0) {
                 makeTimeline(currentQueue, currentDayMode);
                 return;
            }

            const hours = Math.floor(diff / 3600);
            diff %= 3600;
            const minutes = Math.floor(diff / 60);
            const seconds = diff % 60;

            cdH.textContent = String(hours).padStart(2, "0");
            cdM.textContent = String(minutes).padStart(2, "0");
            cdS.textContent = String(seconds).padStart(2, "0");
            
            // üî• –§–ê–†–ë–£–Ñ–ú–û –¢–ê–ô–ú–ï–† –¢–ê –¢–ï–ö–°–¢
            if (isCurrentOutage) {
                // –Ø–∫—â–æ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è - –ß–ï–†–í–û–ù–ò–ô
                [cdH, cdM, cdS].forEach(el => el.style.color = '#ef4444');
                nextInfo.innerHTML = `<span style="color: #ef4444; font-weight:bold;">‚ö†Ô∏è ${message}</span>`;
            } else {
                // –Ø–∫—â–æ —Å–≤—ñ—Ç–ª–æ —î - –∑–≤–∏—á–∞–π–Ω–∏–π
                [cdH, cdM, cdS].forEach(el => el.style.color = 'var(--countdown-color)');
                nextInfo.textContent = message;
            }
            
            countdownInterval = requestAnimationFrame(tick);
        }
        tick();
    }
    
    // === 5. –¢–ï–ú–ê –¢–ê –ü–û–î–Ü–á ===
    
    function setDarkMode(isDark) {
        if (isDark) {
            body.classList.add('dark-mode');
            themeToggle.textContent = '‚òÄÔ∏è'; 
            localStorage.setItem('theme', 'dark');
        } else {
            body.classList.remove('dark-mode');
            themeToggle.textContent = 'üåô'; 
            localStorage.setItem('theme', 'light');
        }
    }
    
    function toggleDarkMode() {
        setDarkMode(!body.classList.contains('dark-mode'));
    }

    function updateQueueSelector(rows) {
        const selector = document.getElementById('queueSelect');
        selector.innerHTML = ''; 
        
        const uniqueQueues = new Set();
        // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
        const standardQueuesOrder = [
            "1.1", "1.2", "2.1", "2.2", "3.1", "3.2", 
            "4.1", "4.2", "5.1", "5.2", "6.1", "6.2"
        ];
        
        const queueDescriptions = {
            "1.1": "1 —á–µ—Ä–≥–∞ (1 –ø—ñ–¥–≥—Ä—É–ø–∞)", "1.2": "1 —á–µ—Ä–≥–∞ (2 –ø—ñ–¥–≥—Ä—É–ø–∞)",
            "2.1": "2 —á–µ—Ä–≥–∞ (1 –ø—ñ–¥–≥—Ä—É–ø–∞)", "2.2": "2 —á–µ—Ä–≥–∞ (2 –ø—ñ–¥–≥—Ä—É–ø–∞)",
            "3.1": "3 —á–µ—Ä–≥–∞ (1 –ø—ñ–¥–≥—Ä—É–ø–∞)", "3.2": "3 —á–µ—Ä–≥–∞ (2 –ø—ñ–¥–≥—Ä—É–ø–∞)",
            "4.1": "4 —á–µ—Ä–≥–∞ (1 –ø—ñ–¥–≥—Ä—É–ø–∞)", "4.2": "4 —á–µ—Ä–≥–∞ (2 –ø—ñ–¥–≥—Ä—É–ø–∞)",
            "5.1": "5 —á–µ—Ä–≥–∞ (1 –ø—ñ–¥–≥—Ä—É–ø–∞)", "5.2": "5 —á–µ—Ä–≥–∞ (2 –ø—ñ–¥–≥—Ä—É–ø–∞)",
            "6.1": "6 —á–µ—Ä–≥–∞ (1 –ø—ñ–¥–≥—Ä—É–ø–∞)", "6.2": "6 —á–µ—Ä–≥–∞ (2 –ø—ñ–¥–≥—Ä—É–ø–∞)",
        };
        
        // –ó–±–∏—Ä–∞—î–º–æ –≤—Å—ñ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ ID –∑ —Ç–∞–±–ª–∏—Ü—ñ
        rows.forEach(row => {
            if (row[COLUMN_GROUP_ID]) uniqueQueues.add(row[COLUMN_GROUP_ID]);
        });

        // –°–æ—Ä—Ç—É—î–º–æ: —Å–ø–æ—á–∞—Ç–∫—É –ø—Ä–∞–≤–∏–ª—å–Ω—ñ (1.1, 1.2...), –ø–æ—Ç—ñ–º –≤—Å–µ —ñ–Ω—à–µ (—Å–º—ñ—Ç—Ç—è, –¥–∞—Ç–∏ —Ç–æ—â–æ)
        const sortedQueues = Array.from(uniqueQueues).sort((a, b) => {
            const indexA = standardQueuesOrder.indexOf(a);
            const indexB = standardQueuesOrder.indexOf(b);
            // –Ø–∫—â–æ –æ–±–∏–¥–≤–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ - —Å–æ—Ä—Ç—É—î–º–æ –∑–∞ –ø–æ—Ä—è–¥–∫–æ–º
            if (indexA !== -1 && indexB !== -1) return indexA - indexB;
            // –Ø–∫—â–æ –æ–¥–∏–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π - –≤—ñ–Ω –≤–∏—â–µ
            if (indexA !== -1) return -1;
            if (indexB !== -1) return 1;
            // –Ü–Ω—à–µ —Å–æ—Ä—Ç—É—î–º–æ —è–∫ —Ç–µ–∫—Å—Ç
            return a.localeCompare(b);
        });

        if (sortedQueues.length === 0) {
            selector.innerHTML = '<option value="0">–î–∞–Ω–∏—Ö –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</option>';
        } else {
            selector.innerHTML = sortedQueues.map(q => {
                // –Ø–∫—â–æ –¥–ª—è —á–µ—Ä–≥–∏ —î –≥–∞—Ä–Ω–∏–π –æ–ø–∏—Å ‚Äî –±–µ—Ä–µ–º–æ –π–æ–≥–æ, —è–∫—â–æ –Ω—ñ ‚Äî –≤–∏–≤–æ–¥–∏–º–æ —è–∫ —î
                const description = queueDescriptions[q] || `${q} (–ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –Ω–∞–∑–≤–∞)`;
                return `<option value="${q}">${description}</option>`;
            }).join('');
        }
    }

    // === 6. –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ===

    async function loadSheet() {
        nextInfo.textContent = "‚öôÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...";
        try {
            const res = await fetch(SHEET_URL);
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            
            const text = await res.text();
            allRows = parseGviz(text);
            
            if (!allRows.length) {
                nextInfo.textContent = "‚ùå –î–∞–Ω—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ.";
                return; 
            }

            updateQueueSelector(allRows);

            const savedQueue = localStorage.getItem('currentQueue');
            const avail = allRows.map(r => r[COLUMN_GROUP_ID]);
            
            if (savedQueue && avail.includes(savedQueue)) {
                currentQueue = savedQueue;
            } else if (avail.length > 0) {
                currentQueue = avail[0];
            }

            queueSelect.value = currentQueue;
            queueShortLabel.textContent = `${currentQueue} —á–µ—Ä–≥–∞`;
            currentQueueLabel.textContent = `${currentQueue} —á–µ—Ä–≥–∞`;
            
            nextInfo.textContent = "‚úÖ –î–∞–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ.";
            makeTimeline(currentQueue, currentDayMode);

        } catch (e) {
            console.error(e);
            nextInfo.textContent = "‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.";
        }
    }

    document.getElementById("year").textContent = new Date().getFullYear();

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–µ–º–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        setDarkMode(true);
    } else {
        setDarkMode(false);
    }

    themeToggle.addEventListener("click", toggleDarkMode);
    
    queueSelect.addEventListener("change", () => {
        currentQueue = queueSelect.value;
        localStorage.setItem('currentQueue', currentQueue);
        queueShortLabel.textContent = `${currentQueue} —á–µ—Ä–≥–∞`;
        currentQueueLabel.textContent = `${currentQueue} —á–µ—Ä–≥–∞`;
        makeTimeline(currentQueue, currentDayMode);
    });

    document.getElementById("dayTabs").addEventListener("click", (e) => {
        const btn = e.target.closest(".day-tab");
        if (!btn) return;
        document.querySelectorAll(".day-tab").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentDayMode = btn.dataset.day;
        makeTimeline(currentQueue, currentDayMode);
    });

    loadSheet();
</script>
</body>
</html>
